{"expireTime":9007200860071785000,"key":"transformer-remark-markdown-html-b12811b3ee04578af536ccf2271ecb33-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjs-titlegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-prismjs-","val":"<p>Emacsのパッケージマネージャーのuse-package.elにはパッケージインストールの他に任意のタイミングで評価させるキーワードというものがありますが、自分はこれをよく分からず使っているので調べてまとめます。</p>\n<h2>実行タイミング</h2>\n<p>評価の順番はこうなります</p>\n<ol>\n<li>パッケージ名の実在確認</li>\n<li><code class=\"language-text\">:preface</code></li>\n<li><code class=\"language-text\">:if, :when, :unless</code></li>\n<li><code class=\"language-text\">:init</code></li>\n<li><code class=\"language-text\">:require</code>パッケージをロード</li>\n<li>パッケージをロード</li>\n<li><code class=\"language-text\">:config</code></li>\n</ol>\n<p>インストールするパッケージの設定を記述するためのキーワードです。</p>\n<h3>:preface</h3>\n<p>条件分岐キーワードを同時に使用していた時でも、条件分岐よりも先に評価されます。つまり、指定したパッケージ名が実在するならば真っ先に必ず評価してくれます。</p>\n<h3>:init</h3>\n<p>パッケージが読み込まれる前に評価されます。遅延キーワードの影響を受けません。</p>\n<h3>:config</h3>\n<p>当該のパッケージが読み込まれた後に評価されます。initに比べ、configは後述の遅延ロードを設定した際にパッケージがロードされるまで評価されなくなります。</p>\n<h2>パッケージ設定</h2>\n<h3>:custom</h3>\n<p>パッケージの設定を書くキーワードです、<code class=\"language-text\">(setq ~)</code>と書いているのと同じことです。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> comint\n  <span class=\"token lisp-property property\">:custom</span>\n  <span class=\"token punctuation\">(</span><span class=\"token car\">comint-buffer-maximum-size</span> <span class=\"token number\">20000</span> <span class=\"token string\">\"Increase comint buffer size.\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token punctuation\">(</span><span class=\"token car\">comint-prompt-read-only</span> <span class=\"token boolean\">t</span> <span class=\"token string\">\"Make the prompt read only.\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token car\">var-name</span> var-value <span class=\"token string\">\"comment\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:custom-face</h3>\n<p>パッケージにカスタムフェイスを適用できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> eruby-mode\n  <span class=\"token lisp-property property\">:custom-face</span>\n  <span class=\"token punctuation\">(</span><span class=\"token car\">eruby-standard-face</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">t</span> <span class=\"token punctuation\">(</span><span class=\"token lisp-property property\">:slant</span> italic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>遅延ロード</h2>\n<p>emacs起動時に全てのパッケージを読み込んでしまうと起動に時間が掛かってしまいます、そこで起動時には読み込まずにパッケージが必要になったタイミングで読み込ませる遅延ロードという仕組みがあります。</p>\n<p>必要になったタイミングを検知する方法がいくつかあるため遅延キーワードも何個かあります。</p>\n<h3>:defer</h3>\n<p>実はemacs自体に遅延ロードを記述する<code class=\"language-text\">;;;#autoload</code>があります、パッケージ内にこのコメントに続いて遅延ロードに関しての記述をすることでemacs側が良しなにしてくれるので、パッケージの開発者がautoloadを設定してくれている場合はuse-packageで遅延キーワードを書く必要はないです。しかし、:ifなどの条件分岐キーワードを同時に使っている場合は期待している動作にならないため、autoloadに従うことを明示的に宣言する必要があります。その場合は<code class=\"language-text\">:defer</code>キーワードをつけます。</p>\n<p>その他、キーバインドなど自分で設定した項目を遅延ロードのきっかけにすることができます。以下のキーワードを用いて設定をすれば遅延ロードを自動で設定してくれます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> perl-mode\n  <span class=\"token lisp-property property\">:defer</span> <span class=\"token boolean\">t</span><span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; version2で指定秒数の遅延が追加されたようです。lspなど外部プロセスに依存するようなパッケージに有効ではないでしょうか。</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> perl-mode\n  <span class=\"token lisp-property property\">:defer</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:commands</h3>\n<p>特定のコマンドを呼び出した時ににパッケージをロードします。<code class=\"language-text\">M-x</code>から呼び出した時のほかキーバインドに設定されていて、そのキーが押された時にも反応します。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> color-moccur\n  <span class=\"token lisp-property property\">:commands</span> <span class=\"token punctuation\">(</span><span class=\"token car\">isearch-moccur</span> isearch-all<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>:commandsキーワードに続いてカッコで囲って列挙すればいいみたいです。</p>\n<h3>:bind</h3>\n<p>コマンドにキーバインドを割り当てます。:commandsキーワード+(bind-key ~)のことです。ここで割り当てるキーマップはローカルキーバインドを上書きをします。</p>\n<p>キーバインドに設定する値は<code class=\"language-text\">(kbd xx)</code>と同じ指定方法を使えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ace-jump-mode\n  <span class=\"token lisp-property property\">:bind</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"<span class=\"token argument\">C-</span>.\"</span> <span class=\"token punctuation\">.</span> ace-jump-mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>:bindで設定するコマンドはパッケージ内でautoloadが設定されていることを想定しています、autoloadされていないコマンドのバインドを設定したい場合は:bind-keyを使用します。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> projectile\n  <span class=\"token lisp-property property\">:bind-keymap</span>\n  <span class=\"token punctuation\">(</span><span class=\"token string\">\"C-c p\"</span> <span class=\"token punctuation\">.</span> projectile-command-map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:mode, :interpreter</h3>\n<p>メジャーモードの設定を行います。:modeはファイル名もしくは拡張子に紐づけることができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> python\n  <span class=\"token lisp-property property\">:mode</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\.py'\"</span> <span class=\"token punctuation\">.</span> python-mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; パッケージ名がXX-modeとなっている場合は省略記法が使えます。</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ruby-mode\n  <span class=\"token lisp-property property\">:mode</span> <span class=\"token string\">\"\\\\.rb\\\\'\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>:interpreterはシバンで指定された言語のモードで開く設定です。</p>\n<p>シバンはプログラムの1行目に<code class=\"language-text\">#!/bin/python</code>のように実行するインタープリターを指定する記述のことです。\nこの指定されたインタープリターを元にメジャーモードを判定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> python\n  <span class=\"token lisp-property property\">:interpreter</span> python<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:hook</h3>\n<p>他のコマンドが実行された時に、同時に実行したい時に使用します。\nファイル保存のコマンドが走った時にformatterを実行したい時などに便利です。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> formatter\n  <span class=\"token lisp-property property\">:hook</span> save-buff<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:magic, :magic-fallback</h3>\n<p>ファイルの先頭に指定する文字列がないか確認し、一致する場合に指定のモードで開きます。</p>\n<p>emacsでテキストファイルでは無いものを扱う際にも便利なのでは無いでしょうか、もちろんテキストファイル(拡張子はjsだけど開きたいモードが違うとか)。docではpdfを例に挙げています。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> pdf-tools\n  <span class=\"token lisp-property property\">:magic</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"%PDF\"</span> <span class=\"token punctuation\">.</span> pdf-view-mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>試しにPDFファイルをemacsで開いてみるとこんな感じでした。確かに1行目に<code class=\"language-text\">%PDF</code>の記述があります。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4798eb86994de0708a4dd31128bc940/6c99d/pdf.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaklEQVQoz6VRy07CQBTtb0CiLuhMpy19TFtowYC/gR+gxtaAFJEYFF2wcOUvH+8daYxGEgyLk/uYuWfOuWNdTiaoqgplWeLm6hrV9A6zVY16vcTi+RGz5RzT5T1mTzUWm5U5X283eHl/w+vH1uTzhxrlbWl4LNfzkGY95EUB6Sgo34MTuFCxDxV5EK6E9ByokPqhC1vacKgvKVfaN/Hk7BStVgvtdhuWThKcjy+QEKlOM0SxhhQSwhZwJBHRIxwd6imu1VetduDcdV34vm9gRWGI8WiEhIj7/T6KIsdgMECvR+RRhDiOTQzpXoMgCAy43+12EVKutYamuxZfKMhulmWGMM9znA+HGBKams940Lbt/eh0TLSYmQnZCkvmwUaBAdVsSUrapRDfkVbwo7eDxTKZsBn663VBQ4fCSkghW4tpH6xQ/HpRSmFUHEzIFtM0NUo6tIf/DO9VyJbZeqPwKEJWxz/KStnisYSfNURWzjwHwukAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"opened pdf file by emacs\"\n        title=\"opened pdf file by emacs\"\n        src=\"/static/d4798eb86994de0708a4dd31128bc940/fcda8/pdf.png\"\n        srcset=\"/static/d4798eb86994de0708a4dd31128bc940/12f09/pdf.png 148w,\n/static/d4798eb86994de0708a4dd31128bc940/e4a3f/pdf.png 295w,\n/static/d4798eb86994de0708a4dd31128bc940/fcda8/pdf.png 590w,\n/static/d4798eb86994de0708a4dd31128bc940/efc66/pdf.png 885w,\n/static/d4798eb86994de0708a4dd31128bc940/c83ae/pdf.png 1180w,\n/static/d4798eb86994de0708a4dd31128bc940/6c99d/pdf.png 1447w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span> </p>\n<p>文字列には正規表現が使えるみたいです。pngファイルをemacsで開くとこうなるので\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/52395ddcfedba26c997ee4dc17b6358c/2aa89/png.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB40lEQVQoz1VS2XLTQBDUhxBHtuNK3sCWJe2uVpdNinceOIoiJOKoEFMVUICEKo5Pb6ZnJQcepmZ3dqanu6Xo6ctneP2hw/O3Z3hx9grdxQW6rsP5m3O8+/gel18/4bLfYXf3Gf3v77i+7dH/+ob+Z4ibP7f48uMG13c9rnZXiJbWYXFyjOlijgeTA8RxjEPGYYx4NsX8+AgzeZufLLSHtenRbIj7czyf4WAyQbRap/DNBs4VKKoGhZwtc81o4aoWXjLfTFHC+gq28Jqd1DzrziMXYuyPkizXQ+5LOMlGmp2AuWoALCvNVnIugLkMr41DKgBczMiFTC5zRjCiRB795rEM1FpwVa3AqTQZshnqSW6wSjM8XCVYiiqeGctkrfGIWeoRt/l2q9vJQiWTDS1oWgVnrT59otZklCaZM1RCRbyX21PNUWoLlZe5kEeAfaZHZWBNtlxkta9RBaas9N0OfdFKPOSQHRo4FGQG05XNZquszVC3VQAgy6CoVqt4j+gNG+jTKNcOTM1w3psvthCUfRrtRpkGwNAjgDYAlmFzkBnue8bDAvpkBybjQn5ths5TMi+jNP1d6jDMoXFY3+QDBZY++EnJ8neEDxfmMmMDQz78Ly8wVR+b9h6wrPZ9Y/1fSzj3F6kbnVyUfatCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"open png file by emacs\"\n        title=\"open png file by emacs\"\n        src=\"/static/52395ddcfedba26c997ee4dc17b6358c/fcda8/png.png\"\n        srcset=\"/static/52395ddcfedba26c997ee4dc17b6358c/12f09/png.png 148w,\n/static/52395ddcfedba26c997ee4dc17b6358c/e4a3f/png.png 295w,\n/static/52395ddcfedba26c997ee4dc17b6358c/fcda8/png.png 590w,\n/static/52395ddcfedba26c997ee4dc17b6358c/efc66/png.png 885w,\n/static/52395ddcfedba26c997ee4dc17b6358c/c83ae/png.png 1180w,\n/static/52395ddcfedba26c997ee4dc17b6358c/2aa89/png.png 1698w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> hoge\n <span class=\"token lisp-property property\">:magic</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\".PNG\"</span> <span class=\"token punctuation\">.</span> hoge-mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>こうすれば<code class=\"language-text\">.</code>が任意の1文字<code class=\"language-text\">(\\211)</code>にマッチするので対応できます。</p>\n<p>:magic-fallbackは拡張子がある場合はそちらを優先させるモード設定です。\nモード指定の優先順序は:magic>:mode>:magic-fallbackとなっているので拡張子で判定するやり方とも共存できます。</p>\n<h3>:demand</h3>\n<p>逆に必ず起動時に読みこませたい時には、遅延キーワードを書かないだけでは完全に遅延を止めることはできません。パッケージ自体のautoloadの効果により自動的に遅延ロードするようになってしまうので、これを阻止して必ず読み込ませるためのキーワードが:demandです。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> html-mode\n  <span class=\"token lisp-property property\">:demand</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>条件分岐</h2>\n<h3>:if, :when, :unless</h3>\n<p>.emacsファイルを複数のOSで使い回す時などに特定のOSの時のみにインストールしたいパッケージがあるかと思います。そこで条件分岐を行いtrueになった時のみロードさせることができます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> exec-path-from-shell\n  <span class=\"token lisp-property property\">:if</span> <span class=\"token punctuation\">(</span><span class=\"token car\">memq</span> window-system <span class=\"token punctuation\">'(</span><span class=\"token car\">mac</span> ns<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>依存関係</h2>\n<p>ivyなどのパッケージの機能を強化するプラグイン的なパッケージをロードする場合、前提として大元のパッケージがインストールされていなければなりません、そこで依存関係を記述し自身のパッケージを読む前に依存パッケージをロードさせることができます。</p>\n<h3>:requires</h3>\n<p>当該のuse-packageを読み込む直前のタイミングで依存パッケージもロードします。遅延を行なっている場合は当該のパッケージの読み込みタイミングに従います</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:requires</span> foo<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:requires</span> <span class=\"token punctuation\">(</span><span class=\"token car\">foo</span> bar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:after</h3>\n<p>当該のパッケージを指定のパッケージがロードされた後に続けてロードさせることができます。当該のuse-package句を読んだタイミングではなく、afterに指定したパッケージの読み込みタイミングまで当該パッケージの読み込みを遅延します。</p>\n<p>以下の例ではivyとhydraがどちらもロードされた直後のタイミングまで当該パッケージの読み込みを遅延します。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ivy-hydra\n  <span class=\"token lisp-property property\">:after</span><span class=\"token punctuation\">(</span><span class=\"token car\">ivy</span> hydra<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; もしくは</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ivy-hydra\n  <span class=\"token lisp-property property\">:after</span><span class=\"token punctuation\">(</span><span class=\"token lisp-property property\">:all</span> ivy hydra<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>以下の例ではivyもしくはhydraのどちらか一方がロードされた直後のタイミングになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ivy-hydra\n  <span class=\"token lisp-property property\">:after</span><span class=\"token punctuation\">(</span><span class=\"token lisp-property property\">:any</span> ivy hydra<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">:after(:any(:all A B) (:all C D))</code>のように:allと:anyを組み合わせることも可能です。\n</p>\n<h2>インストール元を指定する</h2>\n<p>配布されているリポジトリを指定したり、ローカルにあるパッケージをロードさせるための記述です。</p>\n<h3>:load-path</h3>\n<p>ローカルのファイルパスを指定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> my-package\n  <span class=\"token lisp-property property\">:load-path</span> <span class=\"token string\">\"~/emacs/my-package-dir\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:pin</h3>\n<p>パッケージを取得するリポジトリを指定できます。デフォルトではmelpaから取得し、melpaに存在しない場合はemacsに設定されているリポジトリを順次検索します。</p>\n<p>また、use-packageではなく手動でインストールしたパッケージもmanualを指定すればOKです。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> hoge\n  <span class=\"token lisp-property property\">:pin</span> gnu<span class=\"token punctuation\">)</span>\n  \n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> org\n  <span class=\"token lisp-property property\">:pin</span> manual<span class=\"token punctuation\">)</span></code></pre></div>\n<h2>モードライン</h2>\n<p>モードラインに表示するXX-modeの記述を消したり、変更したりできます。</p>\n<h3>:diminish</h3>\n<p>モードラインの表記を消すには:diminishにモード名を指定します。モードラインに表示されている名前でではなくモード名を指定します。大抵の場合はXX-modeという形を取っています。表示を変更することもできます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token comment\">;; 表示を消す</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:diminish</span> addrev-mode<span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; 表示を変更する</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:diminish</span> <span class=\"token punctuation\">(</span><span class=\"token car\">addrev-mode</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"AddR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:delight</h3>\n<p>diminish同様モードラインの表示を消したり変更したりできます。こちらの方が高機能？らしいです。こっちの方が記述が少なかったりマイナーモードに加えてメジャーモードの表示も変更できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token comment\">;; 表示を消す</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:delight</span> addrev-mode<span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; 表示を消す(短縮記法)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:delight</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; 表示を変更する</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> addrev\n  <span class=\"token lisp-property property\">:delight</span> <span class=\"token punctuation\">(</span><span class=\"token car\">addrev-mode</span> <span class=\"token string\">\"AddR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; 変数を利用して表示名を変更する</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> projectile\n  <span class=\"token lisp-property property\">:delight</span> <span class=\"token punctuation\">'(</span><span class=\"token lisp-property property\">:eval</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">concat</span> <span class=\"token string\">\" \"</span> <span class=\"token punctuation\">(</span><span class=\"token car\">projectile-project-name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>無効化</h2>\n<h3>:disabled</h3>\n<p>(use-package)句を全て無効化し、スキップします。:disabledをつけるとパッケージのロードのほか設定などすべての項目を評価しなくなります。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> hoge\n  <span class=\"token lisp-property property\">:disabled</span>\n  <span class=\"token lisp-property property\">:config</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">message</span> <span class=\"token quoted-symbol variable symbol\">'abcde</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>バイトコンパイル関連</h2>\n<h3>no-require</h3>\n<p>設定を書いているファイルをバイトコンパイルするとエラーでうまく動かなくなったとき用設定？</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> hoge\n  <span class=\"token lisp-property property\">:no-require</span>\n  <span class=\"token lisp-property property\">:config</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">message</span> <span class=\"token string\">\"hogeが読み込まれたタイミングで評価される\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>:defines, :functions</h3>\n<p>use-packageでは遅延ロード等で当該のパッケージが読み込まれた後にしか評価されない:configなどがありますが、バイトコンパイル時には遅延によりパッケージを読み込んでいないので未定義エラーになることがある様です。これを避けるため同名でダミーの変数、関数を宣言しておき、当該のパッケージをロードしたときに上書きする様にしておくことでエラーを回避するテクニックのようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ruby-mode\n  <span class=\"token lisp-property property\">:functions</span> inf-ruby-keys\n  <span class=\"token lisp-property property\">:config</span>\n  <span class=\"token punctuation\">(</span><span class=\"token defun\"><span class=\"token keyword\">defun</span> <span class=\"token function\">my-ruby-mode-hook</span> <span class=\"token punctuation\">(</span><span class=\"token arguments\"></span><span class=\"token punctuation\">)</span></span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">require</span> <span class=\"token quoted-symbol variable symbol\">'inf-ruby</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span><span class=\"token car\">inf-ruby-keys</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token car\">add-hook</span> <span class=\"token quoted-symbol variable symbol\">'ruby-mode-hook</span> <span class=\"token quoted-symbol variable symbol\">'my-ruby-mode-hook</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>use-packageのextension</h2>\n<p>通常のuse-packageには実装されていない機能を追加するパッケージがあります。別途extensionを読み込むことで追加機能が使えます。</p>\n<h3>use-package-chords</h3>\n<p>複数キーの同時押し、または単一キーの複数回押しをキーバインドに設定できます、内部的に<a href=\"http://www.emacswiki.org/emacs/key-chord.el\">key-chords</a>を利用しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> use-package-chords\n  <span class=\"token lisp-property property\">:ensure</span> <span class=\"token boolean\">t</span>\n  <span class=\"token lisp-property property\">:config</span> <span class=\"token punctuation\">(</span><span class=\"token car\">key-chord-mode</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> ace-jump-mode\n  <span class=\"token lisp-property property\">:chords</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jj\"</span> <span class=\"token punctuation\">.</span> ace-jump-char-mode<span class=\"token punctuation\">)</span>   <span class=\"token comment\">; jの2回押し</span>\n           <span class=\"token punctuation\">(</span><span class=\"token string\">\"jk\"</span> <span class=\"token punctuation\">.</span> ace-jump-word-mode<span class=\"token punctuation\">)</span>   <span class=\"token comment\">; j -> kの順で押した時</span>\n           <span class=\"token punctuation\">(</span><span class=\"token string\">\"jl\"</span> <span class=\"token punctuation\">.</span> ace-jump-line-mode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">; j -> lの順で押した時</span></code></pre></div>\n<h3>:ensure-system-package</h3>\n<p>依存関係があるのはemacsパッケージ間だけとは限りません、lspやprettierなど実行バイナリに依存しているパッケージもありますね。</p>\n<p>prettierコマンドがある時はパッケージをロードし、無い場合はOSのパッケージマネージャを用いてインストールを試みます。(macOSならhomebrew, ubuntuならapt)</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> use-package-ensure-system-package\n  <span class=\"token lisp-property property\">:ensure</span> <span class=\"token boolean\">t</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token comment\">;; rgコマンドがなければ brew install rg を試みます</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> rg\n  <span class=\"token lisp-property property\">:ensure-system-package</span> rg<span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; コマンド名とインストールの時に指定する名前が違う場合</span>\n<span class=\"token comment\">;; rgコマンドがなければ brew install ripgrep を試みます</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> rg\n  <span class=\"token lisp-property property\">:ensure-system-package</span> <span class=\"token punctuation\">(</span><span class=\"token car\">rg</span> <span class=\"token punctuation\">.</span> ripgrep<span class=\"token punctuation\">)</span>\n  \n<span class=\"token comment\">;; brewでは無いパッケージマネージャーを使う時</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> prettier-mode\n  <span class=\"token lisp-property property\">:ensure-system-package</span> <span class=\"token punctuation\">(</span><span class=\"token car\">prettier</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"npm install -g prettier\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>さらにコマンドでは無いアプリケーションでも大丈夫みたいです、使うかなこの機能？</p>\n<div class=\"gatsby-highlight\" data-language=\"lisp\"><pre class=\"language-lisp\"><code class=\"language-lisp\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">use-package</span> dash-at-point\n  <span class=\"token lisp-property property\">:if</span> <span class=\"token punctuation\">(</span><span class=\"token car\">eq</span> system-type <span class=\"token quoted-symbol variable symbol\">'darwin</span><span class=\"token punctuation\">)</span>\n  <span class=\"token lisp-property property\">:ensure-system-package</span>\n  <span class=\"token punctuation\">(</span><span class=\"token string\">\"/Applications/Dash.app\"</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"brew cask install dash\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>まとめ</h2>\n<p>とりあえずdocにあるものは全て書けたかなと思います。冗長になってしまいましたがこれでしばらくはuse-packageで迷うことはなさそうです。</p>\n<p>ここまで書いておいてアレ何ですが、use-packageを調べていて何度も見かけた<a href=\"https://qiita.com/conao3/items/dc88bdadb0523ef95878\">leaf.el</a>がとても気になっています。</p>"}