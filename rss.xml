<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[magcho's blog RSS Feed]]></title><description><![CDATA[magchoの日記とか思いつきを記録するブログ]]></description><link>https://blog.magcho.com</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 17 Sep 2022 19:16:52 GMT</lastBuildDate><item><title><![CDATA[M5Paper V1.1にPlatform.ioから書き込みをする]]></title><description><![CDATA[M5Paperの出荷時に書き込まれているファームウェアーをベースに機能を追加してみようと思い初期ファームウェアをvscode(platform.io)で開いたもののビルドできない&書き込めなくて困ったので解決方法をメモ 環境 MacOS Monterey…]]></description><link>https://blog.magcho.com/2022/5/m5_paper/</link><guid isPermaLink="false">https://blog.magcho.com/2022/5/m5_paper/</guid><pubDate>Sun, 08 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://switch-science.com/catalog/7359/&quot;&gt;M5Paper&lt;/a&gt;の出荷時に書き込まれているファームウェアーをベースに機能を追加してみようと思い&lt;a href=&quot;https://github.com/m5stack/M5Paper_FactoryTest&quot;&gt;初期ファームウェア&lt;/a&gt;をvscode(platform.io)で開いたもののビルドできない&amp;#x26;書き込めなくて困ったので解決方法をメモ&lt;/p&gt;
&lt;h2&gt;環境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MacOS Monterey&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ビルドエラー&lt;/h2&gt;
&lt;p&gt;初期ファームウェアのコード &lt;a href=&quot;https://github.com/m5stack/M5Paper_FactoryTest&quot;&gt;m5stack/M5Paper_FactoryTest&lt;/a&gt;  をクローンし、vscodeで開いた後、ビルドをするとエラーで完了しない。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;Building in release mode
Compiling &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;build&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_factorytest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cpp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;o
&lt;span class=&quot;token property&quot;&gt;src/frame/frame_factorytest.cpp:&lt;/span&gt; In member function &lt;span class=&quot;token string&quot;&gt;&apos;bool Frame_FactoryTest::checkGrove(int, int)&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_factorytest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cpp&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; call of overloaded &lt;span class=&quot;token string&quot;&gt;&apos;begin(int&amp;amp;, int&amp;amp;, int)&apos;&lt;/span&gt; is ambiguous
     Wire1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;begin&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;sda&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt;
                                &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;
In file included from &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;libdeps&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;M5EPD&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;M5EPD&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;h&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 from src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;h&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 from src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_factorytest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;h&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 from src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_factorytest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cpp&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token file-path string&quot;&gt;/Users/magcho/.platformio/packages/framework-arduinoespressif32/libraries/Wire/src/Wire.h&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;79&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; note&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; candidate&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bool TwoWire::begin(int, int, uint32_t)&apos;&lt;/span&gt;
     bool begin&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;int sda&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int scl&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; uint32_t frequency&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; returns &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; if successful init of i2c bus
          &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;
&lt;span class=&quot;token file-path string&quot;&gt;/Users/magcho/.platformio/packages/framework-arduinoespressif32/libraries/Wire/src/Wire.h&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; note&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; candidate&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bool TwoWire::begin(uint8_t, int, int, uint32_t)&apos;&lt;/span&gt;
     bool begin&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;uint8_t slaveAddr&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int sda&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int scl&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; uint32_t frequency&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;
&lt;span class=&quot;token separator comment&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;build&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;src&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;frame_factorytest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cpp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;o&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Error &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token separator comment&quot;&gt;===============================================================================&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;FAILED&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Took &lt;span class=&quot;token number&quot;&gt;4.85&lt;/span&gt; seconds &lt;span class=&quot;token separator comment&quot;&gt;===============================================================================&lt;/span&gt;
The terminal process &lt;span class=&quot;token string&quot;&gt;&quot;platformio &apos;run&apos;, &apos;--environment&apos;, &apos;m5stack-fire&apos;&quot;&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;terminated with exit code:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;おそらくこのコードが書かれた以後、i2cのライブラリのインターフェースが変更されたっぽいので今の状態に合わせてキャストしておく&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;frame_factorytest.cpp&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-cpp&quot;&gt;&lt;code class=&quot;language-diff-cpp&quot;&gt;&lt;span class=&quot;token unchanged language-cpp&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Frame_FactoryTest&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;checkGrove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sda&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; scl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token deleted-sign deleted language-cpp&quot;&gt;&lt;span class=&quot;token prefix deleted&quot;&gt;-&lt;/span&gt;    Wire1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sda&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token inserted-sign inserted language-cpp&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;    Wire1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sda&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token unchanged language-cpp&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; groveCheck &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これでビルドが通る。&lt;/p&gt;
&lt;h2&gt;書き込み&lt;/h2&gt;
&lt;p&gt;めでたくビルドができたのでデバイスに書き込もうとするとエラー&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;Building in release mode
Retrieving maximum program size &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;build&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;firmware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elf
Checking size &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;build&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;firmware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elf
Advanced Memory Usage is available via &lt;span class=&quot;token string&quot;&gt;&quot;PlatformIO Home &gt; Project Inspect&quot;&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;RAM:&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;used &lt;span class=&quot;token number&quot;&gt;45440&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;4521984&lt;/span&gt; bytes&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;Flash:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token separator comment&quot;&gt;===&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;32.8&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;used &lt;span class=&quot;token number&quot;&gt;2151237&lt;/span&gt; bytes from &lt;span class=&quot;token number&quot;&gt;6553600&lt;/span&gt; bytes&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
Configuring upload protocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;AVAILABLE:&lt;/span&gt; cmsis&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;dap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; esp&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;prog&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; espota&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; esptool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; iot&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;bus&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;jtag&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; jlink&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; minimodule&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; olimex&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;arm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;usb&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;ocd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; olimex&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;arm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;usb&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;ocd&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;h&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; olimex&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;arm&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;usb&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;tiny&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;h&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; olimex&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;jtag&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;tiny&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tumpa
&lt;span class=&quot;token property&quot;&gt;CURRENT:&lt;/span&gt; upload_protocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; esptool
Looking for upload port&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;Auto-detected:&lt;/span&gt; &lt;span class=&quot;token file-path string&quot;&gt;/dev/cu.usbmodem52D20507581&lt;/span&gt;
Uploading &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pio&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;build&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;m5stack&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;fire&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;firmware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bin
&lt;span class=&quot;token domain constant&quot;&gt;esptool.py&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;v3.3&lt;/span&gt;
Serial port &lt;span class=&quot;token file-path string&quot;&gt;/dev/cu.usbmodem52D20507581&lt;/span&gt;
Connecting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
Chip is ESP32&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;D0WDQ6&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;V3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;revision &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;Features:&lt;/span&gt; WiFi&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dual Core&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;240MHz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; VRef calibration in efuse&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Coding Scheme None
Crystal is &lt;span class=&quot;token number&quot;&gt;40MHz&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;MAC:&lt;/span&gt; &lt;span class=&quot;token mac-address constant&quot;&gt;08:3a:f2:66:ca:84&lt;/span&gt;
Uploading stub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token property&quot;&gt;A fatal error occurred:&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;Failed to write to target RAM (result was 01070000:&lt;/span&gt; Operation timed out&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token separator comment&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;upload&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Error &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token separator comment&quot;&gt;===============================================================================&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;FAILED&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Took &lt;span class=&quot;token number&quot;&gt;6.51&lt;/span&gt; seconds &lt;span class=&quot;token separator comment&quot;&gt;===============================================================================&lt;/span&gt;
The terminal process &lt;span class=&quot;token string&quot;&gt;&quot;platformio &apos;run&apos;, &apos;--target&apos;, &apos;upload&apos;, &apos;--environment&apos;, &apos;m5stack-fire&apos;&quot;&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;terminated with exit code:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最初はデバイスドライバーの不足を疑い&lt;a href=&quot;https://docs.m5stack.com/en/core/m5paper&quot;&gt;公式ページ&lt;/a&gt;からデバイスドライバーをインストールした。ドライバーは２種類あるが不安ならどっちもインストールせよと書いてあるのでどっちもインストールするも症状変わらず。&lt;/p&gt;
&lt;p&gt;ここでデバイス一覧を眺めるとM5Paperから&lt;code class=&quot;language-text&quot;&gt;usbmodemXXXXXX&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;wchusbserialXXXXXX&lt;/code&gt;の２種類のシリアルポートが生えてることに気がついた&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /dev &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; usb &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tty&lt;/span&gt;
tty.usbmodem52D20507581
tty.wchusbserial52D20507581&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;先ほどのエラーログを見る限り&lt;code class=&quot;language-text&quot;&gt;/dev/cu.usbmodemXXXXXXX&lt;/code&gt;を使おうとしてコケているので設定から&lt;code class=&quot;language-text&quot;&gt;/dev/wchusbserialXXXXXX&lt;/code&gt;を使うように指定してみる&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;platformio.ini&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;; PlatformIO Project Configuration File&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;   Build options: build flags, source filter&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;   Upload options: custom upload port, speed and extra flags&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;   Library options: dependencies, extra library storages&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;   Advanced options: extra scripting&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;; Please visit documentation for the other options and examples&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;; https://docs.platformio.org/page/projectconf.html&lt;/span&gt;

  &lt;span class=&quot;token section&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token section-name selector&quot;&gt;env:m5stack-fire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;platform&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;espressif32&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;m5stack-fire&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;framework&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;arduino&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;upload_speed&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;2000000&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;monitor_speed&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;115200&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;board_build.partitions&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;default_16MB.csv&lt;/span&gt;
  &lt;span class=&quot;token key attr-name&quot;&gt;build_flags&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 
 	&lt;span class=&quot;token key attr-name&quot;&gt;-DCORE_DEBUG_LEVEL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token value attr-value&quot;&gt;4&lt;/span&gt;
 	-DBOARD_HAS_PSRAM
 	-mfix-esp32-psram-cache-issue
  &lt;span class=&quot;token key attr-name&quot;&gt;lib_deps&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;
     m5stack/M5EPD
&lt;span class=&quot;token key attr-name&quot;&gt;+ upload_port&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/dev/cu.wchusbserialXXXXXXXXXXXXX&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これでuploadを押すと書き込めるようになった。&lt;/p&gt;
&lt;h2&gt;TODO&lt;/h2&gt;
&lt;p&gt;後でPR投げておくかな&lt;/p&gt;</content:encoded></item><item><title><![CDATA[3Dプリンターを買った]]></title><description><![CDATA[先日VoxelabのAquilaという3Dプリンターを購入しました。以前から欲しいな〜と思っていた3D printerを一人暮らしを始めたしいい機会だと思って購入してみました。3Dプリンター自体は初めてではなく、今まではfab施設の方に3D CAD…]]></description><link>https://blog.magcho.com/2022/5/3d_printer/</link><guid isPermaLink="false">https://blog.magcho.com/2022/5/3d_printer/</guid><pubDate>Fri, 06 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;先日VoxelabのAquilaという3Dプリンターを購入しました。以前から欲しいな〜と思っていた3D printerを一人暮らしを始めたしいい機会だと思って購入してみました。3Dプリンター自体は初めてではなく、今まではfab施設の方に3D CADのデータを送って出力作業はお任せしていたので実際に自分で印刷するのは初でした。&lt;/p&gt;
&lt;p&gt;Aquilaシリーズの一番廉価モデルで２万円のものなのであまり期待していなかったのですが、届いて組み立ててみるとかなりちゃんとしています。無骨なアルミフレームのフォルムにガラスプレートがついています。かっこいい&lt;/p&gt;
&lt;p&gt;試しにDEMOでついているデータを出力してみました。パラメーターの調整なしでもかなり綺麗に出力できています、２万円のプリンターすごい&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/681c76f5ee657ba021f5213cf8ef0959/d2602/3d_printer1.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABAAD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAwL/2gAMAwEAAhADEAAAAVBYUn1l1F//xAAaEAACAwEBAAAAAAAAAAAAAAAAAwECExIi/9oACAEBAAEFAmWipv6sjSWrhhhU6g//xAAXEQADAQAAAAAAAAAAAAAAAAAAARES/9oACAEDAQE/AViEP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAZEAADAQEBAAAAAAAAAAAAAAAAASEREBL/2gAIAQEABj8CosR6qFcwrfP/xAAaEAEAAwADAAAAAAAAAAAAAAABABEhMUFh/9oACAEBAAE/ITx7RDaBew6WnJNgvCBJYBgRU//aAAwDAQACAAMAAAAQhB//xAAXEQADAQAAAAAAAAAAAAAAAAAAESEx/9oACAEDAQE/EFVoh//EABcRAAMBAAAAAAAAAAAAAAAAAAABIVH/2gAIAQIBAT8Qom0//8QAHRABAQACAgMBAAAAAAAAAAAAAREAITFhQVFxkf/aAAgBAQABPxBGItC++8BuGOlTrLycmjzjKeqQb/cLLokC4K4T7n//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3d printer1&quot;
        title=&quot;3d printer1&quot;
        src=&quot;/static/681c76f5ee657ba021f5213cf8ef0959/1c72d/3d_printer1.jpg&quot;
        srcset=&quot;/static/681c76f5ee657ba021f5213cf8ef0959/a80bd/3d_printer1.jpg 148w,
/static/681c76f5ee657ba021f5213cf8ef0959/1c91a/3d_printer1.jpg 295w,
/static/681c76f5ee657ba021f5213cf8ef0959/1c72d/3d_printer1.jpg 590w,
/static/681c76f5ee657ba021f5213cf8ef0959/a8a14/3d_printer1.jpg 885w,
/static/681c76f5ee657ba021f5213cf8ef0959/fbd2c/3d_printer1.jpg 1180w,
/static/681c76f5ee657ba021f5213cf8ef0959/d2602/3d_printer1.jpg 4032w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;CAD&lt;/h2&gt;
&lt;p&gt;ネット上にあるデータを印刷して遊んでいたのですが、そろそろ自分で作りたくなってきました。ちょうど3D printerをお持ちの方にthinkerCADというweb appを教えていただいたのでこれで遊び始めました。&lt;/p&gt;
&lt;p&gt;しばらく遊んでいて思ったことは3D printerの印刷可能性といいますか、パソコンの上で自由に3Dデータを作るだけではダメで実際に積層していく段階で無理のない形にしておかないと出力できないということをよく考えないといけないなということです。&lt;/p&gt;
&lt;p&gt;今回購入した積層型のプリンターは素材を少しずつ溶かして積み重ねることで出力する方式なので空中に素材を出力することはできず、スライサーによってサポートをくっつける必要があります。このサポートがいざ出力してみるとポキポキ折れてしまいなかなか狙った通りの出力ができませんでした。サポートの形状や密度などを調整することで綺麗に出力することもできそうなのですが、今の自分にはスライサーソフトを調整するスキルがなくそれ以前の3D CAD時点で無理のない立体を作らないといけないな〜と考えるようになりました。&lt;/p&gt;
&lt;h2&gt;きっかけ&lt;/h2&gt;
&lt;p&gt;お散歩のお供にいろいろなポットキャストを聞いていて、そのうちの一つの&lt;a href=&quot;https://anchor.fm/image-cast/&quot;&gt;Image Cast&lt;/a&gt;のなかで&lt;a href=&quot;https://twitter.com/hashtag/%E7%94%9F%E6%B4%BB%E6%B2%BB%E5%85%B7&quot;&gt;#生活治具&lt;/a&gt;という話が出てきます。生活の一部を便利にするための治具のことらしいのです。このポッドキャストを聞き、このポッドキャストのあずまさんがツイートする治具の写真をみていると自分でもやってみたくなり購入を検討することにしました。&lt;/p&gt;
&lt;p&gt;一人暮らしにも慣れてきて、なんとなく不便なところがいくつか出てきたのでぼちぼち治具作りに挑戦中です。&lt;/p&gt;
&lt;h2&gt;refs&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://note.com/sngazm/n/n5da4f6dd830a&quot;&gt;引っ越し祝いに3Dプリンター(Original Prusa MINI+)を入手した / #生活治具 の話&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[M1 macでemacs-ngをビルドする]]></title><description><![CDATA[先日Intel mac向けにemacs-ngをビルドする記事を書きました。しばらく使ってみましたが深刻な問題が起こることもなく常用できそうだったのでM1 mac…]]></description><link>https://blog.magcho.com/2021/12/m1-emacsng/</link><guid isPermaLink="false">https://blog.magcho.com/2021/12/m1-emacsng/</guid><pubDate>Sat, 11 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;先日&lt;a href=&quot;/2021/10/emacs-ng/&quot;&gt;Intel mac向けにemacs-ngをビルドする記事&lt;/a&gt;を書きました。しばらく使ってみましたが深刻な問題が起こることもなく常用できそうだったのでM1 mac向けにもビルドして普段使いしたいと思った次第です。&lt;/p&gt;
&lt;h2&gt;ビルド手順&lt;/h2&gt;
&lt;p&gt;ビルドに必要な依存関係をドキュメントに従ってインストールします。&lt;a href=&quot;https://emacs-ng.github.io/emacs-ng/build/building/&quot;&gt;https://emacs-ng.github.io/emacs-ng/build/building/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;以下のコマンドでビルドします。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; gnutls texinfo autoconf zlib libgccjit jansson

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CPATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CPATH&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;brew --prefix libgccjit&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/include&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;LIBRARY_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LIBRARY_PATH&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;brew --prefix libgccjit&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/lib/gcc/11&quot;&lt;/span&gt;

./autogen.sh

./configure --with-json --with-native-compilation --with-modules --without-x --with-gnutls --with-xml2

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j8

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;今回は&lt;code class=&quot;language-text&quot;&gt;--with-native-compilation&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;--with-json&lt;/code&gt;を有効化します。jsonの方は&lt;code class=&quot;language-text&quot;&gt;libjansson&lt;/code&gt;をbrewでインストールし、configure時にオプションを渡してあげればOKです。&lt;/p&gt;
&lt;p&gt;native compilationの方は、現状コンパイラがlibgccjitのパスを見つけられないみたいなので、環境変数を利用してコンパイラにパスを渡しておけばビルドできます。&lt;/p&gt;
&lt;h2&gt;追記&lt;/h2&gt;
&lt;p&gt;インストール先を&lt;code class=&quot;language-text&quot;&gt;/opt/emacs-ng&lt;/code&gt;にしたかったので最近は以下のオプションでコンパイルしています&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;./configure &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --enable-locallisppath&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/opt/emacs-ng/share/site-lisp &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --infodir&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/opt/emacs-ng/share/info/emacs &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/opt/emacs-ng &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --with-json &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --with-native-compilation &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --with-modules &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --with-gnutls &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --with-xml2 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --without-x &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --without-ns &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --without-dbus &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --without-imagemagick &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
 --without-selinux&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Emacsのtabbar-modeをProjectごとに切り替える]]></title><description><![CDATA[EmacsにTabを追加するパッケージであるtabbar.elを使っています。このパッケージはBuffer名をエディタ上部に並べてくれる機能を提供します。 tabbar.elには標準でmajor modeごとにタブグループを作る機能があります、このグルーピングをproject…]]></description><link>https://blog.magcho.com/2021/10/tabbar-group/</link><guid isPermaLink="false">https://blog.magcho.com/2021/10/tabbar-group/</guid><pubDate>Tue, 19 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;EmacsにTabを追加するパッケージであるtabbar.elを使っています。このパッケージはBuffer名をエディタ上部に並べてくれる機能を提供します。&lt;/p&gt;
&lt;p&gt;tabbar.elには標準でmajor modeごとにタブグループを作る機能があります、このグルーピングをproject名(.gitディレクトリが入っているディレクトリ名)ごとにまとめてVSCodeのマルチウィンドウのように扱いたかったので以下のようにして解決しました。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;init.el&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elisp&quot;&gt;&lt;pre class=&quot;language-elisp&quot;&gt;&lt;code class=&quot;language-elisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;leaf&lt;/span&gt; tabbar
  &lt;span class=&quot;token lisp-property property&quot;&gt;:url&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://github.com/dholm/tabbar&quot;&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:defun&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;my/tabbar-buffer-groups&lt;/span&gt;
          projectile-project-name
          projectile-project-root&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:custom&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;tabbar-buffer-groups-function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;my/tabbar-buffer-groups&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:global-minor-mode&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:custom-face&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:init&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token defun&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;my/tabbar-buffer-groups&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token arguments&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;list&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;cond&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;;; check project name by projectile.el&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;projectile-project-name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;projectile-project-root&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;buffer-file-name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;current-buffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;;; fallback default name&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;default&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;projectile.elに依存しているので別途設定が必要です。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[GitHub Actionsのセルフホストランナーを試す]]></title><description><![CDATA[初めに GitHub Actionsには2000分/月の無料枠がありますがビジュアルテストなど時間がかかりそうなテストをたくさん回そうとすると足りなくなることがあります。GitHubが提供しているSelf hosted runner…]]></description><link>https://blog.magcho.com/2021/10/github_actions_selfhosted/</link><guid isPermaLink="false">https://blog.magcho.com/2021/10/github_actions_selfhosted/</guid><pubDate>Mon, 18 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;初めに&lt;/h2&gt;
&lt;p&gt;GitHub Actionsには2000分/月の無料枠がありますがビジュアルテストなど時間がかかりそうなテストをたくさん回そうとすると足りなくなることがあります。GitHubが提供しているSelf hosted runnerのエージェントを自前で用意したマシンに入れることで代わりの実行環境として利用できます。&lt;/p&gt;
&lt;h2&gt;VM&lt;/h2&gt;
&lt;p&gt;Oracle cloudのARMマシンが余っていたのでこのマシンたちを利用して構築しました。&lt;a href=&quot;https://docs.github.com/ja/actions/hosting-your-own-runners/about-self-hosted-runners#supported-architectures-and-operating-systems-for-self-hosted-runners&quot;&gt;セルフホストランナーをサポートするアーキテクチャとオペレーティングシステム&lt;/a&gt;に記載されているようにLinuxであればARMでも利用できます。&lt;/p&gt;
&lt;h2&gt;インストール&lt;/h2&gt;
&lt;p&gt;Jenkinsのようにマシンにエージェントをインストールしてから設定するのかと思いきや、まず最初に設定するリポジトリ/Organizationの設定画面からnew self-hosted runnerをクリックし、表示されるコマンドをマシンに入力していきます。&lt;/p&gt;
&lt;p&gt;このself-hosted runnerはエージェント側からGitHubに向けてのhttpsのロングポーリング&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;になっているのでIPの固定や外部からのネットワークを開けることなく利用できます。オフィスや自宅サーバーに優しいです。外から内向きの通信が必要ないのでFWで塞いでおきました。&lt;/p&gt;
&lt;h2&gt;運用&lt;/h2&gt;
&lt;p&gt;self-hosted runnerをActionsで利用するには&lt;code class=&quot;language-text&quot;&gt;runs-on: &apos;self-hosted&apos;&lt;/code&gt;とするかインストール時に付与したラベル名で利用できます。&lt;/p&gt;
&lt;p&gt;複数マシンに同一ラベルを付与しておけば&lt;code class=&quot;language-text&quot;&gt;runs-on: &apos;hoge-label&apos;&lt;/code&gt;で利用できます。同一ラベルが付与されたマシンのうちIdle状態のマシンに割り当てられます。何度か試してみたところ複数台がIdle状態であればマシンのうち一番若い名前が付与されたマシンから割り当てられるようです。&lt;/p&gt;
&lt;p&gt;多めにテスト回しそうだなと思ったときにマシンを追加で登録して、忙しい時期が過ぎたら追加で増やしたマシンを削除すれば良さそうです。ただ、GitHub上ではこのメトリクスが取れないので自前で監視のしくみを整える必要がありそうです。&lt;/p&gt;
&lt;h2&gt;雑感&lt;/h2&gt;
&lt;p&gt;Githubの通常の実行環境であれば毎回マシンが破棄されるで依存パッケージ等のキャッシュや、環境変数など気を遣う部分が多かったのですがセルフホストランナーではマシンの環境変数やフォルダーへのアクセスができるので対応しやすいです。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;&lt;a href=&quot;https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners#communication-between-self-hosted-runners-and-github&quot;&gt;https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners#communication-between-self-hosted-runners-and-github&lt;/a&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[emacs-ngをnative comp有効化してmacos向けにビルドした]]></title><description><![CDATA[https://github.com/emacs-ng/emacs-ng 先日emacs-ngという通常のEmacsをforkしRustのWebrenderとDenoのランタイムを加えたプロジェクトを見つけました。README…]]></description><link>https://blog.magcho.com/2021/10/emacs-ng/</link><guid isPermaLink="false">https://blog.magcho.com/2021/10/emacs-ng/</guid><pubDate>Mon, 11 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/14f7ba426532f6ee327dfc946d26b1fd/1b19f/emacs-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACGklEQVQoz53Sa2vTYBQH8HwLEdzM/Z7myf3WLE1smyZbuzmYlzk2dUN8oSIyYfjVlfOXplsRmXvhix/nnycnh5MQrj+8+vX6/Bqvz6/p1dk3Or34TueXN/Tuww+6uLqhk9OvdHTyibrV1dZieTloD97T8vgjPX/xeXD88gtxrj9DmC7Jj3s43gzWqIHtNmBBO7DZFKoxhqikkLUCil5A1nJIag5BTiGpGVSjxA4f4NFjCxwL5hSmK7CwI5vNaOS35HjzIW/qlFSjJN2qyLAnJKk5iWq2oWTD9XCmZCQoKXGuV9K4OkBVr2jSHKJqDlGUHZJshiBqECUzFOU+1j152SPJW/jhBGHcDPf9sEaczoYzL5iAU42CWNAPG7p+CzdYwI96eGEH3W5gjqYwnGdDNpwGNmuHVxblBKJyJ91mznYr0sw96E5OupNDs7J1hmplsNgYhlMMTHcMk42hWzkEKQb/D9yTp4zWH5eXYhLkBH/iH3jw79473M4wMLl34P+43XAz8KGNHhYRL0VD5XYFjyQtgawlJKkJyVpKsn4PLdlmad2rxBtqRrJWbH8fzpR6eKylLFnBtmrY1gShv0AU9gj8BQK/Qxzuw3PnCLwOcXQANprCEkpY/BhMP0bK3sI3zuDpb8DF+6Of8dJBsnRofjqhvaOMgs4kq+bJnYvkLkRyW5HYbV2za5HMSiK7kciuBbIbnqxaILPapd8U34AugRBd3AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;emacs 1&quot;
        title=&quot;emacs 1&quot;
        src=&quot;/static/14f7ba426532f6ee327dfc946d26b1fd/fcda8/emacs-1.png&quot;
        srcset=&quot;/static/14f7ba426532f6ee327dfc946d26b1fd/12f09/emacs-1.png 148w,
/static/14f7ba426532f6ee327dfc946d26b1fd/e4a3f/emacs-1.png 295w,
/static/14f7ba426532f6ee327dfc946d26b1fd/fcda8/emacs-1.png 590w,
/static/14f7ba426532f6ee327dfc946d26b1fd/efc66/emacs-1.png 885w,
/static/14f7ba426532f6ee327dfc946d26b1fd/1b19f/emacs-1.png 991w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/emacs-ng/emacs-ng&quot;&gt;https://github.com/emacs-ng/emacs-ng&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;先日emacs-ngという通常のEmacsをfork&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;しRustのWebrenderとDenoのランタイムを加えたプロジェクトを見つけました。READMEに記載されているように、完全な別プロジェクトというわけではなく定期的に本家のEmacsのmasterブランチの変更を取り込み、あくまでも現行のEmacsに新しいアイディアを付与するというプロジェクトらしいです。&lt;/p&gt;
&lt;p&gt;現在のemacs-ngは本家の2021年8月24日時点のmasterを取り込んでいるためネイティブコンパイルも利用できます。&lt;/p&gt;
&lt;p&gt;Ubuntu向けのバイナリであれば&lt;a href=&quot;https://github.com/emacs-ng/emacs-ng/releases&quot;&gt;GitHub Release&lt;/a&gt;で配布されていますが、MacOS向けのバイナリは配布されていないので自前でビルドする必要があります。ビルド方法は&lt;a href=&quot;https://emacs-ng.github.io/emacs-ng/build/building/#macos&quot;&gt;ドキュメントページ&lt;/a&gt;に記載されていますがPATHが足りないなどうまくビルドできなかったので&lt;a href=&quot;https://github.com/emacs-ng/emacs-ng/blob/master/.github/workflows/test.yml&quot;&gt;Github Actions&lt;/a&gt;を参考に以下の手順でビルドできました。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;build-maxos.sh&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;rustup &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; rust-toolchain&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;

cargo &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; cargo-cache --no-default-features --features ci-autoclean cargo-cache
cargo-cache

&lt;span class=&quot;token comment&quot;&gt;# brew install texinfo automake gnutls autoconf llvm libgccjit&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/usr/local/opt/llvm/bin:&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/bin:&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CPATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CPATH&lt;/span&gt;:/usr/local/Cellar/libgccjit/11.2.0/include&quot;&lt;/span&gt;

./autogen.sh

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/usr/lib/ccache:/usr/local/opt/ccache/libexec:&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;clang
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CXX&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;clang++
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CPP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;clang -E&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot; -g1 -O2&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CXXFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot; -g1 -O2&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;AR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ar
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;AS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-as
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;RANLIB&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;llvm-ranlib

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CARGO_INCREMENTAL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;RUSTFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Zshare-generics=y -Cdebuginfo=1 -Copt-level=0&quot;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CPLUS_INCLUD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;/usr/local/opt/llvm/bin/llvm-config --includedir&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;$CPLUS_INCLUDE_PATH&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;/usr/local/opt/llvm/bin/llvm-config --libdir&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;$LD_LIBRARY_PATH&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CFLAGS&lt;/span&gt; -march=native&quot;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;LDFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$LDFLAGS&lt;/span&gt; -L/usr/local/Cellar/libgccjit/11.2.0/lib/gcc/11&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CXXFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$CXXFLAGS&lt;/span&gt; -march=native -L/usr/local/Cellar/libgccjit/11.2.0/lib/gcc/11&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;RUSTFLAGS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$RUSTFLAGS&lt;/span&gt; -Ctarget-cpu=native&quot;&lt;/span&gt;

./configure --with-json --without-x --with-native-compilation

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; -j&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;nproc&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;makeコマンドによりrust部のコンパイル-&gt;emacs部のコンパイル(gcc)-&gt;lisp部のコンパイルが順に行われます。DenoはRust実装なので最初の段階でDeno runtimeがビルドされました。肝心のnative compはemacsの初回起動時に行われます、詳細は&lt;code class=&quot;language-text&quot;&gt;native compile log&lt;/code&gt;バッファに出力され、completeが表示されるまで20分ぐらい待ちました。&lt;/p&gt;
&lt;h2&gt;詰まりどころ&lt;/h2&gt;
&lt;p&gt;自分はemacsをターミナルでしか使わないのでGUI関連を全て無くした&lt;code class=&quot;language-text&quot;&gt;--without-x --without-ns&lt;/code&gt;をしたかったのですが、&lt;code class=&quot;language-text&quot;&gt;--without-ns&lt;/code&gt;オプションを付与するとrust実装部分のコンパイルが通りませんでした。issueなどをみる感じ他の方はビルドできるっぽいのですが自分の環境では断念。NextStepがある分バイナリサイズが大きくなりますが、特にそれ以外に不都合はないのでこのままにしました。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--with-native-compilation&lt;/code&gt;オブションを付与するとemacs部のコンパイル時に&lt;code class=&quot;language-text&quot;&gt;clang: error: linker command failed with exit code 1 (use -v to see invocation)&lt;/code&gt;で止まってしまいます。&lt;code class=&quot;language-text&quot;&gt;fatal error: &apos;libgccjit.h&apos; file not found&lt;/code&gt;となっており、コンパイラへPATHが通っていないようです。&lt;/p&gt;
&lt;p&gt;この類のPATHは&lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt;時にcheckされるはずで、実際に&lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt;のログ内でもlibgccjitにOKが付いています、なので原因わからず。とりあえずコンパイラにPATHを渡せればいいので&lt;a href=&quot;https://github.com/jimeh/build-emacs-for-macos/issues/20&quot;&gt;https://github.com/jimeh/build-emacs-for-macos/issues/20&lt;/a&gt; を参考にCFLAGS, LDFLAGS, LIBRARY_PATHにlibgccjitのPATHを付与してから&lt;code class=&quot;language-text&quot;&gt;./configure&lt;/code&gt;をやり直してめでたくビルド成功です。&lt;/p&gt;
&lt;h2&gt;さいご&lt;/h2&gt;
&lt;p&gt;Deno runtime機能を軽く触ってみた感想として、標準でTypeScriptを利用できること、WebWorkerをサクッと立てられることがとても快適です。&lt;/p&gt;
&lt;p&gt;emacs lispからは&lt;code class=&quot;language-text&quot;&gt;(eval-js &apos;xxx.js&apos;)&lt;/code&gt;のような形でDenoランタイムを呼び出します。Deno上ではグローバルスコープに&lt;code class=&quot;language-text&quot;&gt;lisp&lt;/code&gt;組み込みオブジェクトが追加されており、このオブジェクトに生えている関数を使ってDeno-&gt;emacsへの操作を行うようです。何も考えなくても非同期なのでDeno側で天気予報を取得するようなAPIを叩いたとして、APIのレスポンス待ちの間にemacsが固まるといったことはありません。すごい&lt;/p&gt;
&lt;p&gt;従来のelispでパッケージを書いていたときは非同期な処理を書くのが難しいと感じていたのでサクッとasync/awaitで書けるJSでemacsのパッケージが作れるようになるのは嬉しいです。vimにも似たアプローチのDenops.vimがありますがそちらは通常のvimのプラグインとしてDeno runtimeを入れられるのでemacs-ngに比べると手軽ですね。&lt;/p&gt;
&lt;p&gt;Denops.vimのパッケージをemacs-ngに移植したりといったことから始めてみようと思います。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;本家EmacsのforkのREmacsのforkのemacs-ng？&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[virtualBoxをアップデートした]]></title><description><![CDATA[昨日したらvirtualboxがアップデートできなかったので対応をメモ。 エラー文 VBoxUSBでエラーなので、類似事例を探すと以下のフォーラムが見つかった。
https://forum.macbidouille.com/index.php?showtopic=42033…]]></description><link>https://blog.magcho.com/2021/7/update-virtualbox/</link><guid isPermaLink="false">https://blog.magcho.com/2021/7/update-virtualbox/</guid><pubDate>Mon, 26 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;昨日&lt;code class=&quot;language-text&quot;&gt;brew update &amp;amp;&amp;amp; brew upgrade&lt;/code&gt;したらvirtualboxがアップデートできなかったので対応をメモ。&lt;/p&gt;
&lt;h2&gt;エラー文&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ brew upgrade
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Casks with &lt;span class=&quot;token string&quot;&gt;&apos;auto_updates&apos;&lt;/span&gt; or &lt;span class=&quot;token string&quot;&gt;&apos;version :latest&apos;&lt;/span&gt; will not be upgraded&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; pass &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;--greedy&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; to upgrade them.
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Upgrading &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; outdated package:
virtualbox &lt;span class=&quot;token number&quot;&gt;6.1&lt;/span&gt;.22,144080 -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6.1&lt;/span&gt;.24,145767
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Upgrading virtualbox
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Caveats
virtualbox requires a kernel extension to work.
If the installation fails, retry after you &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; it in:
  System Preferences → Security &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; Privacy → General

For &lt;span class=&quot;token function&quot;&gt;more&lt;/span&gt; information, refer to vendor documentation or this Apple Technical Note:
  https://developer.apple.com/library/content/technotes/tn2459/_index.html

&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Downloading https://download.virtualbox.org/virtualbox/6.1.24/VirtualBox-6.1.24-145767-OSX.dmg
Already downloaded: /Users/magcho/Library/Caches/Homebrew/downloads/df87b6f6114108c8ca37e767f9f6e0206aa4d1c8c9237a5de5548075abbc45fd--VirtualBox-6.1.24-145767-OSX.dmg
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Running uninstall script VirtualBox_Uninstall.tool

Welcome to the VirtualBox uninstaller script.

Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxUSB
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxNetFlt
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxNetAdp
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxDrv
No variant specified, falling back to release
And the following KEXTs will be unloaded:
    org.virtualbox.kext.VBoxUSB
    org.virtualbox.kext.VBoxDrv

And the traces of following packages will be removed:
    org.virtualbox.pkg.vboxkexts
    org.virtualbox.pkg.virtualbox
    org.virtualbox.pkg.virtualboxcli

The uninstallation processes requires administrative privileges
because some of the installed files cannot be removed by a normal
user. You may be prompted &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; your password now&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.

unloading org.virtualbox.kext.VBoxUSB
Executing: /usr/bin/kmutil unload -b org.virtualbox.kext.VBoxUSB
Error &lt;span class=&quot;token assign-left variable&quot;&gt;Domain&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;KMErrorDomain &lt;span class=&quot;token assign-left variable&quot;&gt;Code&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;UserInfo&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NSLocalizedDescription&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Kernel request failed: &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;libkern/kext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; kext is &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; use or retained &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cannot unload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;-603946984&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
An error occurred durning &lt;span class=&quot;token string&quot;&gt;&apos;sudo /sbin/kextunload -m org.virtualbox.kext.VBoxUSB&apos;&lt;/span&gt;, there should be a message above. &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
unloading org.virtualbox.kext.VBoxDrv
Executing: /usr/bin/kmutil unload -b org.virtualbox.kext.VBoxDrv
Error &lt;span class=&quot;token assign-left variable&quot;&gt;Domain&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;KMErrorDomain &lt;span class=&quot;token assign-left variable&quot;&gt;Code&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)&quot;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;UserInfo&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NSLocalizedDescription&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Kernel request failed: &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;libkern/kext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; kext is &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; use or retained &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cannot unload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;-603946984&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
An error occurred durning &lt;span class=&quot;token string&quot;&gt;&apos;sudo /sbin/kextunload -m org.virtualbox.kext.VBoxDrv&apos;&lt;/span&gt;, there should be a message above. &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Failed to unload one or &lt;span class=&quot;token function&quot;&gt;more&lt;/span&gt; KEXTs, please &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt; the machine to complete the uninstall.
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Purging files &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; version &lt;span class=&quot;token number&quot;&gt;6.1&lt;/span&gt;.24,145767 of Cask virtualbox

Error: virtualbox: Failure &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; executing&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;/usr/bin/sudo -E -- /usr/local/Caskroom/virtualbox/6.1.22,144080/VirtualBox_Uninstall.tool --unattended&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; exited with &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;. Here&lt;span class=&quot;token string&quot;&gt;&apos;s the output:

Welcome to the VirtualBox uninstaller script.

Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxUSB
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxNetFlt
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxNetAdp
No variant specified, falling back to release
Executing: /usr/bin/kmutil showloaded --list-only --bundle-identifier org.virtualbox.kext.VBoxDrv
No variant specified, falling back to release
And the following KEXTs will be unloaded:
    org.virtualbox.kext.VBoxUSB
    org.virtualbox.kext.VBoxDrv

And the traces of following packages will be removed:
    org.virtualbox.pkg.vboxkexts
    org.virtualbox.pkg.virtualbox
    org.virtualbox.pkg.virtualboxcli

The uninstallation processes requires administrative privileges
because some of the installed files cannot be removed by a normal
user. You may be prompted for your password now...

unloading org.virtualbox.kext.VBoxUSB
Executing: /usr/bin/kmutil unload -b org.virtualbox.kext.VBoxUSB
Error Domain=KMErrorDomain Code=71 &quot;Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)&quot; UserInfo={NSLocalizedDescription=Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)}
An error occurred durning &apos;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; /sbin/kextunload -m org.virtualbox.kext.VBoxUSB&lt;span class=&quot;token string&quot;&gt;&apos;, there should be a message above. (rc=71)
unloading org.virtualbox.kext.VBoxDrv
Executing: /usr/bin/kmutil unload -b org.virtualbox.kext.VBoxDrv
Error Domain=KMErrorDomain Code=71 &quot;Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)&quot; UserInfo={NSLocalizedDescription=Kernel request failed: (libkern/kext) kext is in use or retained (cannot unload) (-603946984)}
An error occurred durning &apos;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; /sbin/kextunload -m org.virtualbox.kext.VBoxDrv&apos;, there should be a message above. &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Failed to unload one or &lt;span class=&quot;token function&quot;&gt;more&lt;/span&gt; KEXTs, please &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt; the machine to complete the uninstall.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;VBoxUSBでエラーなので、類似事例を探すと以下のフォーラムが見つかった。
&lt;a href=&quot;https://forum.macbidouille.com/index.php?showtopic=420332&quot;&gt;https://forum.macbidouille.com/index.php?showtopic=420332&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;接続してるBluetoothデバイスを外すといいと書いてある。ほんとかよと思いながらも接続していたトラックパッドとマウスのBluetoothを設定からペアリング解除し接続しているUSBデバイスを全て外したのち、再起動し
&lt;code class=&quot;language-text&quot;&gt;brew update &amp;amp;&amp;amp; brew upgrade&lt;/code&gt;するとすんなりアップデートできた。&lt;/p&gt;
&lt;p&gt;Bluetoothのペアリングをやり直して今回は対応終了。&lt;/p&gt;
&lt;h2&gt;最後に&lt;/h2&gt;
&lt;p&gt;ザーッと検索したところ類似のエラーが起こっている人が少なかっので、自分が追加でインストールしているExtention Packに要因があるのかもしれないと思った。検証はしてないので予想。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[最近読んだ本]]></title><description><![CDATA[本を読んで誰かにおすすめしたくなったのに、いざ人に会うと本の名前を思い出せなくて困るのでここにメモしていきます。 Atomic Design: 堅牢で使いやすいUIを効率良く設計する https://www.amazon.co.jp/dp/477419705X…]]></description><link>https://blog.magcho.com/2021/7/book/</link><guid isPermaLink="false">https://blog.magcho.com/2021/7/book/</guid><pubDate>Sun, 18 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;本を読んで誰かにおすすめしたくなったのに、いざ人に会うと本の名前を思い出せなくて困るのでここにメモしていきます。&lt;/p&gt;
&lt;h2&gt;Atomic Design: 堅牢で使いやすいUIを効率良く設計する&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/477419705X&quot;&gt;https://www.amazon.co.jp/dp/477419705X&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;小さいところから段々と大きく考えていくAtomic Designの概念の説明に加えて、汎用性のあるコンポーネントの書き方などのサンプルコードがたくさん。&lt;/p&gt;
&lt;p&gt;発行年が2018年だからかStorybookのサンプルコードがほとんどビルドできないので自力でちょっと直す必要があるかも。&lt;/p&gt;
&lt;p&gt;今まではページの共通部分を切り出してコンポーネントにするぐらいにしか考えていなかったので、UIライブラリのような小さくたくさんのコンポーネントを作る経験がなかったので読んでいて学びが多かった。&lt;/p&gt;
&lt;h2&gt;みんなではじめるデザイン批評 - 目的達成のためのコラボレーション&amp;#x26;コミュニケーション改善ガイド&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B01J2OEYLU&quot;&gt;https://www.amazon.co.jp/dp/B01J2OEYLU&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;デザインの知見がない人がデザインに対してなんかしっくりこないをうまく伝えたり、デザイナー視点で非デザイナーにレビューを依頼するときの話とか。&lt;/p&gt;
&lt;p&gt;色々な役職の人を集めてレビュー会をしよう、レビュー会が意味のあるものになるように参加者に伝えておくべきことや、進め方などの話が出てくる。デザインの話というよりかは言語化が難しいモノの良し悪しだったり方針だったりの話し合いをどうファシリテートするかのTips集に感じた。&lt;/p&gt;
&lt;h2&gt;オブジェクト指向UIデザインオブジェクト指向UIデザイン-使いやすいソフトウェアの原理&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/4297113511&quot;&gt;https://www.amazon.co.jp/dp/4297113511&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;タスク思考と対照的なオブジェクト思考とは何かの解説がしっかりとしていて、誰でも読みやすそう。&lt;/p&gt;
&lt;p&gt;中編にてOOUIの設計手順（思考プロセス）の紹介をして後半では例を挙げながらその設計作業を見ていく感じ、Q&amp;#x26;Aのように進むので自分で考えながら読み進めることができる。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AxiosにJWTつけてレスポンスに型もつけたい]]></title><description><![CDATA[JWTを用いたAPIリクエストをするSPAをReactで作っていた中で、全てのAxiosのリクエストのヘッダーにJWTを付与してさらにレスポンスに型をつけたかった。 SPAからバックエンドサーバーに通信する際のリクエストヘッダーにを付与したく、さらにはJWT…]]></description><link>https://blog.magcho.com/2021/6/axios/</link><guid isPermaLink="false">https://blog.magcho.com/2021/6/axios/</guid><pubDate>Fri, 11 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;JWTを用いたAPIリクエストをするSPAをReactで作っていた中で、全てのAxiosのリクエストのヘッダーにJWTを付与してさらにレスポンスに型をつけたかった。&lt;/p&gt;
&lt;p&gt;SPAからバックエンドサーバーに通信する際のリクエストヘッダーに&lt;code class=&quot;language-text&quot;&gt;Bearer: {JWT}&lt;/code&gt;を付与したく、さらにはJWTの有効期限が切れている場合は勝手にJWTを更新した上でリクエストをする仕組みが欲しかった。&lt;/p&gt;
&lt;h2&gt;axiosのレスポンスに型をつける&lt;/h2&gt;
&lt;p&gt;Axiosの型定義を見ると&lt;code class=&quot;language-text&quot;&gt;AxiosResponce&amp;lt;T = any&gt;&lt;/code&gt;といった形でレスポンスの型情報&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;に型パラメータが使える。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  data&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 👈&lt;/span&gt;
  status&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  statusText&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  config&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosRequestConfig&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  request&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;しかし、Axiosは非同期的に使うと思うので&lt;code class=&quot;language-text&quot;&gt;await axios.get()&lt;/code&gt;の返り値は&lt;code class=&quot;language-text&quot;&gt;AxiosPromise&lt;/code&gt;ですが、以下のような型定義&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;なので同じとみなせます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AxiosPromise&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ということは、以下のようなコードがかけます。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;https://example.com/api/&lt;/code&gt;のレスポンスが以下の型である時&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApiResponceType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;リクエストするAxiosのコードは&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AxiosRequestConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AxiosResponce &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axios&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; responce &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ApiResponceType&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://example.com/api/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

responce&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token comment&quot;&gt;// ここの型がApiResponceTypeになる&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Bearerヘッダーを付与・JWTの有効期限も考慮する&lt;/h2&gt;
&lt;p&gt;axiosのインスタンスを作り、そこにBearerヘッダーを付与しておきます。さらにaxiosのrequest/responceにミドルウェア的に処理を挟み込める仕組みとしてinterrceptors&lt;sup id=&quot;fnref-4&quot;&gt;&lt;a href=&quot;#fn-4&quot; class=&quot;footnote-ref&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;があるので、これを用いてJWTの有効期限が切れていた時はJWTの更新・再リクエストをおこないます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AxiosResponse&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AxiosError&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AxiosRequestConfig &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;axios&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; apiClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;R&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;get&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;post&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  data&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  headers&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;requestConfig&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;undefined currentuser&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; jwtToken &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getJwtToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 👈 任意の方法で保持しているJWT&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; config&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosRequestConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;requestConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    method&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    headers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string-property property&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Bearer &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;jwtToken&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; customAxios &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; isRetry &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  customAxios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;interceptors&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;res&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosResponse&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AxiosError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; isRetry&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 👈 JWT有効期限切れかつ一回目のリクエストである時&lt;/span&gt;
        isRetry &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;refreshJwtToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; originalRequestConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; customAxios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;originalRequestConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 👈 再度リクエスト&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; customAxios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;



&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; responce &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apiClient&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ApiResponceType&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://example.com/api/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
responce&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data  &lt;span class=&quot;token comment&quot;&gt;// 👈 ApiResponceTypeの型がつく&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;&lt;a href=&quot;https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/index.d.ts#L83-L90&quot;&gt;https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/index.d.ts#L83-L90&lt;/a&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;&lt;a href=&quot;https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/index.d.ts#L101&quot;&gt;https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/index.d.ts#L101&lt;/a&gt;&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-4&quot;&gt;&lt;a href=&quot;https://axios-http.com/docs/interceptors&quot;&gt;https://axios-http.com/docs/interceptors&lt;/a&gt;&lt;a href=&quot;#fnref-4&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Cloud Batteryでバッテリー残量を確認する]]></title><description><![CDATA[バッテリー残量を確認したい ついこないだやっとBig Surにアップデートをしました。アップデートしてから気がついたんですがBig Sur…]]></description><link>https://blog.magcho.com/2021/4/cloudbattery/</link><guid isPermaLink="false">https://blog.magcho.com/2021/4/cloudbattery/</guid><pubDate>Sun, 11 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;バッテリー残量を確認したい&lt;/h2&gt;
&lt;p&gt;ついこないだやっとBig Surにアップデートをしました。アップデートしてから気がついたんですがBig Surはメニューバーにバッテリー残量の数値を出せなくなっていました。&lt;/p&gt;
&lt;p&gt;アイコンの満ち欠けでなんとなくの残量はわかりますし、マウスでクリックすれば数値を確認することはできるのですが常時表示されていないとなんとなく不安です。&lt;/p&gt;
&lt;p&gt;そこで以前利用していた&lt;a href=&quot;https://apps.apple.com/jp/app/battery-monitor-health-info/id836505650&quot;&gt;Battery Monitor&lt;/a&gt;を入れてバッテリー残量が20%を下回ったら通知バナーを出すように設定していました。しかし最近導入した大きめのディスプレイで作業していると右上の通知バナーに気がつかず、「いきなり画面が消えた！」と思って本体の画面を見たら赤い電池マークが点滅していることが何度もあり、どうにかしたかった。&lt;/p&gt;
&lt;h2&gt;Cloud Batteryで出来ること&lt;/h2&gt;
&lt;p&gt;探すと&lt;a href=&quot;https://apps.apple.com/jp/app/cloud-battery/id1481005137&quot;&gt;Cloud Battery&lt;/a&gt;というアプリを見つけました、これは単一のiCloudアカウントでログインしているデバイスに入れておけば全てのデバイスのバッテリー残量をiCloud越しに共有し、さらには通知もできるという素晴らしいアプリです。&lt;/p&gt;
&lt;p&gt;数多くのデバイスに対応し、自分の手持ちではmac, iPhone, iPad, Apple pencil, Apple Watch, MagicTrackpad 2のバッテリー情報を共有できました。AppStoreのスクリーンショットを見る限りAppleデバイスではなくても登録できるっぽいんですが手持ちのBluetoothイヤホンは登録できませんでした、残念。&lt;/p&gt;
&lt;p&gt;※追記LogicoolのERGO M575も対応していました。BluetoothイヤホンはIOSデバイスにペアリングしている時のみ対応していました。&lt;/p&gt;
&lt;p&gt;さらに、デバイス間で残量を共有しているのでmacのバッテリーが20%を下回ったときにApple WatchやiPhoneでpush通知を受け取ることができます。通知は指定値を下回ったら通知されるものに加え指定値を超えたときに通知することもできます。なので通常はApple Watchの充電完了通知はペアリングしているiPhoneしか通知が届きませんがこの機能により全てのデバイスでpush通知がきます。iPadで動画見てても気がつけるのはうれしい&lt;/p&gt;
&lt;h2&gt;Cloud Batteryを使う上で&lt;/h2&gt;
&lt;p&gt;とっても便利なCloud Batteryですが気にかけなければならない点がいくつかあります。&lt;/p&gt;
&lt;p&gt;１つ目はBluetoothを用いること。iosアプリで利用するときにbluetoothを切っていると、OS側からオンにしませんか？みたいなポップアップが出ます。オンにしておけば問題ないのですが、自分が使っているワイヤレスイヤホンが同時２つまでしかペアリングできないので、利用していない端末のBluetoothの新規接続をOFFにしているのでよくこのポップアップが出ますがそれ以外に実害はないので今のところ問題なさそう。&lt;/p&gt;
&lt;p&gt;２つ目はiCloud同期のタイミングがマチマチなところ。バッテリー残量が20%になったとの通知を受けとったのでmacを充電しようと思って見たら残り３％ぐらいになってて焦ったりします。同期はリアルタイムではない様子。１０分ぐらい遅れているな〜と思う時もあればほぼリアルタイムな時もありマチマチなので通知設定をするときは余裕を持っておいた方が良さそう。&lt;/p&gt;
&lt;p&gt;３つ目はmac版のアプリがよく落ちること。mac版は他のプラットフォームと違い常時起動させておく必要があります。なのでmacの設定からスタートアップに設定しています。macの起動と同時に必ずCloud Batteryも起動しているのですが、何時間か作業をしているといつの間にか落ちていることが何度かありました。AppStoreのレビューには動作が不安定というコメントがないのでおま環かもしれませんがこれは不便。なので自分が行った解決策も書いておきます。&lt;/p&gt;
&lt;h2&gt;Cloud Batteryを常時起動させたい&lt;/h2&gt;
&lt;p&gt;自分の手元でmac版のCloud Batteryがいつの間にか落ちていることがあるので、自動起動 and 落ちていたら自動的に起動するように設定しました。&lt;/p&gt;
&lt;p&gt;よくある&lt;code class=&quot;language-text&quot;&gt;systemctl&lt;/code&gt;を用いたデーモン化というやつなのですが、macには&lt;code class=&quot;language-text&quot;&gt;systemctl&lt;/code&gt;はなく、同様の機能を持った&lt;code class=&quot;language-text&quot;&gt;launchctl&lt;/code&gt;を用いて設定するようです。&lt;/p&gt;
&lt;p&gt;詳しいことは&lt;code class=&quot;language-text&quot;&gt;man&lt;/code&gt;コマンドから読めます&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; launchd
$ &lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; launchctl
$ &lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; launchd.plist&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;~/Library/LaunchAgents/&lt;/code&gt;ディレクトリに以下のplistを作り&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;/Users/{user_name}/Library/LaunchAgents/hoge.fuga.plist&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token prolog&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;/span&gt;
&lt;span class=&quot;token doctype&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;!&lt;/span&gt;&lt;span class=&quot;token doctype-tag&quot;&gt;DOCTYPE&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;plist&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;PUBLIC&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-//Apple//DTD PLIST 1.0//EN&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;plist&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1.0&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;KeepAlive&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Label&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;hoge.fuga.cloudbattery&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;ProgramArguments&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/Applications/Cloud Battery.app/Contents/MacOS/Cloud Battery&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;RunAtLoad&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;StartInterval&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;300&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;integer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;StandardErrorPath&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;StandardOutPath&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;plist&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ launchctl load ~/Library/LaunchAgents/com.hoge.fuga.plist&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;すれば設定完了です、コマンドを打ってすぐにアプリが起動しメニューバーに表示されます。あとは５分おきに起動を確認して、落ちていたら再起動し起動していたら何もしない挙動になります。&lt;/p&gt;
&lt;p&gt;これで快適なバッテリー管理が出来る！&lt;/p&gt;
&lt;h2&gt;plistメモ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;name&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;KeepAlive&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;cronのように定期実行なら&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; 常時起動なら&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;Label&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;識別名なので被らなければなんでも良い&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;ProgramArguments&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;起動したいバイナリを指定、&lt;code class=&quot;language-text&quot;&gt;〇〇.app&lt;/code&gt;はディレクトリなのでその中のバイナリーを指すようにする&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;RunAtLoad&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;スタートアップに登録するなら&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;StartInterval&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;単位は秒&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.alanyan.ca/CloudBattery/&quot;&gt;https://www.alanyan.ca/CloudBattery/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://news.mynavi.jp/article/20071211-iul01/resources/Leopard_launchd_newkeywords.pdf&quot;&gt;https://news.mynavi.jp/article/20071211-iul01/resources/Leopard_launchd_newkeywords.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://qiita.com/rsahara/items/7d37a4cb6c73329d4683&quot;&gt;https://qiita.com/rsahara/items/7d37a4cb6c73329d4683&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[SOAP APIを使ったメモ]]></title><description><![CDATA[今日においてWEB APIといえばREST or GraphQLといったところですが、他にもいろいろな方式が考案され普及し衰退していったようです。そんな中でも衰退した方のSOAPのAPIを使うことになったけど日本語情報が少なくて困ったので覚書です。 SOAPはRPC…]]></description><link>https://blog.magcho.com/2021/3/soap/</link><guid isPermaLink="false">https://blog.magcho.com/2021/3/soap/</guid><pubDate>Sat, 20 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今日においてWEB APIといえばREST or GraphQLといったところですが、他にもいろいろな方式が考案され普及し衰退していったようです。そんな中でも衰退した方のSOAPのAPIを使うことになったけど日本語情報が少なくて困ったので覚書です。&lt;/p&gt;
&lt;p&gt;SOAPはRPCの一種でネットワーク越しに何らかの関数を呼ぶような感覚で使えました。SOAPはRESTとは違い１つのエンドポイントに対して所定のXMLにて引数を組み立てPOSTなどで送ることで利用できます。&lt;/p&gt;
&lt;p&gt;この所定のXMLですがプロトコル上人間が組み立てるのではなくライブラリが自動でXMLを生成してやり取りすることを想定しているようです。なのでライブラリにこの定義を読み込ませるためのスキーマーとしてWSDLというものがあります、中身はXML形式でリクエストやレスポンスの形式が定義されておりAPIを提供しているサービス側から提供されています。（自分で作るものではなさそう）&lt;/p&gt;
&lt;p&gt;これはApache Axisの仕様によるものですが、WDSLがAPI提供側のドキュメントになくても&lt;code class=&quot;language-text&quot;&gt;https://{endpoint}?wsdl&lt;/code&gt;にアクセスすると取得できる場合があります。&lt;/p&gt;
&lt;p&gt;コーディングに入る前に、そもそもこのAPIが現存しているのかも確認したいので&lt;a href=&quot;https://www.soapui.org/&quot;&gt;SoapUI&lt;/a&gt;を用いて試すと良さそうです。&lt;/p&gt;
&lt;h2&gt;リクエスト&lt;/h2&gt;
&lt;p&gt;リクエストに情報を持たせる方法として２種類ありHTTPのheaderを用いるもの（protocol binding haeder）とbodyのSOAP message（SOAP Envelope）で送る方法があります。このどちらにもheaderという概念がありますがこれらは区別しなければならないようです。&lt;/p&gt;
&lt;h2&gt;SOAP message&lt;/h2&gt;
&lt;p&gt;呼び出す際のHTTPにXMLで呼び出したい内容を入れてリクエストすることで利用できます、フォーマットはWSDLから読み解くことができます。基本のフォーマットは&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;http://schemas.xmlsoap.org/soap/envelope/envelope&gt;
    &amp;lt;http://schemas.xmlsoap.org/soap/envelope/envelope/header&gt;
        ...
    &amp;lt;/http://schemas.xmlsoap.org/soap/envelope/envelope/header&gt;
    &amp;lt;http://schemas.xmlsoap.org/soap/envelope/envelope/body&gt;
        ...
    &amp;lt;/http://schemas.xmlsoap.org/soap/envelope/envelope/body&gt;
&amp;lt;/http://schemas.xmlsoap.org/soap/envelope/envelope&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ですがさすがに冗長なのでXMLのnamespaceという仕様により&lt;code class=&quot;language-text&quot;&gt;xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/code&gt;と宣言することで以下のように&lt;code class=&quot;language-text&quot;&gt;ENV&lt;/code&gt;などの任意の文字列をエイリアスとして利用するケースが多いようです。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;ENV:&lt;/span&gt;Envelope&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;ENV&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://schemas.xmlsoap.org/soap/envelope/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
   &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;ENV:&lt;/span&gt;Body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
   &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;ENV:&lt;/span&gt;Body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;ENV:&lt;/span&gt;Envelope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;※&lt;code class=&quot;language-text&quot;&gt;&amp;lt;Header&gt;~~&amp;lt;/Header&gt;&lt;/code&gt;は中身がなければ省略可能です。&lt;/p&gt;
&lt;h2&gt;cURLでSOAP APIを叩く&lt;/h2&gt;
&lt;p&gt;前提知識が多くRESTに比べると使いづらい印象ですが、RESTにくらべた利点としてSOAPはステートフルであることが挙げられるそうです。そのためセッションを自分で管理しながらAPIを叩くのは面倒なのでそういった場合はライブラリを利用したほうがいいですが、１回情報を問い合わせるぐらいであればライブラリを使わずにやりたいものです。&lt;/p&gt;
&lt;p&gt;呼び出すAPIのドキュメントに書いてあると思いますがhttpヘッダーには以下のものを設定しておきます&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;header&lt;/th&gt;
&lt;th&gt;value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Content-Type&lt;/td&gt;
&lt;td&gt;application/soap+xml;charset=UTF-8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Accept-Charset&lt;/td&gt;
&lt;td&gt;utf-8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SOAPAction&lt;/td&gt;
&lt;td&gt;{呼び出すサービス名}&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;そしてSOAP messageをxmlファイルとして保存し&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- message.xml --&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;soapenv:&lt;/span&gt;Envelope&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;xsi&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://www.w3.org/2001/XMLSchema-instance&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;xsd&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://www.w3.org/2001/XMLSchema&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; 
  &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;soapenv&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;http://schemas.xmlsoap.org/soap/envelope/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token attr-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;xmlns:&lt;/span&gt;req&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://example.com/req/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;soapenv:&lt;/span&gt;Header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;soapenv:&lt;/span&gt;Body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;req:&lt;/span&gt;zipcode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            100-0001
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;req:&lt;/span&gt;zipcode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;soapenv:&lt;/span&gt;Body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;      
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token namespace&quot;&gt;soapenv:&lt;/span&gt;Envelope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;curlで呼び出します&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; https://endpoint.example.com/ &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -H &lt;span class=&quot;token string&quot;&gt;&apos;Content-Type: application/soap+xml;charset=UTF-8&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -H &lt;span class=&quot;token string&quot;&gt;&apos;Accept-Charset: utf-8&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -H &lt;span class=&quot;token string&quot;&gt;&apos;SOAPAction: zipcode&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  -d @message.xml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このような形でライブラリを利用しなくてもSOAPのAPIが叩けます。各種言語のcurlの記述に合わせて似たようなことをすればRESTのように気軽に利用できるのではないでしょうか？&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Gatsby.jsをv3に更新した]]></title><description><![CDATA[2021年3月にGatsby.jsのv3がリリースされました、多少の破壊的な変更はあるもののv1からv2の時ほどの苦労はなくアップデートできた気がします。 いくつか進化がありますが、一番にビルド速度が一段と早くなった気がします。HotReload…]]></description><link>https://blog.magcho.com/2021/3/gatsby-v3/</link><guid isPermaLink="false">https://blog.magcho.com/2021/3/gatsby-v3/</guid><pubDate>Sun, 14 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;2021年3月にGatsby.jsのv3がリリースされました、多少の破壊的な変更はあるもののv1からv2の時ほどの苦労はなくアップデートできた気がします。&lt;/p&gt;
&lt;p&gt;いくつか進化がありますが、一番にビルド速度が一段と早くなった気がします。HotReloadが特に早くなりエディタからブラウザに画面を切り替えるとすでにリロードされており待ち時間が無くなっているように感じます、すごい。さらにはブラウザ上にエラーメッセージがモーダルでしっかり表示されるようになりました。これで開発も一段と楽になった気がします。また、いよいよincremental buildが正式に使えるようになりました。deployにかかる時間が大幅に短縮されるのではないでしょうか。&lt;/p&gt;
&lt;p&gt;v2からv3への更新にあたっていくつかの破壊的な更新があるため多少修正しないとビルドが通りませんでした。内容は公式の&lt;a href=&quot;https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v2-to-v3/#updating-your-dependencies&quot;&gt;マイグレーションガイド&lt;/a&gt;に従えばOKでした。&lt;/p&gt;
&lt;p&gt;また、v2の時にもいろいろなアップデートがあり推奨される記法が変わっていたのでこれらも修正していきます。&lt;/p&gt;
&lt;h2&gt;更新作業&lt;/h2&gt;
&lt;p&gt;まずはnpmでGatsby.jsをアップデートします。これはnpm7の仕様変更によるものですがpeer dependencies周りでエラーになったので&lt;code class=&quot;language-text&quot;&gt;npm install gatsby@latest --legacy-peer-deps&lt;/code&gt;オプション付きで更新します。&lt;/p&gt;
&lt;p&gt;次にgraphql関係のimportを修正しました。&lt;a href=&quot;https://www.gatsbyjs.com/docs/reference/release-notes/migrating-from-v2-to-v3/#using-a-global-graphql-tag-for-queries&quot;&gt;マイグレーションガイド&lt;/a&gt; にも書いてありますが&lt;code class=&quot;language-text&quot;&gt;graphql&lt;/code&gt;がグローバルではなくなったのでインポート文を追加しておきます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-js&quot;&gt;&lt;code class=&quot;language-diff-js&quot;&gt;&lt;span class=&quot;token inserted-sign inserted language-js&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; graphql &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;また、まだv3になりたてだからか有名どころのGatsby.jsのプラグインでも未対応なものが多い印象です。(gatsby-transformer-remarkとか)インストール時やビルド時に未対応である旨のwarningが出ますが自分の環境では今のところ問題なくビルドできます。&lt;/p&gt;
&lt;p&gt;自分の環境ではこの修正だけでビルドが通るようになりました。楽チン！しかしマイグレーションガイドにもあるようにv3で非推奨になりv4で削除する記法が多くありますのでさらに対応していきます。&lt;/p&gt;
&lt;p&gt;１年ほど前はステートのあるcomponentはclass記法で書いていましたがいつの間にかReact.jsに追従したのかfunction記法になっていました。以下のように修正していきます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// class記法(v2)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; defalut &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HogeComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; blogTitle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;site&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;siteMetadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	    blog title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;blogTitle&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hogeQuery &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; graphql&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;
  query {
    site {
      siteMetadata {
        title
      }
    }
  }
&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;


&lt;span class=&quot;token comment&quot;&gt;// funciton記法(v3)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; graphql &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;gatsby&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; defalut &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;HogeComponent&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; blogTitle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;site&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;siteMetadata
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      blog title&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;blogTitle&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; hogeQuery &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; graphql&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;
  query {
    site {
      siteMetadata {
        title
      }
    }
  }
&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;次は&lt;code class=&quot;language-text&quot;&gt;useStaticQuery&lt;/code&gt;に対応します。今までは&lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt;から直接呼ばれていたpage componentだけがgraphqlを通じてデータをfetchしていました。そこから呼ばれるcomponentへはpropsを用いたバケツリレーをしていましたが&lt;code class=&quot;language-text&quot;&gt;useStaticQuery&lt;/code&gt;が登場したことによりpage componentに似た記法でcomponent自身がデータをfetchできるようになりました&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; 。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useStaticQuery&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; graphql &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;gatsby&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;FugaComponent&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; site &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useStaticQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;graphql&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;
	query {
	  site {
	    siteMetadata {
		  title
		}
	  }
	}
  &lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; siteTitle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; site&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sitemetadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title
  
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;siteTitle&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Incremental Build&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.com/docs/reference/release-notes/v3.0/#incremental-builds-in-oss&quot;&gt;リリースノート&lt;/a&gt;に書いてありますが、incremental buildがデフォルトで有効化されました。&lt;code class=&quot;language-text&quot;&gt;/.cache/&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;/public/&lt;/code&gt;ディレクトリの内容を２回目以降のビルドで再利用するようになりビルド時間が短縮されました。デプロイフローにてこれらのキャッシュを破棄しないように修正する必要がありそうです。&lt;/p&gt;
&lt;p&gt;このブログは現状Netlifyでbuild and deployをしていますがビルドが遅いのが気になっていました。Netlifyのbuild環境はRuby/Python/Go/Rusy/Node..などなどたくさんのランタイムをインストールした後にビルドを始めるので時間がかかります、なのでGithub Actionsに乗り換えることを検討中です。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;StaticQueryという物を利用すれば今までもcomponent自身でfetchできていたようです。知らなかった。&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[MySQL, Nginx(Openresty)で動的リバースプロキシ]]></title><description><![CDATA[開発検証のために本番環境ドメイン(example.com)のサブドメインに PR 名を付与した(PR-1.example.com)を staging 環境として公開した手順メモ 今回は 1 台の VPS 内に Jenkins を用い PR 数分の docker-compose…]]></description><link>https://blog.magcho.com/2021/1/reverse_proxy/</link><guid isPermaLink="false">https://blog.magcho.com/2021/1/reverse_proxy/</guid><pubDate>Sun, 24 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;開発検証のために本番環境ドメイン(example.com)のサブドメインに PR 名を付与した(PR-1.example.com)を staging 環境として公開した手順メモ&lt;/p&gt;
&lt;p&gt;今回は 1 台の VPS 内に Jenkins を用い PR 数分の docker-compose コンテナ群を作り、空いている任意のポートに公開したのち Nginx を用いて{PR 名}.example.com へのアクセスを 127.0.0.1:{公開中のポート}にリバースプロキシしていきます。&lt;/p&gt;
&lt;h2&gt;概要&lt;/h2&gt;
&lt;p&gt;vps 内で稼働している DB に以下のようにサブドメインと port 番号のペアを登録しておき、これらを Nginx から読み込んで&lt;code class=&quot;language-text&quot;&gt;PR-16.example.com&lt;/code&gt;へのアクセスを&lt;code class=&quot;language-text&quot;&gt;127.0.0.1:49161&lt;/code&gt;へ転送する。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;mysql&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; rpx&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;-----------+-------+&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; subdomain &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; port  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;-----------+-------+&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; PR&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;49161&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; PR&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;49162&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; PR&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;49164&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;-----------+-------+&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;rows&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.00&lt;/span&gt; sec&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;構成&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ubuntu18.04.5&lt;/li&gt;
&lt;li&gt;Nginx(Openresty)&lt;/li&gt;
&lt;li&gt;lua-nginx-module&lt;/li&gt;
&lt;li&gt;mysql-nginx-module&lt;/li&gt;
&lt;li&gt;MySQL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nginx 動的リバースプロキシで検索すると Redis を用いた例が多く出てくる。今回は検証環境なのでアクセス数や処理性能は考えなくていいので手軽に MySQL にした。&lt;/p&gt;
&lt;h2&gt;手順&lt;/h2&gt;
&lt;h3&gt;Openresty のセットアップ&lt;/h3&gt;
&lt;p&gt;Nginx の config ファイル内に Lua を用いて MySQL へのアクセス処理を記述する。通常の&lt;code class=&quot;language-text&quot;&gt;apt install nginx&lt;/code&gt;でインストールできる Nignx には lua-module が含まれていないので自分で Nginx をビルドし直すか諸モジュールが含まれる Openresty ビルド版をインストールする必要がある。今回は既存の Nginx を止め Openresty をインストールした。手順は&lt;a href=&quot;https://openresty.org/en/linux-packages.html#ubuntu&quot;&gt;Openresty document&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;この VPS では別の web アプリケーションを動かしていたので、その設定を Nginx から引き継ぐために Openresty の設定を変更する。&lt;code class=&quot;language-text&quot;&gt;/usr/local/openresty/nginx/conf/nginx.conf&lt;/code&gt;が最初に読み込まれる設定ファイル。デフォルトの設定のうち必要ない server 部をコメントアウトし、既存の Nignx の設定を読みにいくように末尾に&lt;code class=&quot;language-text&quot;&gt;include /usr/local/openresty/nginx/conf/conf.d/*.conf;&lt;/code&gt;を書き加えシンボリックリンクを貼る&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;/usr/local/openresty/nginx/conf/nginx.conf&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-conf&quot;&gt;&lt;code class=&quot;language-diff-conf&quot;&gt;~~~~
&lt;span class=&quot;token unchanged&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;   # HTTPS server
&lt;/span&gt;&lt;span class=&quot;token inserted-sign inserted&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #server {
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    listen       443 ssl;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    server_name  localhost;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_certificate      cert.pem;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_certificate_key  cert.key;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_session_cache    shared:SSL:1m;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_session_timeout  5m;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_ciphers  HIGH:!aNULL:!MD5;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    ssl_prefer_server_ciphers  on;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    location / {
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #        root   html;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #        index  index.html index.htm;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #    }
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   #}
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;   include /usr/local/openresty/nginx/conf/conf.d/*.conf;
&lt;/span&gt;&lt;span class=&quot;token unchanged&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;}
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -s /etc/nginx/conf.d /usr/local/openresty/nginx/conf/conf.d/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;設定変更後 Openresty を有効化して動作を確認する。&lt;/p&gt;
&lt;h3&gt;MySQL の準備&lt;/h3&gt;
&lt;p&gt;subdomain と port の対応を示すための DB を作りアクセスする用のユーザーも作る&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;database&lt;/span&gt; databasename&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;username&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@&apos;localhost&apos;&lt;/span&gt; IDENTIFIED &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;password&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;GRANT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; databasename&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;username&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@&apos;localhost&apos;&lt;/span&gt; IDENTIFIED &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;password&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; tablename&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;subdomain &lt;span class=&quot;token keyword&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;KEY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; port &lt;span class=&quot;token keyword&quot;&gt;INT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nginx からは DB の読みとり権限だけ必要なので当該ユーザーに SELECT 権限を与えておきます。別途転送したいサブドメインと port 番号を insert する処理を作っておきましょう。&lt;/p&gt;
&lt;h3&gt;Nginx の設定ファイルへの Lua スクリプトの記述&lt;/h3&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;/etc/nginx/conf.d/hoge.conf&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;server{
listen 443 ssl;
	server_name ~^(?&amp;lt;subdomain&amp;gt;[^\.]+).example.com$;
	location / {
		proxy_set_header X-Forwarded-Host $host:$server_port;
		proxy_set_header X-Forwarded-Proto $scheme;
		set $localport &amp;quot;&amp;quot;;
		rewrite_by_lua &amp;#39;
			local mysql = require &amp;quot;resty.mysql&amp;quot;

			local db, err = mysql:new()
			if not db then
				ngx.say(&amp;quot;failed to instantiate mysql: &amp;quot;, err)
				return
			end
			local ok, err, errcode, sqlstate = db:connect{
				host = &amp;quot;127.0.0.1&amp;quot;,
				port = 3306,
				database = &amp;quot;databasename&amp;quot;,
				user = &amp;quot;username&amp;quot;,
				password = &amp;quot;password&amp;quot;,
				charset = &amp;quot;utf8&amp;quot;,
				max_packet_size = 1024 * 1024,
			}
			if not ok then
				ngx.log(ngx.ERR, &amp;quot;failed to connect: &amp;quot;, err, &amp;quot;: &amp;quot;, errcode, &amp;quot; &amp;quot;, sqlstate)
				return ngx.exit(500)
			end

			res, err, errcode, sqlstate = db:query(&amp;quot;select port from tablename where subdomain = \&amp;#39;&amp;quot; ..ngx.var.subdomain.. &amp;quot;\&amp;#39; limit 1;&amp;quot;)
			if not res then
				ngx.log(ngx.ERR, &amp;quot;bad result #1: &amp;quot;, err, &amp;quot;: &amp;quot;, errcode, &amp;quot;: &amp;quot;, sqlstate, &amp;quot;.&amp;quot;)
				return ngx.exit(404)
			else
				ngx.var.localport = res[1][&amp;quot;port&amp;quot;]
			end
		&amp;#39;;
		proxy_pass http://127.0.0.1:$localport;
		break;
	}
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;server 部の server_name で&lt;code class=&quot;language-text&quot;&gt;~^(?&amp;lt;subdomain&gt;[^\.]+).example.com$;&lt;/code&gt;としてサブドメインに subdomain という名前をつけてマッチしておくと後続の処理で変数として利用することができる。&lt;/p&gt;
&lt;p&gt;lua から Nginx conf の変数を参照・代入することができる。しかし lua で新しい変数を宣言することはできないので先に変数&lt;code class=&quot;language-text&quot;&gt;localport&lt;/code&gt;を宣言しておくと lua から&lt;code class=&quot;language-text&quot;&gt;ngx.env.localport&lt;/code&gt;でアクセスできる。&lt;/p&gt;
&lt;p&gt;db:query()に SQL クエリを入れて実行する。Lua の結合演算子&lt;code class=&quot;language-text&quot;&gt;..&lt;/code&gt;を利用できます。クエリの実行結果は&lt;code class=&quot;language-text&quot;&gt;res&lt;/code&gt;に２次元の配列(table)で返却されます。Lua は 1 based index な言語なので最初の要素の index は 1 です、クエリに&lt;code class=&quot;language-text&quot;&gt;limit 1&lt;/code&gt;をかけているので&lt;code class=&quot;language-text&quot;&gt;res[1][&apos;port&apos;]&lt;/code&gt;で転送すべき port 番号が分かります。なのでこの番号に&lt;code class=&quot;language-text&quot;&gt;proxy_pass&lt;/code&gt;すれば OK です。&lt;/p&gt;
&lt;h2&gt;おまけ&lt;/h2&gt;
&lt;p&gt;サブドメインが可変なので https にするには毎回発行・無効化せずワイルドカード証明書を当てておきます。ワイルドカード証明書は DNS 認証しかできないので&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; certbot certonly &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --manual &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --domain *.example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --email mail@example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --agree-tos &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --manual-public-ip-logging-ok &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  --preferred-challenges dns&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;表示された文字列をネームサーバの TXT レコードに登録し認証すれば OK。&lt;/p&gt;
&lt;p&gt;自動更新するにはネームサーバーのレコード登録を自動化する必要があり外部 API に対応したネームサーバにすると良さそうです。&lt;/p&gt;
&lt;h2&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.ssrf.in/post/2017-08-09-dynamic-reverse-proxy-with-nginx/&quot;&gt;https://blog.ssrf.in/post/2017-08-09-dynamic-reverse-proxy-with-nginx/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/openresty/lua-nginx-module&quot;&gt;https://github.com/openresty/lua-nginx-module&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/openresty/lua-resty-mysql&quot;&gt;https://github.com/openresty/lua-resty-mysql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Bug Shooting Challenge #5 ONLINEに参加させていただきました]]></title><description><![CDATA[イベントについて 先週Bug Shooting Challenge #5 ONLINEに参加させてただきました。 問題の背景としては、すでにリリースされているwebゲームのCRE…]]></description><link>https://blog.magcho.com/2020/12/bug-shooting-challenge/</link><guid isPermaLink="false">https://blog.magcho.com/2020/12/bug-shooting-challenge/</guid><pubDate>Thu, 24 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;イベントについて&lt;/h2&gt;
&lt;p&gt;先週&lt;a href=&quot;https://mixi.connpass.com/event/193415/&quot;&gt;Bug Shooting Challenge #5 ONLINE&lt;/a&gt;に参加させてただきました。&lt;/p&gt;
&lt;p&gt;問題の背景としては、すでにリリースされているwebゲームのCREチームとして配属され、ユーザーからのお問い合わせや社内の調査チームからの報告を元にバグを探していくというものです。&lt;/p&gt;
&lt;p&gt;お題のゲームはRailsで作られており、コードとdocker-compose.ymlが入ったgitリポジトリーを渡されます。さらに、サーバーのログがBigQueryに蓄積されているので、参考にできます。&lt;/p&gt;
&lt;p&gt;問題は全3問あり、ペアでチームを組みそれぞれで問題に取り掛かります。ログを解析をした経験もBigQueryを使った経験もなかったのでチュートリアル問題で何から初めていいかわからず心が折れそうになりますが、露骨なヒントも頂けるので&lt;strong&gt;何にも分からん&lt;/strong&gt;ことにはならないので安心です。&lt;/p&gt;
&lt;p&gt;今回のイベントはチーム対抗戦です、バグを探す・issueに原因を報告する・コード修正のPRを出すことで完答です。もちろんヒントが出る前に自力でバグを見つけられるとプラスになります。&lt;/p&gt;
&lt;h2&gt;ノベルティー&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4c84e069589ed85ff9d47841d4a438e2/9568a/bug-novelty.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAQT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAP/2gAMAwEAAhADEAAAAZGI5rhxA0//xAAaEAEBAAIDAAAAAAAAAAAAAAACAQMEABIj/9oACAEBAAEFArVmaPXmvseZdMqNx4JKP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAB/9oACAECAQE/AVf/xAAcEAACAgIDAAAAAAAAAAAAAAAAASExAhEiQZH/2gAIAQEABj8CeT9LOdjXTEtSiUf/xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMVHR/9oACAEBAAE/IVhVeqZOortlq/YenHSGWid+y2WNz//aAAwDAQACAAMAAAAQvx//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QTH//xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQIBAT8QbcC7/8QAHBABAAIDAQEBAAAAAAAAAAAAAREhADFRgXGR/9oACAEBAAE/EHINUoYoqjVGE9jbGRqeeTYgh/Mk7RHaePmKlkAsTO3rh8xbMLvhn//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ノベルティー&quot;
        title=&quot;ノベルティー&quot;
        src=&quot;/static/4c84e069589ed85ff9d47841d4a438e2/1c72d/bug-novelty.jpg&quot;
        srcset=&quot;/static/4c84e069589ed85ff9d47841d4a438e2/a80bd/bug-novelty.jpg 148w,
/static/4c84e069589ed85ff9d47841d4a438e2/1c91a/bug-novelty.jpg 295w,
/static/4c84e069589ed85ff9d47841d4a438e2/1c72d/bug-novelty.jpg 590w,
/static/4c84e069589ed85ff9d47841d4a438e2/a8a14/bug-novelty.jpg 885w,
/static/4c84e069589ed85ff9d47841d4a438e2/fbd2c/bug-novelty.jpg 1180w,
/static/4c84e069589ed85ff9d47841d4a438e2/9568a/bug-novelty.jpg 3024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;オリジナルパーカーとおやつ・ステッカーを開催前に送っていただきました。嬉しい&lt;/p&gt;
&lt;p&gt;おやつにはロゴが入っておりノベルティーへの熱が伝わってきます。イベント前にいただいたのでますます当日が楽しみになってきました。&lt;/p&gt;
&lt;h2&gt;オンライン&lt;/h2&gt;
&lt;p&gt;期間中はRemoをずーっと繋いで互いの画面を共有し、あーだこーだ言いながら進めていきます。Remoは複数の人が同時に画面共有できて便利ですね。&lt;/p&gt;
&lt;p&gt;今回ペアになった方とは当日初めましてだったので不安でしたが、同い年ということもあり楽しく進められてよかったです。すごい人でした&lt;/p&gt;
&lt;h2&gt;競技&lt;/h2&gt;
&lt;p&gt;1問あたり1時間ちょっとぐらいの全３問。各問題終了後ごとに答え解説があるのでチームの２人で「なるほど〜」と言いながら答えを見ていました。&lt;/p&gt;
&lt;p&gt;1問目は&lt;strong&gt;何にも分からん&lt;/strong&gt;だったのでヒントを聞いて多分ここだなーとissueに書いたところでタイムアップでした。&lt;/p&gt;
&lt;p&gt;2問以降はアタリの付け方がわかってきてヒントが出る前に見つけることができるようになりました。相方のBigQueryのクエリ捌きがプロでした。助かった。&lt;/p&gt;
&lt;h2&gt;やってみて&lt;/h2&gt;
&lt;p&gt;最初の情報はユーザーからの報告なので、ユーザーに見える範囲しか情報がありません。この情報とログ・実装をどう関連付けて検証していくかについてコードを書く以外のドメイン知識だったりと様々なスキルが必要でした。&lt;/p&gt;
&lt;p&gt;各問題の毛色が違ったので、ログを元にユーザーの行動を追ってみたり、バグが再現しないか試したりと様々なアプローチがあることを体感できとても楽しかったです。&lt;/p&gt;
&lt;h2&gt;イベントについて&lt;/h2&gt;
&lt;p&gt;commpass上の掲示で開催を知り応募しました、応募要件にRailsの知識が挙げられていましたがRails周りの知識を問われることはあまりなく、webアプリをなんかしら作ったことがあれば大丈夫そうです。競技の本質はそこではなくログ・DBを元に答えが探せるかというところだと思います。&lt;/p&gt;
&lt;p&gt;mixiさんは他にもGitとUnityのchallengeイベントを開催おり、次回は応募してみようかなと思ってます。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[2020買ってよかったもの]]></title><description><![CDATA[こんにちは、あっという間に１２月です。もういくつか寝るとお正月になります。アドベントカレンダーの時期なので毎日はつらいですができるだけたくさんの記事を書いていけたらなと思います。 そんなことで今月…]]></description><link>https://blog.magcho.com/2020/12/good2buy/</link><guid isPermaLink="false">https://blog.magcho.com/2020/12/good2buy/</guid><pubDate>Tue, 08 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;こんにちは、あっという間に１２月です。もういくつか寝るとお正月になります。アドベントカレンダーの時期なので毎日はつらいですができるだけたくさんの記事を書いていけたらなと思います。&lt;/p&gt;
&lt;p&gt;そんなことで今月1つ目の記事は「今年買ってよかったもの」です。いつにも増しておうちで過ごす時間が長かった今年ですが少しでもお家を快適に過ごそうといろいろなものを買っていました。そんなものの一部を紹介&lt;/p&gt;
&lt;h2&gt;買ってよかったもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;DJスタンド&lt;/li&gt;
&lt;li&gt;自作キーボード Lily58&lt;/li&gt;
&lt;li&gt;Jabra Talk25&lt;/li&gt;
&lt;li&gt;TEPRA Pro&lt;/li&gt;
&lt;li&gt;クッションメーカー&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;DJスタンド&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.soundhouse.co.jp/products/detail/item/56833/&quot;&gt;https://www.soundhouse.co.jp/products/detail/item/56833/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ずっと家にいるので必然的にPCを見続けている時間が増えました。今メインで使っているのは去年買ったMacBookProなのでPCを机に置いていると首を下に曲げて覗き込む体勢になります。もともと猫背だったのが悪化しそうだったのと、去年の暮れにヘッドレスト付きの椅子に買い換えて社長座りしながらコードを書くことに憧れがあったのでノートパソコンを上に持ち上げられるDJスタンドを買いました。&lt;/p&gt;
&lt;p&gt;普通にPCスタンドで探せば出てきますがDJスタンドの良さは圧倒的な重さと可搬性。スタンドでPCを30cmぐらい上に持ち上げているので軽いスタンドだとそれごと倒れそうで怖いです。また、DJスタンドなので分解すれば小さくなりますしネジの組み方を帰れば高さ・幅を変更できます。&lt;/p&gt;
&lt;p&gt;これで首の後ろの痛みはなくなりました。うれしい&lt;/p&gt;
&lt;h2&gt;自作キーボード Lily58&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://yushakobo.jp/shop/lily58-pro/&quot;&gt;https://yushakobo.jp/shop/lily58-pro/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;前々から欲しかった左右分割のキーボードです。Mistel　BaroccoやErgodoxなど既製品で分割ものもありますがどれもキーストロークが深く好みではありませんでした。遊舎工房に触りに行き数ある分割キーボードから選んだのがLily58でした。&lt;/p&gt;
&lt;p&gt;Lily58の中でも種類がありProにしました。スイッチはKailh Low Profile 茶軸60gにましたが重すぎて数ヶ月後に赤軸30gに変えました。このように後からスイッチを変えられるのも自作キーボードの魅力です。オススメ&lt;/p&gt;
&lt;p&gt;左右分割にしたため肩を広げた体勢でタイプできるのが嬉しいです。また、Lily58は親指が担当するキーが通常のキーボードよりも多く、小指の役割を一部親指に変わってもらっています。また、Emacs小指が深刻化してきた頃だったので小指のために半日休みを取ることがなくなりました。&lt;/p&gt;
&lt;h2&gt;Jabra Talk25&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jabra.jp/bluetooth-headsets/jabra-talk-25&quot;&gt;https://www.jabra.jp/bluetooth-headsets/jabra-talk-25&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Bluetoothのヘッドセットです。授業・ミーティング・インターンがオンラインとなったためiPhoneについてきたイヤホンだけでは辛くなっていました。そこでワイヤレスのヘッドセットをAmazonで買いました。腰が痛くて立ち上がろうとするとイヤホンが突っ張って焦らなくても良くなりQOL爆上がりです。&lt;/p&gt;
&lt;p&gt;Amazonでワイヤレスヘッドセットを検索するとたくさんの種類がありどれがいいのか分からなかったので、同じインターン生にと同じものを買ってみましたがどうも家の環境には合わず、接続が切れたりノイズが止まりませんでした。&lt;/p&gt;
&lt;p&gt;製品が悪いのではなく完全に家の環境のせいです、家中が適当に自作したIoTデバイスであふれているので相当ダーティーな環境なので。&lt;/p&gt;
&lt;p&gt;買ってはダメで返品し、買っては返品しを繰り返していて。返品するものを取りに来るクロネコのドライバーさんに「最近多いですね」と会話する仲になってきました。お手間かけてゴメンなさい。そしてふと気がついたのがドライバーさんもヘッドセットしてるなーと。そして教えてもらったのがJabra Talk25です。&lt;/p&gt;
&lt;p&gt;本体がとても軽く小さいのでつけたままマスクの付け外しもできます。５時間ぶっ通しのミーティングも大丈夫ですし、お昼休憩の30分充電すればまた5時間のミーティングも大丈夫です。最高！&lt;/p&gt;
&lt;p&gt;ただ、付けて会話しながら家の中を歩いていると家族から独り言がヤバいやつと勘違いされたので注意です。&lt;/p&gt;
&lt;h2&gt;TEPRA Pro&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.kingjim.co.jp/products/brand/tepra-pro.html&quot;&gt;https://www.kingjim.co.jp/products/brand/tepra-pro.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;学校や会社にあるラベルシールメーカーです。家庭用のものはすでに持っていましたがProはPCの専用ソフトを使って画像を出力できます。これでいろいろなシールを量産できます、楽しいです。&lt;/p&gt;
&lt;p&gt;諸事情で大量の備品を家で管理・運用しています。専用ソフトはCSVからの流し込みができるのでCSVを吐くスクリプトを買いておけば備品管理をある程度自動化できます。あとは無心になって貼り付けていくだけです。&lt;/p&gt;
&lt;p&gt;さらにテプラ用のSDKも公開されているっぽいので完全にシステムに組み込むことができそう。&lt;/p&gt;
&lt;h2&gt;クッションメーカー&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.askul.co.jp/p/P681161/&quot;&gt;https://www.askul.co.jp/p/P681161/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;一昔前は過剰梱包で話題だったAmazonですが最近は小さく環境に優しい梱包に切り替わっているように感じます。昔は指でプチプチ潰して遊べる緩衝シートでしたが最近はビニール製でプロテインバーぐらいの大きさの空気が入ったものに変わっています。&lt;/p&gt;
&lt;p&gt;そんなプロテインバーみたいなのを製造するマシーンを買いました。次々とクッションが製造されていくのを眺めているだけで３杯&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;はいけます。&lt;/p&gt;
&lt;p&gt;緩衝材はとても嵩張って保管しづらいので梱包時に製造する運用にしています。&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;なにが？&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[2020夏Chatworkインターンに参加させて頂いたレポ]]></title><description><![CDATA[Chatworkさんの202…]]></description><link>https://blog.magcho.com/2020/11/intern_rep/</link><guid isPermaLink="false">https://blog.magcho.com/2020/11/intern_rep/</guid><pubDate>Sun, 08 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Chatworkさんの2020年夏のインターンシップのフロントエンドコースに参加させていただきましたレポ。オンライン開催ということでどんな３週間になるのかと不安と期待でいっぱいでしたがとても楽しくたくさんのことを得られたと感じています。&lt;/p&gt;
&lt;p&gt;この手のエントリーは守秘義務契約に違反してしまいそうで避けていたのですが、自分が実際にエントリーするときに過去の参加者のレポを参考しましたし、これも誰かの参考になればと思いレポします。&lt;/p&gt;
&lt;p&gt;Chatworkさんのインターンシップ自体が2019年に初めて行われ、内容はバックエンド(Scala)のコースのみだったようです。２回目となる2020年には去年に引き続きバックエンドと合わせてフロントエンドコース(React.js)が併設された形のようです。インターンシップは一周目の講義パート・２〜３週目の実務パートの延べ３週間行われました。講義パートでは全員で受講する講義に加え、front/backにそれぞれに別れ講義・ハンズオンを受講しました。&lt;/p&gt;
&lt;p&gt;実務パートではfront/backのインターン参加生混合のチームが２チーム作られ。それぞれに完全に分かれて作業を進めて行きました。社員さんに加えて去年インターンに参加された方がメンターとして３週間一緒に参加してくださいました。&lt;/p&gt;
&lt;h2&gt;参加が決まるまで&lt;/h2&gt;
&lt;p&gt;みなさんご存知&lt;strong&gt;魔法のスプレッドシート&lt;/strong&gt;を見て開催されること知り、去年度の参加者のレポを見て講義パートの存在が気になり応募しました。&lt;/p&gt;
&lt;p&gt;正直自分には開発のバイト経験も、目立ったインターン経歴もチーム開発経験もないので受かるといいな〜ぐらいの気持ちでゆるっとエントリーし面談に進みました。&lt;/p&gt;
&lt;p&gt;面談はオンラインで人事の方１名とエンジニアの方2名とのオンライン面談でした、とても話しやすい雰囲気で何に興味ある〜？とかチーム経験ある〜？とかをお話ししたと思います(多分)。あとは設計について知識があるかと聞かれて**「デザパタ本を読んで挫折しました」**と答えた覚えがあります。なぜインターン受かったんでしょう？&lt;/p&gt;
&lt;p&gt;その後もゆるっとお話して面談は終了しました、あっという間の１時間でした。そして面談が終わり一息つく間も無く合格のご連絡をいただきあまりにトントンと話が進むのでこれは最後に高い絵か壺を買わされるやつでは？と考えたほどです。&lt;/p&gt;
&lt;h2&gt;参加まで&lt;/h2&gt;
&lt;p&gt;事前資料として「&lt;a href=&quot;https://oukayuka.booth.pm/items/1312652&quot;&gt;りあクト！ TypeScriptで始めるつらくないReact開発 第2版&lt;/a&gt;」を送りいただき、一通りReactについて学びました。最後にReactを書いたのがこのブログを作った時以来なので当時覚えていた記法等が本書内でレガシーとして紹介されていたのでこの分野の移り変わりの速さを実感。また講義パートの資料の一部を事前に送って頂いたのですが、中身を見ると初めての概念やお話ばかりで圧倒されムムムと唸りながら読み進めて行きました。&lt;/p&gt;
&lt;h2&gt;講義パート&lt;/h2&gt;
&lt;p&gt;1周目は講義パートと題して様々なテーマが設けられ実際にその分野でChatworkに携わっている社員さんに講義形式でお話を聞いたりハンズオンをしたりと盛り沢山の１週間です。&lt;/p&gt;
&lt;p&gt;講義は全てGoogle Meet上で行われます。内容はChatworkについてやチーム開発に必要な概念や手法・設計などのお話から実際にChatworkが運用されているアーキテクチャなど幅広く盛り沢山でした。&lt;/p&gt;
&lt;p&gt;今まで技術的なことにしか興味がなく、自分にはマネジメント等の分野はイヤイヤ技術者試験のために勉強してたぐらいでしたが、今回の講義で必要だしなんだか面白いぞと気づかされました。やっぱり書籍で紹介されるような用語紹介よりこういった生きたお話を聞けるのはとても良いです。&lt;/p&gt;
&lt;p&gt;受講する講義に合わせてハンズオンも行われました。オンラインホワイトボードツール？のMiroを用いました。内容はオフラインで行っていたものをオンライン向けにアレンジしているっぽかったです、オンラインでもかなりワイワイと出来て楽しいです。この辺りでオンラインであることの不安はなくなりました。&lt;/p&gt;
&lt;p&gt;毎日誰かしらが「心理的安全性」という言葉を使っていたので、それがとても印象に残った1周目でした。&lt;/p&gt;
&lt;p&gt;Tシャツもあるそうです かわいい
&lt;a href=&quot;https://store.chatwork.com/items/27030221&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQY05VR24qFMAz0/39OOA8+qSh4xXttrZ4aZ5m6cnb3bQNDmkAmk2mgdofWCAYr6DaByAURwSni83Xd9c9g7xfweQfGGOR5jqIoUNcNqqqCUgrLsmAcRzRNg7qu0fc95nn2+BsU8USwriterxfCMEQURUiSxJOSiDlNU484jpFlmV9urcV5nrjkwmYs1KJht/1W6JzzSohHAcmIsizRdR2GYUDbtpimyS/hNaw5S7Kxn6CV+ZzMASplJkjEBVprT8L6sYJ92sE+vdPrhqGbYc1+n+ylfxv/fMJ/cBxv7PaAezs//wUsos1LpcrnawAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;shinriteki.png&quot;
        title=&quot;shinriteki.png&quot;
        src=&quot;/static/3d022baf58cca96d5f3ac109cade848d/fcda8/shinriteki.png&quot;
        srcset=&quot;/static/3d022baf58cca96d5f3ac109cade848d/12f09/shinriteki.png 148w,
/static/3d022baf58cca96d5f3ac109cade848d/e4a3f/shinriteki.png 295w,
/static/3d022baf58cca96d5f3ac109cade848d/fcda8/shinriteki.png 590w,
/static/3d022baf58cca96d5f3ac109cade848d/efc66/shinriteki.png 885w,
/static/3d022baf58cca96d5f3ac109cade848d/c83ae/shinriteki.png 1180w,
/static/3d022baf58cca96d5f3ac109cade848d/71d2f/shinriteki.png 1485w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;実務パート&lt;/h2&gt;
&lt;p&gt;実務パートではインターン用にベースとなる小さなWEBアプリケーションが用意されていて、プロダクトオーナーからの要望に答えられるように既存のWEBアプリケーションに手を入れて行きます。&lt;/p&gt;
&lt;p&gt;1週間を１つのスプリントとして設定し、2,3週なのでそれが２個ある形です。&lt;/p&gt;
&lt;p&gt;既存のアプリケーションはScalaとReact.jsで実装されています。人生初体験だったのですが完全なGitOpsが組まれておりGithubのPRなどにhookしてビルド・チェックが走りビルドが成功するとChatworkにBot通知が届きポチポチするとk8s上にデプロイされます！完全に&lt;strong&gt;魔法&lt;/strong&gt;です。すごい。このようなフローが組まれた状態のWEBアプリに手を加えて行きます。&lt;/p&gt;
&lt;p&gt;講義パートで学んだ手法を用いたり、お手伝いいただきながら設計をして行きます。チーム全員で認識を合わせながら議論を進め、この設計パートにかなーり時間がかかってしまいました。時間をかけたのにかかわらず、これでよかったのか？？とモヤッとした気持ちを拭えないまま1stスプリントの設計を終え、フロントとバックに別れて実装に取り掛かります。&lt;/p&gt;
&lt;p&gt;モヤッとした予感は的中し、1stスプリントはうまくいかずスプリントレビューで反省と来週以降の動きについてアドバイスをいただきながら考えていきました。&lt;/p&gt;
&lt;p&gt;2ndスプリントも同様に計画、実装という流れで進めます。先週の反省から工数見積もりを修正、細かく進行度合いを見てきます。おかげでワイワイと事が進み。先週のお通夜が嘘みたいです。さらに今週は少し余裕があるので、ドメインについて議論をしながら進めて行くことができました。先週はこういった議論ができませんでしたが今週は個々の考えていることをそれぞれ出し合って議論を進めることができるようになってきました。&lt;strong&gt;これが心理的安全性ってやつか&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;今週はちゃんとデプロイもできてみんなで追加した機能が動きました。**めでたい！**そしてみんなで新機能を連打したり、あえて変な操作をしたりとバグを探し初めます、みんな悪い人たちですね。おかげで色々とボロが見つかりました。詰めが甘い、、ちなみに会社としてバグバウンティー&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;や、社内でバグ探しイベント&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;もされているそうです。楽しそう&lt;/p&gt;
&lt;h2&gt;終わりに&lt;/h2&gt;
&lt;p&gt;とても楽しく、感謝しきれないほどたくさんのものが得られました。どれくらい感謝しているかというと、オフィスの方を足にして寝るのをやめました。&lt;/p&gt;
&lt;p&gt;コーポレートミッションとして「働くをもっと楽しく、創造的に」を掲げている通り、楽しく働くことを常に考えていて実際に楽しく働くための仕組みや社員の方もそれを実現・体現していく雰囲気を感じました。インターン中は分報のようなチャットがあり、業務時間のはずなのにすぐに返信が来ます。&lt;del&gt;いつ仕事しているのか疑問でした&lt;/del&gt;（失礼）&lt;/p&gt;
&lt;p&gt;実際にチーム開発をしてみて感じたこととして、マネジメントはPMだけが頑張って考えるものだと考えてましたが、エンジニアこそこういった手法のことを知っておこうと考えが変わりました。今は講義パートで紹介していただいた書籍何冊かをポチって**あっ！これインターンでやったところだ！**といいながら読み進めています。&lt;/p&gt;
&lt;p&gt;最後に、オフィスが大阪の梅田・東京タワーの横にあるためかお話しした社員さんやメンターさんが必ず近所の美味しいご飯屋さんの話をします。こちとらUberEatsすら対応していないような町に住んでいるので毎日コンビニおにぎりでした。悔しい&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;&lt;a href=&quot;https://bugbounty.jp/program/UFjXG0kdqwZhmULIjBFOojK5&quot;&gt;https://bugbounty.jp/program/UFjXG0kdqwZhmULIjBFOojK5&lt;/a&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;&lt;a href=&quot;https://www.wantedly.com/companies/chatwork/post_articles/188911&quot;&gt;https://www.wantedly.com/companies/chatwork/post_articles/188911&lt;/a&gt;&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Lily58にレイヤーを追加する]]></title><description><![CDATA[自分は Lily58 Pro という左右分割の自作キーボードを使っています。ErgoDoxよりは小さくCorneよりは大きいのでとても自分に合っています。 Lily58のデフォルトFWにはRaise/Lower/Adjustの…]]></description><link>https://blog.magcho.com/2020/6/lily58-add-layer/</link><guid isPermaLink="false">https://blog.magcho.com/2020/6/lily58-add-layer/</guid><pubDate>Sat, 20 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;自分は &lt;a href=&quot;https://yuchi-kbd.hatenablog.com/entry/2018/12/23/214342&quot;&gt;Lily58 Pro&lt;/a&gt; という左右分割の自作キーボードを使っています。ErgoDoxよりは小さくCorneよりは大きいのでとても自分に合っています。&lt;/p&gt;
&lt;p&gt;Lily58のデフォルトFWにはRaise/Lower/Adjustの3レイヤーが定義されていますが、最近会計処理を多くやることになってテンキーが欲しくなったので追加しようと思います。Lily58にはオプションとしてOLEDがつきます、デフォルトでレイヤー名やキー入力の履歴を表示してくれる親切設計でした。&lt;/p&gt;
&lt;h2&gt;keymap.cにテンキーレイヤーを追加する&lt;/h2&gt;
&lt;p&gt;レイヤー定義は&lt;code class=&quot;language-text&quot;&gt;keymap.c&lt;/code&gt;に書き込みます。&lt;/p&gt;
&lt;p&gt;レイヤーの切り替え方は何通りかあります、デフォルトのRaise/Lowerは押している時だけレイヤーを切り替える方式です。そのレイヤーのキーを１つタイプするだけならば便利な方式ですが、テンキーレイヤー等では連続して数値を入力し続けたいことがほとんどなので今回は一回押したらレイヤーを切り替え、もう一度押すとレイヤーが戻るtoggle方式にしました。&lt;/p&gt;
&lt;p&gt;まず、以下のようにNUMBERレイヤーを定義します。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymap.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-c&quot;&gt;&lt;code class=&quot;language-diff-c&quot;&gt;&lt;span class=&quot;token unchanged language-c&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;_QWERTY&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;_LOWER&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;_RAISE&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;_ADJUST&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token inserted-sign inserted language-c&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;_NUMBER&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymap.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-c&quot;&gt;&lt;code class=&quot;language-diff-c&quot;&gt;	[_ADJUST] =
		LAYOUT(XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                   XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,\
		XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                   XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,\
		XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                   XXXXXXX, XXXXXXX, RGB_TOG, RGB_HUI, RGB_SAI, RGB_VAI,\
		XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, RGB_MOD, RGB_HUD, RGB_SAD, RGB_VAD,\
		_______, _______, _______, _______, _______, _______, _______, _______),


&lt;span class=&quot;token inserted-sign inserted language-c&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* NUMBER
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * ,-----------------------------------------.                    ,-----------------------------------------.
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |      |      |      |      |      |      |                    |      |      |      |      |      |      |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |      |      |      |      |      |      |                    |      |   7  |   8  |   9  |BSPACE|      |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |      |      |      |      |      |      |-------.    ,-------|   =  |   4  |   5  |   6  |   +  |      |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |------+------+------+------+------+------|       |    |NUMBER |------+------+------+------+------+------|
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * |      |      |      |      |      |      |-------|    |-------|   0  |   1  |   2  |   3  |   -  |      |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     * `-----------------------------------------/       /     \      \-----------------------------------------&apos;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     *                   | LAlt | LGUI |LOWER | /Space  /       \Enter \  |RAISE |BackSP| RGUI |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     *                   |      |      |      |/       /         \      \ |      |      |      |
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;     *                   `----------------------------&apos;           &apos;------&apos;&apos;--------------------&apos;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 */&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;	 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 &lt;span class=&quot;token function&quot;&gt;LAYOUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;                   _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;                   KC_PDOT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_P7&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P8&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P9&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_BSPC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;                   KC_PEQL&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_P4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;    KC_P6&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  KC_PPLS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_P0&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_P3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;   KC_PMNS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _______&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;		 KC_LSFT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_LGUI&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_SPC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_ENT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_RGUI&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_RALT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;NUMBERレイヤーへtoggleするためのキーをQWERTYレイヤーに定義します。右手側の一番左の１つだけ横に出ているキーに割り当てます。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;TG(レイヤー番号)&lt;/code&gt;のように割り当て、切り替え先のレイヤーには&lt;code class=&quot;language-text&quot;&gt;KC_TRANSPARENT&lt;/code&gt;かそのエイリアスである&lt;code class=&quot;language-text&quot;&gt;_______&lt;/code&gt;を割り当ておきます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymap.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* QWERTY
	 * ,-----------------------------------------.                    ,-----------------------------------------.
	 * |  `   |   1  |   2  |   3  |   4  |   5  |                    |   6  |   7  |   8  |   9  |   0  |BSPACE|
	 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
	 * | Tab  |   Q  |   W  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  |BSPACE|
	 * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
	 * |LCTRL |   A  |   S  |   D  |   F  |   G  |-------.    ,-------|   H  |   J  |   K  |   L  |   ;  |  &apos;   |
	 * |------+------+------+------+------+------|CSLOCK |    |NUMBER |------+------+------+------+------+------|
	 * | LAlt |   Z  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |   M  |   ,  |   .  |   /  |RShift|
	 * `-----------------------------------------/       /     \      \-----------------------------------------&apos;
	 *                   |Lshift| LGUI |LOWER | /Space  /       \Enter \  |RAISE | RGUI | RAlt |
	 *                   |      |      |      |/       /         \      \ |      |      |      |
	 *                   `----------------------------&apos;           &apos;------&apos;&apos;--------------------&apos;
	 */&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;_QWERTY&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;LAYOUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_GRV&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_6&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_7&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_8&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_9&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_0&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SUSHI&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
		KC_TAB&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_Q&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_W&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_E&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_R&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_T&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_Y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_U&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_I&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_O&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_P&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_MINS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
		KC_LCTRL&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_A&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_S&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_D&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_F&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_G&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_H&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_J&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_K&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_L&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_SCLN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_QUOT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\
		KC_LALT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_Z&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_X&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_C&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_V&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_B&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_CAPS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_N&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_M&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_COMM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_DOT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_SLSH&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_RSFT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; \
		KC_LSFT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_LGUI&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_SPC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_ENT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_RGUI&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; KC_RALT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これでNUMBERレイヤーが動作します。&lt;/p&gt;
&lt;h2&gt;3層目のレイヤーを使う&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.qmk.fm/#/feature_layers&quot;&gt;qmk firmwareのドキュメント&lt;/a&gt; にもありますがレイヤーは階層構造を持ち&lt;code class=&quot;language-text&quot;&gt;KC_TRANSPARENT&lt;/code&gt;で下のレイヤーを透過的に利用できます。&lt;/p&gt;
&lt;p&gt;自分はRaizeレイヤーに矢印キーを割り当てているのでNUMBERレイヤーの時にLOWERキーを押したらLOWERレイヤーに一時的に切り替わってくれると嬉しいです。
つまり、QWERTY -&gt; NUMBER -&gt; LOWER とレイヤーを変化されているのでQWERTYから数えて3層目のレイヤーです。&lt;/p&gt;
&lt;p&gt;Lily58ではQERTYレイヤ状態でLOWERキー押下時に&lt;code class=&quot;language-text&quot;&gt;layer_on(_LOWER)&lt;/code&gt;でレイヤーを切り替えています。この関数の実装上今回のケースでは期待しない動作になります。
今回はRaise/Lowerキーの押下/押上時に処理を追加して対応します。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymap.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; bool prelayer_numberlayer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

bool &lt;span class=&quot;token function&quot;&gt;process_record_user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;uint16_t&lt;/span&gt; keycode&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;keyrecord_t&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; LOWER&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			is_prelayer_numberlayer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;layer_state_is&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token function&quot;&gt;layer_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;update_tri_layer_RGB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;update_tri_layer_RGB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;is_prelayer_numberlayer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;layer_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		
	&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; RAISE&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			is_prelayer_numberlayer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;layer_state_is&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token function&quot;&gt;layer_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_RAISE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;update_tri_layer_RGB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_RAISE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;update_tri_layer_RGB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_LOWER&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _RAISE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;is_prelayer_numberlayer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;layer_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_NUMBER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以上の実装で3層目のレイヤーも期待する動作になります。&lt;/p&gt;
&lt;h2&gt;OLEDに表示されるレイヤー名を修正する&lt;/h2&gt;
&lt;p&gt;Lily58のオプションで付けられるOLEDにはレイヤー名や入力履歴等が表示されています。OLED周りの実装はlibに入っています。ここに直接手を加えていきます。&lt;/p&gt;
&lt;p&gt;レイヤー名の表示はkeymap.cの&lt;code class=&quot;language-text&quot;&gt;read_layer_state()&lt;/code&gt;で呼び出されています。&lt;/p&gt;
&lt;p&gt;この関数の実装にNUMBERレイヤーに関する記述をすると&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;lib/layer_state_reader.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-c&quot;&gt;&lt;code class=&quot;language-diff-c&quot;&gt;&lt;span class=&quot;token unchanged language-c&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_BASE&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_LOWER&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_RAISE&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_ADJUST&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_ADJUST_TRI&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;L_ADJUST &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; L_RAISE &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; L_LOWER&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token inserted-sign inserted language-c&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;L_NUMBER&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;lib/layer_state_reader.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;diff&quot;&gt;&lt;pre class=&quot;language-diff-c&quot;&gt;&lt;code class=&quot;language-diff-c&quot;&gt;&lt;span class=&quot;token unchanged language-c&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read_layer_state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;   &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;layer_state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token inserted-sign inserted language-c&quot;&gt;&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; L_NUMBER&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;            &lt;span class=&quot;token function&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;layer_state_str&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;layer_state_str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Layer: Number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token prefix inserted&quot;&gt;+&lt;/span&gt;            &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token unchanged language-c&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;       &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;           &lt;span class=&quot;token function&quot;&gt;snprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;layer_state_str&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;layer_state_str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Layer: Undef-%ld&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; layer_state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;token unchanged language-c&quot;&gt;&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; layer_state_str&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token prefix unchanged&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これでOLEDにLayer: Numberと表示されるようになります。めでたしめでたし。&lt;/p&gt;
&lt;h2&gt;おまけ&lt;/h2&gt;
&lt;p&gt;qmkではレイヤーの状態を&lt;code class=&quot;language-text&quot;&gt;unit32_t layer_state&lt;/code&gt; で保持し、下位ビットから順にレイヤー1・レイヤー2を割り当ててそのビットが立っているかどうかを判定しているらしい。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;layer_on(LAYER)&lt;/code&gt;は指定したビットを立てるわけではなく、現在の&lt;code class=&quot;language-text&quot;&gt;layer_state&lt;/code&gt;を左に指定量ビットシフトしている。確かに&lt;code class=&quot;language-text&quot;&gt;keymap.c&lt;/code&gt;で&lt;code class=&quot;language-text&quot;&gt;#define _NUMBER 4&lt;/code&gt;を定義しましたね。当然&lt;code class=&quot;language-text&quot;&gt;layer_off(LAYER)&lt;/code&gt;は右に指定量ビットシフトです。&lt;/p&gt;
&lt;p&gt;今までLily58にFWを書き込む時には繋いでるTRRSを抜いて書き込んでいたのですが、軽く調べた感じ繋ぎっぱなしで書き込んで問題なさそう(私は設計者ではないので信憑性のない情報)
&lt;a href=&quot;https://github.com/kata0510/Lily58/tree/master/Pro/PCB&quot;&gt;回路図&lt;/a&gt; を見た感じUSBの通信線とは別のピンでPro Micro同士を繋いでいます。TRRSのアサインは先端からUSBからのVCC/GND/通信線/NCっぽい。ProMicroの仕様書をざっと見た感じFW書き込み時にシリアルピンは影響なさそうなのでTRRSを抜かずに書き込めそうです。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[.gitignoreを自動生成するサブコマンドを作ろう]]></title><description><![CDATA[demo asciicast gitignoreを言語とに自動生成してくれるサービスはいくつかありますが、わざわざwebサイトを開くのも面倒です。
幸いなことにgitignore.ioがapiを提供してくれています、これを利用してgit…]]></description><link>https://blog.magcho.com/2020/6/gitignore/</link><guid isPermaLink="false">https://blog.magcho.com/2020/6/gitignore/</guid><pubDate>Sun, 14 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;demo&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://asciinema.org/a/339422&quot;&gt;&lt;img src=&quot;https://asciinema.org/a/339422.svg&quot; alt=&quot;asciicast&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;gitignoreを言語とに自動生成してくれるサービスはいくつかありますが、わざわざwebサイトを開くのも面倒です。
幸いなことにgitignore.ioがapiを提供してくれています、これを利用してgitにサブコマンドを追加しましょう。&lt;/p&gt;
&lt;p&gt;ついでに.gitignoreを上書き・追記の確認・gitignore.ioにテンプレートが存在しない場合はエラーを表示などもあると親切ですね。shにするとこんな感じに。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;RES&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -Ls http://gitignore.io/api/$1	-w &lt;span class=&quot;token string&quot;&gt;&apos;http_code=%{http_code}&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;list&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
	&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$RES&lt;/span&gt;&quot;&lt;/span&gt;
	&lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${RES&lt;span class=&quot;token operator&quot;&gt;##&lt;/span&gt;*http_code=}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -f .gitignore &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
		&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; -n &lt;span class=&quot;token string&quot;&gt;&quot;.gitignore already exits. Append ? [y/N/o]: &quot;&lt;/span&gt;
		&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; ANS
		&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$ANS&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Yy&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Append&apos;&lt;/span&gt;
				&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${RES&lt;span class=&quot;token operator&quot;&gt;%%&lt;/span&gt;http_code*}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; .gitignore
				&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Nn&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Cancel&apos;&lt;/span&gt;
				&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Oo&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Overwrid&apos;&lt;/span&gt;
				&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${RES&lt;span class=&quot;token operator&quot;&gt;%%&lt;/span&gt;http_code*}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .gitignore
				&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	     &lt;span class=&quot;token keyword&quot;&gt;esac&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
		&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Created .gitignore&apos;&lt;/span&gt;
		&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${RES&lt;span class=&quot;token operator&quot;&gt;%%&lt;/span&gt;http_code*}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; .gitignore
	&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
	&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt; is undefined.&quot;&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;.gitconfigに書くとときには全体を関数にする・ダブルクォーテーションをエスケープ・&lt;code class=&quot;language-text&quot;&gt;echo -n&lt;/code&gt;が使えないので&lt;code class=&quot;language-text&quot;&gt;printf&lt;/code&gt;に差し替えなどをすると以下になります。&lt;/p&gt;
&lt;p&gt;書いていて気づいたんですが、#はエスケープせずに動きますね。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;.gitconfig&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;alias&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# gitignoreの言語別セットを自動生成&lt;/span&gt;
  ignore = &quot;&lt;span class=&quot;token tag&quot;&gt;!f()&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; RES=$(curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;Ls http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//gitignore.io/api/$1  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;w &apos;http_code=%&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;http_code&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&apos;); if &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; \&quot;$1\&quot; = &apos;list&apos; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;; then echo \&quot;$RES\&quot;;exit 0; fi; if &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; 200 = \&quot;$&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;RES&lt;span class=&quot;token comment&quot;&gt;##*http_code=}\&quot; ]; then if [ -f .gitignore ]; then printf  \&quot;.gitignore already exits. Append ? [y/N/o]: \&quot;;read ANS;case $ANS in [Yy]*) echo &apos;Append&apos;;echo \&quot;${RES%%http_code*}\&quot; &gt;&gt; .gitignore;;\&quot;\&quot; | [Nn]*)echo &apos;Cancel&apos;;;[Oo]*)echo &apos;Overwride&apos;;echo \&quot;${RES%%http_code*}\&quot; &gt; .gitignore;;esac;else echo \&quot;${RES%%http_code*}\&quot; &gt; .gitignore;fi;else echo \&quot;$1 is undefined.\&quot; ;fi;};f &quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;使い方&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; ignore &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;language&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; ignore java
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; ignore node,stylus&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[GulpでSharpを使って画像のリサイズをする]]></title><description><![CDATA[gulp-sharp で画像のリサイズをしたい時にできなかったので自分でそれっぽいのを書いた。 フロントエンドで画像を扱う時にsrcディレクトリには元の大きさの画像を用意してdist…]]></description><link>https://blog.magcho.com/2020/5/gulp-sharp/</link><guid isPermaLink="false">https://blog.magcho.com/2020/5/gulp-sharp/</guid><pubDate>Mon, 04 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://www.npmjs.com/package/gulp-sharp&quot;&gt;gulp-sharp&lt;/a&gt; で画像のリサイズをしたい時にできなかったので自分でそれっぽいのを書いた。&lt;/p&gt;
&lt;p&gt;フロントエンドで画像を扱う時にsrcディレクトリには元の大きさの画像を用意してdistディレクトリには適切なサイズまで小さくして公開する運用をしている。&lt;/p&gt;
&lt;p&gt;自分は欲しい大きさにresizeしてからoptimiseをしています、gulpでのresizeで一番npmでダウンロード数が多いのは&lt;a href=&quot;https://www.npmjs.com/package/gulp-image-resize&quot;&gt;gulp-image-resize&lt;/a&gt;です。このライブラリはGraphicsMagick か ImageMagickまたはその両方を必要とします。CIでサイトをビルドする時にこれらがインストールされていないときは自分でapt等でインストールをする必要がありますが、ciの制約でインストールができなかったのでsharpを使ってresizeさせたかった。&lt;/p&gt;
&lt;p&gt;探すと&lt;a href=&quot;https://www.npmjs.com/package/gulp-sharp&quot;&gt;gulp-sharp&lt;/a&gt;はあるんですが、メンテナンスされてないのでインストール時にエラーが出ました。&lt;/p&gt;
&lt;p&gt;凝ったことしなければgulpのプラグインは簡単に書けたので、ここにメモ。&lt;/p&gt;
&lt;h2&gt;自作gulp-sharp&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i through2 gulp-util sharp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;my-gulp-sharp.js&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; through &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;through2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; gulputil &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;gulp-util&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; sharp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sharp&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
  through&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;file&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; encoding&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;gulputil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PluginError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;gulp-sharp&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Streams un supported&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; payload &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        payload&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        payload&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token function&quot;&gt;sharp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;contents&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;gulputil&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token literal-property property&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token literal-property property&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cwd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token literal-property property&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token literal-property property&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;npmでsharpとgulpプラグインを作るためにthrough2とgulp-utilをインストールします。&lt;/p&gt;
&lt;p&gt;あとはgulpfile.jsからいつも通り読み込みます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;gulpfile.js&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;cost gulp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gulp&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; my&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;gulp&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;sharp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./my-gulp-sharp&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;resize&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;cb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  gulp
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./img/*.+(png|jpg)&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;my&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;gulp&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sharp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token literal-property property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;gulp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dist&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dist/img&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;end&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;cb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;heightとwidthをオプションで渡していますが、どちらかを省略するとアスペクト比を保った数値でいい感じに縮小してくれます。&lt;/p&gt;
&lt;p&gt;sharpはfilebuffの他streamでも使えるみたいですが、今回の形でgulpで使った時はfilebuffのみで動作したので実装しませんでした。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[qmk firmwareでctrlとの同時押しをカスタマイズする]]></title><description><![CDATA[…]]></description><link>https://blog.magcho.com/2020/4/qmk_firmwareでctrlとの同時押しをカスタマイズする/</link><guid isPermaLink="false">https://blog.magcho.com/2020/4/qmk_firmwareでctrlとの同時押しをカスタマイズする/</guid><pubDate>Wed, 08 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;キー入力が下手なのでバックスペースを連打しがちなのですがバックスペースキーはキーボード上では遥か右上にあります。これが原因で右手首を痛めたことも。入力精度を上げろという話なのですが出来るならもうしてます。&lt;/p&gt;
&lt;p&gt;また、以外と日本語入力をしていると使いがちな「ー」伸ばし棒も近くに欲しいものです。&lt;/p&gt;
&lt;p&gt;今回は&lt;code class=&quot;language-text&quot;&gt;C-j&lt;/code&gt;にbackspace・&lt;code class=&quot;language-text&quot;&gt;C-n&lt;/code&gt;にハイフンを割り当てます。&lt;/p&gt;
&lt;h2&gt;Ctrlキー&lt;/h2&gt;
&lt;p&gt;Ctrlキー含め装飾キーには様々なキーバインドが割り当てられています。一般的には&lt;code class=&quot;language-text&quot;&gt;C-j&lt;/code&gt;にはreturn・&lt;code class=&quot;language-text&quot;&gt;C-h&lt;/code&gt;にはbackspaceなど色々あります。zsh/bashなどのshellやターミナルのキーバインドに設定されていることが多いです。macでは&lt;code class=&quot;language-text&quot;&gt;C-k&lt;/code&gt;に行末まで削除があったりと気が利いています。&lt;/p&gt;
&lt;p&gt;qmk firmwareではraise/lower等のキーマップを変更・追加してカスタマイズするのが一般的ですがこの場合は複合キーを入力するマクロを全てのキーにおいて定義する必要があり厄介です。&lt;/p&gt;
&lt;p&gt;今回はレイヤーの定義ではなくプログラムっぽく？キー入力を拡張してみます。&lt;/p&gt;
&lt;h2&gt;キータイプ&lt;/h2&gt;
&lt;p&gt;qmk firmwareにてキー入力を拡張するには&lt;code class=&quot;language-text&quot;&gt;process_record_user()&lt;/code&gt;を用いる方法があります。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.qmk.fm/#/custom_quantum_functions?id=programming-the-behavior-of-any-keycode&quot;&gt;公式ドキュメント&lt;/a&gt;に詳しくはありますが、&lt;code class=&quot;language-text&quot;&gt;process_record_user()&lt;/code&gt;はqmk firmwareがキー入力を検知しPCへキー情報を送信する前に毎回呼び出される関数です。通常時返り値を&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;とすることで現在のレイヤーのkeymapを見てPCへキー情報を送信してくれます。今回のように何か特別でキーマップは関与しない処理を行う場合は一通りの処理が終わった後&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;を返しておきます。この場合は&lt;code class=&quot;language-text&quot;&gt;process_record_user&lt;/code&gt;を抜けた時点で処理を終了するようになります。&lt;/p&gt;
&lt;p&gt;今回は&lt;code class=&quot;language-text&quot;&gt;C-j&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;C-n&lt;/code&gt;の時に任意の処理をし、それ以外はキーマップに従うようにしていきます。&lt;/p&gt;
&lt;p&gt;この関数はキーの押下時に加えて”押上”時にも呼び出されます。ctrlとの複合キーであることを判定するにはctrlキー押下時にctrl_pressedという押下フラグを立てておく方法をとります。&lt;/p&gt;
&lt;p&gt;そしてポイントなのがキーの反復機能です。テキストエディタでAキーを押しっぱなしにすると&lt;code class=&quot;language-text&quot;&gt;AAAAAAAAAAAAAA&lt;/code&gt;のようにAが大量に入力されます。それはそう。反復機能が働いている時にキーボードが&lt;code class=&quot;language-text&quot;&gt;KC_A&lt;/code&gt;のkey_downコードを連続して送信しているわけではなく、PC側でkey_downコードが来てからなかなかkey_upコードが来ないので押しっぱなしであると判断しています。&lt;/p&gt;
&lt;p&gt;qmk firmwareにはキーコードを送信するための関数がいくか用意されていますがよく使うのは&lt;code class=&quot;language-text&quot;&gt;tap_code(KEYCODE)&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;register_code(KEYCODE) / unregister_code(KEYCODE)&lt;/code&gt;です。前者はkey_downコードとkey_upコードを連続して送信し、後者はresigerがdown・unregisterがupのコードを送信するものです。用途に合わせて使い分ける必要があります。&lt;/p&gt;
&lt;h2&gt;実装&lt;/h2&gt;
&lt;p&gt;defaultのkeymap.cの下の方に&lt;code class=&quot;language-text&quot;&gt;process_record_user()&lt;/code&gt;の記述があります。ここに実装していきます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymaps.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;略&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; bool ctrl_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; bool exceptionaly_ctrl_layer_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

bool &lt;span class=&quot;token function&quot;&gt;process_record_user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;uint16_t&lt;/span&gt; keycode&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;keyrecord_t&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;ifdef&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;SSD1306OLED&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;set_keylog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keycode&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// set_timelog();&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keycode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; KC_LCTRL&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            ctrl_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            ctrl_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; QWERTY&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;set_single_persistent_default_layer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_QWERTY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;略&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上のコードで、引数keycodeに押下/押上されたキーのコードが入っています。&lt;code class=&quot;language-text&quot;&gt;record-&gt;event.pressed&lt;/code&gt;にて押下か押上か判断できるのでctrlキーの状態に変化があればフラグを更新します。ここではreturnせずに正常処理をします。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;keymap.c&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;略&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; ADJUST&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;layer_off&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ADJUST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctrl_pressed &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; exceptionaly_ctrl_layer_pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keycode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; KC_J&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;unregister_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_LCTRL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;register_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_BSPACE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    exceptionaly_ctrl_layer_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;unregister_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_BSPACE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctrl_pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
						&lt;span class=&quot;token function&quot;&gt;register_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_LCTRL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
					&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                    exceptionaly_ctrl_layer_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; KC_N&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;unregister_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_LCTRL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;register_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_MINUS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                    exceptionaly_ctrl_layer_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;unregister_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_MINUS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
					&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctrl_pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
						&lt;span class=&quot;token function&quot;&gt;register_code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;KC_LTRL&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
					&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                    exceptionaly_ctrl_layer_pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上のコードで、switchにてctrlキーとレイヤ切り替えキーを判定し、それ以外はdefaultに入ります。ここで&lt;code class=&quot;language-text&quot;&gt;ctrl\_pressed&lt;/code&gt;フラグを用いて押下中(修飾キー)であるかを判定し、任意のキーとの組み合わせ(ここでは&lt;code class=&quot;language-text&quot;&gt;C-J&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;C-N&lt;/code&gt;)であれば&lt;code class=&quot;language-text&quot;&gt;register\_code(KEYCODE)&lt;/code&gt;にてキーを打ちます。&lt;/p&gt;
&lt;p&gt;今回のようにbackspaceやハイフンといった本来修飾キーを用いないキー(Ctrlとの複合キーではないキー)の場合はPCにこれは修飾キーでないことを伝えるために&lt;code class=&quot;language-text&quot;&gt;unregister_code(KC_LCTRL)&lt;/code&gt;にてctrlキーをを仮想的に押上しておきます。&lt;/p&gt;
&lt;p&gt;ここでは長押ししたら複数文字backspace/ハイフンを入力して欲しいので&lt;code class=&quot;language-text&quot;&gt;register&lt;/code&gt;を利用しています。&lt;/p&gt;
&lt;p&gt;そして押上時に&lt;code class=&quot;language-text&quot;&gt;unregister&lt;/code&gt;して&lt;code class=&quot;language-text&quot;&gt;register_code(KC_LCTRL)&lt;/code&gt;にて仮想的なctrlキーの押下を戻しておくといいです。backspaceで数文字消した後貼り付けしたい時にctrlキーを押しなおす必要がなくなり、より自然になるかと。&lt;/p&gt;
&lt;p&gt;入力時に&lt;code class=&quot;language-text&quot;&gt;Ctrl(down) -&gt; J(down) -&gt; J(up) -&gt; Ctrl(up)&lt;/code&gt;とタイプしているつもりでも指が離れるタイミングによってはupのタイミングが逆になることもあり得るのでフラグで状態管理をして&lt;code class=&quot;language-text&quot;&gt;if(ctrl_pressed || exceptionaly_ctrl_layer_pressed)&lt;/code&gt;のようにどちらのフラグでも対応できると安心。&lt;/p&gt;
&lt;h2&gt;おわり&lt;/h2&gt;
&lt;p&gt;キーマップのカスタマイズは既成のキーボードでも十分できますが、自作キーボードでは大抵のことを作ればできるので楽しい。&lt;/p&gt;
&lt;h2&gt;リンク&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://support.apple.com/ja-jp/HT201236&quot;&gt;Mac のキーボードショートカット - Apple サポート&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/qmk/qmk_firmware/blob/master/keyboards/lily58/keymaps/default/keymap.c&quot;&gt;qmk_firmware/keymap.c at master · qmk/qmk_firmware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/magcho/qmk_firmware/blob/master/keyboards/lily58/keymaps/magcho/keymap.c&quot;&gt;qmk firmware/keymap.c at master · magcho/qmk firmware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.qmk.fm/#/custom_quantum_functions?id=programming-the-behavior-of-any-keycode&quot;&gt;Customizing Functionality - QMK Firmware&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.qmk.fm/#/keycodes&quot;&gt;Full List - QMK Firmware&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Goで作ったCLIツールのビルド・配布をGitHub Actionsで自動化する]]></title><description><![CDATA[Goで作ったdotfiles管理ツールのdotzをビルド・バイナリ配布・homebrewのアップデートまでを自動化したメモ。 GitHub Actionsを初めて本格的に利用してみました。beta版の時はyamlにズラズラとshell script…]]></description><link>https://blog.magcho.com/2020/4/goで作ったCLIツールのビルド・配布をGitHub_Actionsで自動化する/</link><guid isPermaLink="false">https://blog.magcho.com/2020/4/goで作ったCLIツールのビルド・配布をGitHub_Actionsで自動化する/</guid><pubDate>Mon, 06 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Goで作ったdotfiles管理ツールのdotzをビルド・バイナリ配布・homebrewのアップデートまでを自動化したメモ。&lt;/p&gt;
&lt;p&gt;GitHub Actionsを初めて本格的に利用してみました。beta版の時はyamlにズラズラとshell scriptのように記述した覚えがありますが現行のactionsでは考え方が違うようです。&lt;/p&gt;
&lt;h2&gt;github actions&lt;/h2&gt;
&lt;p&gt;現行のGitHub actionsについては日本語文献もたくさんあるので詳しいことはそっちを見てほしいんですが、GitHub上ではworkflowがpushやPR、タイマーなどのトリガーによって実行されます。workflow内には任意のactionを持ちこのactionが順次/並列で実行されます。&lt;/p&gt;
&lt;p&gt;actionにはdockerのようにinputと環境変数を渡すことができ、任意の数のoutputができます。outputは別のactionのinputとして渡すことができます。&lt;/p&gt;
&lt;p&gt;また、workflow内で使える環境変数にはリポジトリ名やcommit ハッシュ等の情報に加え、tagのpushをトリガーとした時などにはtag名等様々な情報を取得できます。さらにworkflowを実行しているリポジトリのみの権限を持ったonetime GitHub tokenが払い出されます。&lt;/p&gt;
&lt;p&gt;github tokenは対象リポジトリにしか影響できないのでミスって他のリポジトリを消したりできないので安心。&lt;/p&gt;
&lt;h2&gt;dotzのビルド&lt;/h2&gt;
&lt;p&gt;dotzに利用しているcli用のライブラリ&lt;a href=&quot;https://github.com/urfave/cli&quot;&gt;urfave/cli&lt;/a&gt;はコマンド実行時にツールのバージョンを表示する昨日はあります、今回はtag名からバージョン番号を拾ってmakefileでビルドします。&lt;/p&gt;
&lt;p&gt;makefileはCIだけではなく開発時にも利用すると思います。開発時は&lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt;コマンド単体のみでビルドし、CI上のビルド時のみバージョン名を渡してビルドしたいです。このようにパラメータをオプション的に使うにはmakefile内で使える変数をコマンドラインから渡してやるといいです。&lt;/p&gt;
&lt;p&gt;makefile内で変数&lt;code class=&quot;language-text&quot;&gt;dotz_ver&lt;/code&gt;を定義しておきます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;makefile&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;makefile&quot;&gt;&lt;pre class=&quot;language-makefile&quot;&gt;&lt;code class=&quot;language-makefile&quot;&gt;dotz_ver &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 0.0.0
&lt;span class=&quot;token target symbol&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main.go
	go build -v -ldflags &lt;span class=&quot;token string&quot;&gt;&quot;-X main.dotzVersion=${dotz_ver}&quot;&lt;/span&gt; .&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;make build&lt;/code&gt;をしたときには&lt;code class=&quot;language-text&quot;&gt;dotz_ver&lt;/code&gt;の中身は&lt;code class=&quot;language-text&quot;&gt;0.0.0&lt;/code&gt;になりますが&lt;code class=&quot;language-text&quot;&gt;make build dotz_ver=1.2.3&lt;/code&gt;と呼び出せばコマンドライン側の値が優先され&lt;code class=&quot;language-text&quot;&gt;dotz_ver&lt;/code&gt;の中身が&lt;code class=&quot;language-text&quot;&gt;1.2.3&lt;/code&gt;になります。これを利用してworkflowからはtag名を渡しておきます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;.github/workflows/build.yml&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;~~~~抜粋
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; build
    &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;GO111MODULE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;on&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; macos&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Set up Go 1.13
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/setup&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;go@v1
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;go-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.13&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Check out code into the Go module directory
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v2

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Build
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; make build dotz_ver=$&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; github.ref &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
~~~~抜粋&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上記のmakefileにありますが、go build 時に&lt;code class=&quot;language-text&quot;&gt;-ldflags &quot;main.{変数名}={value}&quot;&lt;/code&gt;で値を埋め込んでいます。これでビルド時に変数を取り込み実行時は変数が格納済みの状態で実行が開始されます。&lt;/p&gt;
&lt;p&gt;ビルド後は、&lt;a href=&quot;https://github.com/actions/create-release&quot;&gt;actions/create-release@v1&lt;/a&gt;と&lt;a href=&quot;https://github.com/actions/upload-release-asset&quot;&gt;actions/upload-release-asset&lt;/a&gt;でreleaseに生成したバイナリをアップロードします。&lt;/p&gt;
&lt;h2&gt;homebrewの自動化&lt;/h2&gt;
&lt;p&gt;homebrewのformulaを自動更新するactionを作りました。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/magcho/dotz/tree/master/.github/actions/update_homebrew&quot;&gt;https://github.com/magcho/dotz/tree/master/.github/actions/update_homebrew&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;brewの公式リポジトリではなくオレオレformulaを対象としています。更新するactionとuploadするactionを分けたので後者を公式リポジトリにPRを送るactionに差し替えれば運用できるかなと思います。&lt;/p&gt;
&lt;p&gt;内部でやっていることは既存のformulaをcurlで落とし、&lt;a href=&quot;https://github.com/magcho/dotz/blob/718af61a0ac6efa050e8ff718213d5f1a564350c/.github/actions/update_homebrew/src/main.js#L35-L36&quot;&gt;ここで&lt;/a&gt;バイナリのURLとsha256を更新しているだけです。&lt;/p&gt;
&lt;p&gt;formulaによっては書き換えルールを追加しなければいけないかもですね。&lt;/p&gt;
&lt;p&gt;formulaのtestとformatを掛けたのち、formulaをuploadします。formulaのリポジトリにpushしたいところですがworkflowに払い出される通常のGitHub tokenでは実行リポジトリ以外にpushできないので別途用意します。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;githubの個人設定&lt;/a&gt;からPersonal access tokenを払い出してリポジトリのSettingタブ-&gt;Secretsから任意の名前でsecretに登録しておきます。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9a4506b68743fbaf53a5606f177a7fdf/1a867/0601.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkElEQVQoz5WTzXKjMBCEef9X2QfIec+57nVjx2DsdWwE+kH/+lIStrOnbC1VTc9oxNDTgu44eUbh0C4RU0UmxNTwiB+cUsZZyziOTGLBrJbz5Yo2K5fr1PJuloZFrUhlWK1jXhRmdW1TXVN6RWqDNpZFKqY/R26nHus8PsQnOx8ad/WWUySE0BQasyLEjPOelO6qm7qNq9qUC6WwAZ5xzoVumALGZ0pdAax1XC4feO9bnvNWq9ziO+r4MUZSjBun1PZ1FxkJ6auhlIrdbs8wDA37/TuHfuDQ9/x+2zEMR94PPafzuU0yzZJ5kVhr2/PdUQTSXUWFdY7bIhFKI6RC1FjMLItkmkTjmksp2yEsNuPTJqYpHEXA+txMqB7kkuHXK/x8gZcf0O/4/irNAiMWgg9VYSTE3Aq1YUwROY3o24i+HlFqwudIyQ8f/+Ztquqf/rjiraM7CctNb01LyW18FTM6FRyQKM+D+Q5VXYqJ7ioUsY16f1suaJdRNm3K/9HogaeH9Q/J+es7exSf/pT/wyc4E1oHf7lVCAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;0601&quot;
        title=&quot;0601&quot;
        src=&quot;/static/9a4506b68743fbaf53a5606f177a7fdf/fcda8/0601.png&quot;
        srcset=&quot;/static/9a4506b68743fbaf53a5606f177a7fdf/12f09/0601.png 148w,
/static/9a4506b68743fbaf53a5606f177a7fdf/e4a3f/0601.png 295w,
/static/9a4506b68743fbaf53a5606f177a7fdf/fcda8/0601.png 590w,
/static/9a4506b68743fbaf53a5606f177a7fdf/efc66/0601.png 885w,
/static/9a4506b68743fbaf53a5606f177a7fdf/c83ae/0601.png 1180w,
/static/9a4506b68743fbaf53a5606f177a7fdf/1a867/0601.png 1998w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;あとはworkflowから&lt;code class=&quot;language-text&quot;&gt;${{secrets.****}}&lt;/code&gt;で参照できるのでtokenを渡しておきます。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;.github/workflows/build.yml&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;~~~~抜粋
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; create commit
  &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
    sh ./ci/create_commit.sh &quot;dotz.rb&quot; &quot;magcho&quot; &quot;${{ secrets.github_personal_acces_token }}&quot; &quot;mail@magcho.com&quot;&lt;/span&gt;
~~~~抜粋&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これにてtag付きでmasterにpushすれば勝手にリリースまでやってくれるようになります。&lt;/p&gt;
&lt;h2&gt;おわり&lt;/h2&gt;
&lt;p&gt;そういやGitHub actionsハッカソンがありました。気づいた時は最終日でしたが、、&lt;/p&gt;
&lt;p&gt;github actions marketplaceに全然actionの種類がないなーと思ってたとこなのでハッカソンで一気に増えた感じですかね。自分もなんか出したかったな。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[youtube liveでネット配信をやったレポ]]></title><description><![CDATA[感染防止などの理由でいつもは集まって行なっていたミーティングができなくなってしまったので、今回youtube live…]]></description><link>https://blog.magcho.com/2020/4/ネット配信をやってみたレポ/</link><guid isPermaLink="false">https://blog.magcho.com/2020/4/ネット配信をやってみたレポ/</guid><pubDate>Wed, 01 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;感染防止などの理由でいつもは集まって行なっていたミーティングができなくなってしまったので、今回youtube liveでリアルタイム配信をやってみたレポートです。&lt;/p&gt;
&lt;p&gt;使用した機材やつまづきポイントなどを書いておくので何かの助けになれば幸いです。&lt;/p&gt;
&lt;h2&gt;事の発端&lt;/h2&gt;
&lt;p&gt;大学のサークルにて月に一回所属している人を大教室に集めて情報共有などを行う習慣があり、2月までは大教室に付属するプロジェクターとマイクを用いて講義のような形式で行なっていた。しかし3月は感染防止の観点から大学側より集会禁止の通知が届いたため中止に。&lt;/p&gt;
&lt;p&gt;この時期は大学のサークルということもあり新歓などで慌ただしく情報共有の場が必要でした。その他のことも忙しい時期らしい。なので予定していた日付はそのままで配信集会をやろうということになった。&lt;/p&gt;
&lt;h2&gt;配信準備&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b304987ba687614eaa59f1e4b7015a4a/493ac/01.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEQElEQVQ4yx3Ri1PMCQDA8d/dnEKuyyo9pUY3Ws10dJXK6k3v1rYWpa22XFk9VVrVhlJ5ZHJldV3u1iPPkAsRESNOHEY4enAqRyo0rrvuZs7N92b8B9/5fIU3L57w9kU3oy97eD/ygvHR1/zzxwgfxkfhv3HgX+ADfPiLv8feMPZukNGR33n7up/R1/28H+pnbLif8XcDjA72IowNPmXw2UMGeu7z7PE9nj65T++TTh4/usvDzl+43dHO3VvX6HvWxdCr54wM9vFmaIA/3w8x/Oo5L/u6GRroYXigC1VcDELDvjpaT+k516AnK1lJ/Y71rJT5oVL4Ig31wcF6GpnKZPRbqinTlJKpVrO9eANbSzfT8fMV+nof0N/zKzevXsTJaQ6Cm6sLuepESvIykIcFoFklJ1bmj9tXX+I02x6TKYYkyZScrzvOd9pKIgN8yS9KYZ6fB+fPHqP/6UM679yiZGMh4eEhCBJXd2xmzMBkqgnTzUyZbGSE4SQDTKaJsJ1py6dTJuIuFrMsLoeigmqyIqOoXrEExUIfZLJgopcvpVZXhVjsyByxI8L8eWLs7GYyaeJEjI2nYGc/E29/L8SOs/D09CA8IoRYhRw//zDCgxVESuOISdIi8QpBZGKMkZER+XnZ2NhYM2nyZITCeAWF2SlIw8PI0RRzqe0GV653EiWPwdTMgoSEeLaUaclRR+Pt5YKlhQ3BwVIkPosxmPAZDg6zkEaEYmVlib2dHcLpI3tJS07jG3U25WWN5BRUoUjRUrqjhuodJSSoEvD1W4giMoAlEYGESmNJytURnlqJ5wIvfBd6IJk/F0EQcHdzRdhWWow2vxC1KpE1GRoio6JRKpXovq2g9Vwjuppa9h1uIEIqJytDzeWW42gL1qHbpWP5ylQkfjE4ugYR6O+NKi4a4WZ7K2+H++h6cJu2C00c3FfHxZbT9HZ30tTUSPOFi1x/1Evltu1EySLIyVJzQK+job6GdWvTcHJbQqB8DRKJOwkrlyHMdXYiJCgAL4/5bCjUsDZDTfmmPM6c1NN0Yi/nTx/lZOMJWppPUL9fx+qUJApyc0hLVXPy6I/cu9HCuVMHKcrPZnfFBoSQIB9c5jrhYGvBJ4Lw0SLga3uSpB5sXCOlJGMpG1Nl5CVGkJkhRxUfhr2t9cerwYv9qCjLo35PFTcunyUpbgVCskqBp7szYYt8sLU2x9dtNqWZCqoKE/hhczJ7SlZRqYmhPD2KouRA4iNcsDIzxsBgAoaGBh8DLC3NKS0uoqhwPYImXYk0wIVF3u7IghZQqYml/XAZHQ1baTuwiebaPM7U5HJwy2p2FyjZuzmRMG9nbGdYME30BSLRVMxMRSxwd6ZIk47QWLuJjpZDPLjWxJ2fdtF9SU9vm57+a/v57aqertbvudlQQfuhcprrtBzbmcPyUC+mi4yxsjDF3NwMkcnnaNITuNp8hP8B6T/GHdLxY9YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Alt Text&quot;
        title=&quot;Alt Text&quot;
        src=&quot;/static/b304987ba687614eaa59f1e4b7015a4a/fcda8/01.png&quot;
        srcset=&quot;/static/b304987ba687614eaa59f1e4b7015a4a/12f09/01.png 148w,
/static/b304987ba687614eaa59f1e4b7015a4a/e4a3f/01.png 295w,
/static/b304987ba687614eaa59f1e4b7015a4a/fcda8/01.png 590w,
/static/b304987ba687614eaa59f1e4b7015a4a/efc66/01.png 885w,
/static/b304987ba687614eaa59f1e4b7015a4a/c83ae/01.png 1180w,
/static/b304987ba687614eaa59f1e4b7015a4a/493ac/01.png 4032w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e3d45881556539bdcf10c97795c3dbf7/f2991/02.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAduwSD//xAAWEAADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQEAAQUCKv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABkQAAIDAQAAAAAAAAAAAAAAAAAhETFRYf/aAAgBAQABPyGK6IPD/9oADAMBAAIAAwAAABD33//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ECf/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhUTFBgf/aAAgBAQABPxAs2XCKHTrcFnD1n//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Alt Text&quot;
        title=&quot;Alt Text&quot;
        src=&quot;/static/e3d45881556539bdcf10c97795c3dbf7/1c72d/02.jpg&quot;
        srcset=&quot;/static/e3d45881556539bdcf10c97795c3dbf7/a80bd/02.jpg 148w,
/static/e3d45881556539bdcf10c97795c3dbf7/1c91a/02.jpg 295w,
/static/e3d45881556539bdcf10c97795c3dbf7/1c72d/02.jpg 590w,
/static/e3d45881556539bdcf10c97795c3dbf7/a8a14/02.jpg 885w,
/static/e3d45881556539bdcf10c97795c3dbf7/fbd2c/02.jpg 1180w,
/static/e3d45881556539bdcf10c97795c3dbf7/f2991/02.jpg 2222w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;今回使用した機材は以下&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ビデオミキサー V-1HD Roland&lt;/li&gt;
&lt;li&gt;PC (配信用, 映像素材出し用, パワポ用)&lt;/li&gt;
&lt;li&gt;カメラ GH4 Lumix &amp;#x26; Dock&lt;/li&gt;
&lt;li&gt;カメラ Blackmagic Pocket Cinema Camera 4K BlackmagicDesign&lt;/li&gt;
&lt;li&gt;マイク 2本  AT808G AudioTechnica&lt;/li&gt;
&lt;li&gt;集音マイク RTA-M dbx&lt;/li&gt;
&lt;li&gt;音響卓&lt;/li&gt;
&lt;li&gt;ビデオキャプチャー blackmagic intensity shuttle blackmagicDesign&lt;/li&gt;
&lt;li&gt;SDI-HDMIのコンバータ blackmagicDesign&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;なんだかごちゃごちゃですね、普段は映像撮影とかPAとかしているサークルなのであり合わせの機材です。&lt;/p&gt;
&lt;h2&gt;カメラ&lt;/h2&gt;
&lt;p&gt;要件として電源を繋いで常時給電ができ、リアルタイム映像が出力できるカメラでないといけません。詳しくないんですがコンデジではリアルタイム映像が出力できなかったりするらしい。&lt;/p&gt;
&lt;p&gt;さらに配信に向けてバッテリー残量や撮影モードなどのステータスなどが出力されないものが好ましいです。表示の消し方は事前に調べて設定しておかないと本番でグダリます。非表示にできないカメラも多いらしいので要事前調査。&lt;/p&gt;
&lt;p&gt;GH4はAFアイコンの消し方がわからず本番時はMFでカメラ係が頑張ってました。映像伝送は長く引き回せるようにSDIに変換しています。&lt;/p&gt;
&lt;h2&gt;ビデオミキサー&lt;/h2&gt;
&lt;p&gt;配信の構成として司会+喋る人の2人がカメラ前にいて、2人が映る引きの絵(カメラ固定)としゃべっている人を1人だけ写すためのカメラの2台構成です。&lt;/p&gt;
&lt;p&gt;喋る時にはパワポを写して、ワイプでしゃべっている人を出したかったのでビデオミキサーを用いて映像を混ぜています。&lt;/p&gt;
&lt;p&gt;この操作が難しくてミスしょっちゅうミスする、、、どのボタン押せばパワポだっけ？？ってなるのでプロの方の偉大さを実感できます。&lt;/p&gt;
&lt;h2&gt;マイク&lt;/h2&gt;
&lt;p&gt;出演者は2人固定なので2本の演台マイクを設置、さらに控えている人もどうせ喋るだろうと思ったので天井から無指向性マイクをぶら下げてみました。音響卓で出演者より小さめに控えている”ガヤ”の声を混ぜるといい感じです。&lt;/p&gt;
&lt;p&gt;配信をみている人は1人でイヤホンか何かで聞いていると思いますが、演台マイクはリップノイズだったり環境音だったりを結構拾います。変な言い方ですが未処理の音声にはリップノイズやら鼻息やらでイヤホンでずっとは聴いていられないと思うのです。なので誤魔化す意味も含めてガヤを入れてみました。BGMをうっすら流しておくのも効果あると思います。&lt;/p&gt;
&lt;h2&gt;使用ソフト&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;パワポ用PC(Windows)
&lt;ul&gt;
&lt;li&gt;PowerPoint Microsoft&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;映像素材出し用PC(mac)
&lt;ul&gt;
&lt;li&gt;ProPresenter Renewedvision&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;配信用PC(mac)
&lt;ul&gt;
&lt;li&gt;OBS Open Broadcaster Software&lt;/li&gt;
&lt;li&gt;Audition Adobe&lt;/li&gt;
&lt;li&gt;soundflower&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;パワポと素材はビデオミキサーに入力しています&lt;a href=&quot;https://renewedvision.com/propresenter/&quot;&gt;ProPresenter&lt;/a&gt;というのは現場で映像屋さんに教えてもらったプレゼン用のソフトウェアです。映像を出力しながら次の映像素材のチェックのための再生を手元の画面にだけ写せるなど業務用のソフトウェアです。&lt;/p&gt;
&lt;p&gt;日本語化はされておらず、業務用なので日本語情報がほとんどありませんが商用なので公式のDocumentがしっかりしています、ご興味があればぜひ。試用期間内なら制限なく無料で使えます。&lt;/p&gt;
&lt;p&gt;OBSは配信用のソフトウェアとしてかなりのシェアのあるOSSです。日本語情報も多く戸惑うことはなさそうです。キャプチャーボードによってはOBSが認識しないため、一度別のプロトコルに変換するなど手間をかけるものもあるらしいですがBlackmagic社のキャプチャーボードはOBSに認識されますので安心です。&lt;/p&gt;
&lt;p&gt;見逃しがちなのですが、配信の中で音声の大きさがバラバラだと少し問題になります。数年前のyoutubeでは動画自体の音量が小さくで端末のボリュームを大きくしたらCMが流れてきてCMの音が大きくてビックリする！なんてことがあったんですが、そこらへんをyoutubeが自動的に動画の音量を調整してくれるようになってます。「youtube ラウドネス」で検索すると情報が出てきますので気になる方は是非。&lt;/p&gt;
&lt;p&gt;そんなラウドネス規定ですがyoutube公式に値を発表していませんが動画では-13LUFSを超えるとyoutube側で調整が入ると言われている？らしいのでyoutube liveがどうなのかはわかりませんがこれに合わせてみました。測定にはAuditionのラウドネスメータをを用いています。Auditionの[エフェクト]-&gt;[スペシャル]-&gt;[ラウドネスメータ]から呼び出せます。&lt;/p&gt;
&lt;p&gt;さらに今回のマイク配置で演台マイクと無指向性マイクの音を拾うエリアが一部かぶっていたので位相モニタ？ができるVSTプラグインFlux Stereo Tool v3を表示させています。これは以前現場でバウンダリーとワイヤレスのピンマイクの両方で集音していたらワイヤレスの方が半周期分遅延してミキサーに入力されたため電話越しのような音になってしまった経験があるので一応確認します。実のところモニターの詳しい見方がわからないのですが画面上でピカピカしていると気分が上がるので100点です。&lt;/p&gt;
&lt;h2&gt;ハマりポイント&lt;/h2&gt;
&lt;p&gt;今回初めて配信をやってみて苦労した点、次回改善したい点を挙げておきます。誰かの助けになれば幸いです。&lt;/p&gt;
&lt;h3&gt;1.カメラからの入力がチラつく&lt;/h3&gt;
&lt;p&gt;今回使用したビデオミキサーはRoland社のV-1HDです。機器背面のスイッチにて入出力するHDMIの方式を設定できます。PCや民生用プレイヤーなどではHDMIのコネクション確立時に受け手側の画面サイズを検出して出力サイズや方式を自動で合わせてくれますが今回使用したカメラは2台ともそうではなかった。&lt;/p&gt;
&lt;p&gt;V-1HDには背面スイッチで(1080i, 1080p, 720p)に切替が可能です。キャプチャーボードのintensityの入力仕様も見ると1080でキャプチャするには1080i/50iまたは1080i/59.94のどちらかを使用することになります。&lt;/p&gt;
&lt;p&gt;するとV-1HDに入力するにはカメラ側の出力設定を1080/59.94i, 1080/50i, 1080/59.94p, 1080/50pのどれかに設定する必要があるのです。普段民生機しか触らない身からするとPCは繋いで映るのにカメラは映らなくて半日ほど悩みました。類似の事象を検索するもこういうことはプロに任せる分野ですからほとんど情報がありません。後で聞いたらそういうものはビデオミキサーに入力する前に信号形式を変換してミキサの形式に統一して運用するものらしい。確かにブラマジのHPにそういう製品あったな。&lt;/p&gt;
&lt;p&gt;設定方法はカメラごとにだいぶ違いますし、そもそも設定できない形式もあります。事前にカメラ・キャプチャーボード・ビデオミキサの入出力仕様を調べてプランニングしておくべきです。&lt;/p&gt;
&lt;h3&gt;2.配信画面のインターレースを解除できない&lt;/h3&gt;
&lt;p&gt;これは完全に調査ミスです。intensityの仕様から1080/50iでキャプチャしましたがyoutube liveサーバーはプログレッシブを受けます。intensityの設定でデインターレースできないかと探しましたが。OBSにデインターレース機能があるようです。次回からはこれを使います。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ba790213b1d1ca1e4f4e714435bd061b/2b608/03.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAClklEQVQ4y22T227bVhBF6fa5aBsZaBSJlETZkCvJFm+HV90sUqREMtTFtJu4iX8gDwXaIkW/fhWkHCBB/bBwZuZhz8bMHEmz5pxJEtILKIrC4/tH4nWM67j4nl9TxbIsE8cxxduCNE3ZJBv6/T7ScCz4/ruzb4TOzk65LCscDnfMZgtc18Pzghrbdul0OkyDKY7t1MyCGaqqIjn+6kV3Fe3mLzzsCzbhLYGlMxVGTRXL7Ra+H+BVjVyP+WxOt9tFiuIdr37+iUbjnEajceL8nFc//kBbW6A9/ovx298Mys9c3H3msvwH9fAXI8MlXC5rsWoEldvRcIS0DDN2u4LdbvcN+13BMitx8w8E2Xus/Ak9fULbfmQcvSPf3fFQlvVMv4hWs5YWq4ws3ZJl2f9Yr5YUm5hDnpJGt6znAdE8wDc10u2Ww/5QC30RjMIIaZ3sybKUPM/rbVVCVVwRRWuKYs9+f+RwLDkeyzqvFpTECfflPYEf1GJCCMIwRErSO9ZRSJJsKIqC7XZLHCdsk4TVYk6+2bAIfFzLxBMWnuMgTLt2czwccZ4dRrcRUbhGMuwl89kUYYnnM3CxtAl2co/97k/ij38QPHxitHlC2/yOOV3iBBZJkvBQ3vM2y5nPZghfoFsTpMHw1LXX7SG3ZTpKh46scPnrDd2RQLnSka8MWlcmykBjoAkuhIcWhHirDC/MmfgrmsMJ8lhHaikDOrJci31Nv9ej3XyN3GwiN1+jVPGbJn31gla7y5u2QrMl17TaHRRFRVZUpMuBhmsLLNPCFjaGpnNzfc06ilguTndW/YRqJIauMx4OUbtd+qpKv6fWjb9G6l1OsCwH3bAxzNOr6wLb9rGEh2m5dd14rt9MTMbX+gtoNf8BwNuiqUGO3eEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Alt Text&quot;
        title=&quot;Alt Text&quot;
        src=&quot;/static/ba790213b1d1ca1e4f4e714435bd061b/fcda8/03.png&quot;
        srcset=&quot;/static/ba790213b1d1ca1e4f4e714435bd061b/12f09/03.png 148w,
/static/ba790213b1d1ca1e4f4e714435bd061b/e4a3f/03.png 295w,
/static/ba790213b1d1ca1e4f4e714435bd061b/fcda8/03.png 590w,
/static/ba790213b1d1ca1e4f4e714435bd061b/efc66/03.png 885w,
/static/ba790213b1d1ca1e4f4e714435bd061b/c83ae/03.png 1180w,
/static/ba790213b1d1ca1e4f4e714435bd061b/2b608/03.png 1540w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;3.BGMに著作違反がありアーカイブが公開できなかった&lt;/h3&gt;
&lt;p&gt;youtubeはJASRAC楽曲に対応しているので配信前は深刻に考えていませんでした。実際に動画で著作音源を仕様した経験があるが広告収入を著作主に配当させる設定を行うことで動画の公開ができていました。&lt;/p&gt;
&lt;p&gt;JASRACで管理されていない楽曲や管理されていてもyoutubeなどで使用することを認めていない楽曲もあり、そういった場合は配信終了後にーカイブを配信停止されてしまいます。&lt;/p&gt;
&lt;p&gt;youtubeのWEB UI上で当該の楽曲が使用されている部分を無音にするか動画を切り詰めるかを選択することができます。今回BGMを流していた部分は配信開始までのカウントダウンを行うシーンと配信終了後のテロップ部分だけでした。なのでここをトリミングすることでアーカイブを配信できます。&lt;/p&gt;
&lt;p&gt;youtubeは著作的な問題が起こっても対応手段を提供してくれるのでとてもありがたいです。が今回のようにクリッピングを行なった際には生配信中のコメントが全て消えてしまうようです。それを考えると著作には気を配るべきでした。&lt;/p&gt;
&lt;h3&gt;4.音ズレ・音割れ&lt;/h3&gt;
&lt;p&gt;配信時には気がつきませんでしたがアーカイブを見ると映像が音声より0.3秒ぐらい遅れていました。OBSにて映像にディレイをかけられるので配信時は本番前のプレビューをyoutube上で確認しながら調整すると良さそうです。&lt;/p&gt;
&lt;p&gt;今回音響卓からのアウトをV-1HDのAudio INに入れてみました。受け手側で音のレベル調整をして60あたりにセットしましたが(デフォルトは100)これはアッテネーターではなくビデオミキサー内のミックス用のレベルなようです。音量は下がっても受け手側でピークになるレベルは変わらない。なので別途アッテネーターやプリアンプのようなものを用意するのが良さそうです。&lt;/p&gt;
&lt;h2&gt;慣れている人に聞いたこと&lt;/h2&gt;
&lt;p&gt;普段からに関わっている人にお話を聞けたのでここにメモしておきます。&lt;/p&gt;
&lt;h3&gt;音声レベルに注意&lt;/h3&gt;
&lt;p&gt;こういったプロの演者さんでない場合はマイクに向かって笑い声や咳などをしてしまうことがありがちだそう。コンプ・リミットをかけておくと少し安心。&lt;/p&gt;
&lt;h3&gt;配信終了後はしばらく放置&lt;/h3&gt;
&lt;p&gt;実際に配信してみるとユーザーの手元のスマホなどに映るまで30秒以上のラグがあります。しかし配信が終わってyoutube上の配信終了をクリックするとユーザーの画面は即時に配信終了となってしまいます、下手すると最後の30秒は配信を見れずに終了してしまうことに。なので配信自体が終了してもロゴやテロップを数分流しておく必要があります。&lt;/p&gt;
&lt;p&gt;企業の配信などで「ご視聴ありがとうございました」の文面が3分ぐらい流れているのはそういった理由らしい&lt;/p&gt;
&lt;h2&gt;終わり&lt;/h2&gt;
&lt;p&gt;今回配信してみて感じたことは、難しいことはプロに頼もう&lt;/p&gt;</content:encoded></item><item><title><![CDATA[use-packageについてまとめる]]></title><description><![CDATA[Emacsのパッケージマネージャーのuse-package.el…]]></description><link>https://blog.magcho.com/2019/12/use-package/</link><guid isPermaLink="false">https://blog.magcho.com/2019/12/use-package/</guid><pubDate>Mon, 02 Dec 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Emacsのパッケージマネージャーのuse-package.elにはパッケージインストールの他に任意のタイミングで評価させるキーワードというものがありますが、自分はこれをよく分からず使っているので調べてまとめます。&lt;/p&gt;
&lt;h2&gt;実行タイミング&lt;/h2&gt;
&lt;p&gt;評価の順番はこうなります&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;パッケージ名の実在確認&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;:preface&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;:if, :when, :unless&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;:init&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;:require&lt;/code&gt;パッケージをロード&lt;/li&gt;
&lt;li&gt;パッケージをロード&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;:config&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;インストールするパッケージの設定を記述するためのキーワードです。&lt;/p&gt;
&lt;h3&gt;:preface&lt;/h3&gt;
&lt;p&gt;条件分岐キーワードを同時に使用していた時でも、条件分岐よりも先に評価されます。つまり、指定したパッケージ名が実在するならば真っ先に必ず評価してくれます。&lt;/p&gt;
&lt;h3&gt;:init&lt;/h3&gt;
&lt;p&gt;パッケージが読み込まれる前に評価されます。遅延キーワードの影響を受けません。&lt;/p&gt;
&lt;h3&gt;:config&lt;/h3&gt;
&lt;p&gt;当該のパッケージが読み込まれた後に評価されます。initに比べ、configは後述の遅延ロードを設定した際にパッケージがロードされるまで評価されなくなります。&lt;/p&gt;
&lt;h2&gt;パッケージ設定&lt;/h2&gt;
&lt;h3&gt;:custom&lt;/h3&gt;
&lt;p&gt;パッケージの設定を書くキーワードです、&lt;code class=&quot;language-text&quot;&gt;(setq ~)&lt;/code&gt;と書いているのと同じことです。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; comint
  &lt;span class=&quot;token lisp-property property&quot;&gt;:custom&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;comint-buffer-maximum-size&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20000&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Increase comint buffer size.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;comint-prompt-read-only&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Make the prompt read only.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;var-name&lt;/span&gt; var-value &lt;span class=&quot;token string&quot;&gt;&quot;comment&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:custom-face&lt;/h3&gt;
&lt;p&gt;パッケージにカスタムフェイスを適用できます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; eruby-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:custom-face&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;eruby-standard-face&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lisp-property property&quot;&gt;:slant&lt;/span&gt; italic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;遅延ロード&lt;/h2&gt;
&lt;p&gt;emacs起動時に全てのパッケージを読み込んでしまうと起動に時間が掛かってしまいます、そこで起動時には読み込まずにパッケージが必要になったタイミングで読み込ませる遅延ロードという仕組みがあります。&lt;/p&gt;
&lt;p&gt;必要になったタイミングを検知する方法がいくつかあるため遅延キーワードも何個かあります。&lt;/p&gt;
&lt;h3&gt;:defer&lt;/h3&gt;
&lt;p&gt;実はemacs自体に遅延ロードを記述する&lt;code class=&quot;language-text&quot;&gt;;;;#autoload&lt;/code&gt;があります、パッケージ内にこのコメントに続いて遅延ロードに関しての記述をすることでemacs側が良しなにしてくれるので、パッケージの開発者がautoloadを設定してくれている場合はuse-packageで遅延キーワードを書く必要はないです。しかし、:ifなどの条件分岐キーワードを同時に使っている場合は期待している動作にならないため、autoloadに従うことを明示的に宣言する必要があります。その場合は&lt;code class=&quot;language-text&quot;&gt;:defer&lt;/code&gt;キーワードをつけます。&lt;/p&gt;
&lt;p&gt;その他、キーバインドなど自分で設定した項目を遅延ロードのきっかけにすることができます。以下のキーワードを用いて設定をすれば遅延ロードを自動で設定してくれます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; perl-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:defer&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; version2で指定秒数の遅延が追加されたようです。lspなど外部プロセスに依存するようなパッケージに有効ではないでしょうか。&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; perl-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:defer&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:commands&lt;/h3&gt;
&lt;p&gt;特定のコマンドを呼び出した時ににパッケージをロードします。&lt;code class=&quot;language-text&quot;&gt;M-x&lt;/code&gt;から呼び出した時のほかキーバインドに設定されていて、そのキーが押された時にも反応します。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; color-moccur
  &lt;span class=&quot;token lisp-property property&quot;&gt;:commands&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;isearch-moccur&lt;/span&gt; isearch-all&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;:commandsキーワードに続いてカッコで囲って列挙すればいいみたいです。&lt;/p&gt;
&lt;h3&gt;:bind&lt;/h3&gt;
&lt;p&gt;コマンドにキーバインドを割り当てます。:commandsキーワード+(bind-key ~)のことです。ここで割り当てるキーマップはローカルキーバインドを上書きをします。&lt;/p&gt;
&lt;p&gt;キーバインドに設定する値は&lt;code class=&quot;language-text&quot;&gt;(kbd xx)&lt;/code&gt;と同じ指定方法を使えます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ace-jump-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:bind&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token argument&quot;&gt;C-&lt;/span&gt;.&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ace-jump-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;:bindで設定するコマンドはパッケージ内でautoloadが設定されていることを想定しています、autoloadされていないコマンドのバインドを設定したい場合は:bind-keyを使用します。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; projectile
  &lt;span class=&quot;token lisp-property property&quot;&gt;:bind-keymap&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;C-c p&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; projectile-command-map&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:mode, :interpreter&lt;/h3&gt;
&lt;p&gt;メジャーモードの設定を行います。:modeはファイル名もしくは拡張子に紐づけることができます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; python
  &lt;span class=&quot;token lisp-property property&quot;&gt;:mode&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\\.py&apos;&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; python-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;;; パッケージ名がXX-modeとなっている場合は省略記法が使えます。&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ruby-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:mode&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\\.rb\\&apos;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;:interpreterはシバンで指定された言語のモードで開く設定です。&lt;/p&gt;
&lt;p&gt;シバンはプログラムの1行目に&lt;code class=&quot;language-text&quot;&gt;#!/bin/python&lt;/code&gt;のように実行するインタープリターを指定する記述のことです。
この指定されたインタープリターを元にメジャーモードを判定します。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; python
  &lt;span class=&quot;token lisp-property property&quot;&gt;:interpreter&lt;/span&gt; python&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:hook&lt;/h3&gt;
&lt;p&gt;他のコマンドが実行された時に、同時に実行したい時に使用します。
ファイル保存のコマンドが走った時にformatterを実行したい時などに便利です。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; formatter
  &lt;span class=&quot;token lisp-property property&quot;&gt;:hook&lt;/span&gt; save-buff&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:magic, :magic-fallback&lt;/h3&gt;
&lt;p&gt;ファイルの先頭に指定する文字列がないか確認し、一致する場合に指定のモードで開きます。&lt;/p&gt;
&lt;p&gt;emacsでテキストファイルでは無いものを扱う際にも便利なのでは無いでしょうか、もちろんテキストファイル(拡張子はjsだけど開きたいモードが違うとか)。docではpdfを例に挙げています。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; pdf-tools
  &lt;span class=&quot;token lisp-property property&quot;&gt;:magic&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%PDF&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; pdf-view-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;試しにPDFファイルをemacsで開いてみるとこんな感じでした。確かに1行目に&lt;code class=&quot;language-text&quot;&gt;%PDF&lt;/code&gt;の記述があります。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d4798eb86994de0708a4dd31128bc940/6c99d/pdf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABa0lEQVQoz6WRSVPCQBCF8zdIYVUSMkOSScgKSVj0hjdED7IJYoELaqkHb/74Z3VbHCgLS4rDN9M9y5s33dp5v4/xeITJZIKr4SWupyPMH5e4fVlh+brGbLXAbL3AfHOH5ds9RtMx1h9PePh8xubrnePRzQQXgwGGwyE0TykkzRZaRYm660G6LkzbgiVrjGGZMC0TlqjxumEaMIUFwzZ5JqonVeiVCnRdhxZFEXqnZ4iTBEmaIU5SKKXgOi6U58FXCp7nce4rH77v87ryFOd8xvdBOmEYQmsEAXrdLrIsQ57nKMsSnU6HYzoUxzHTaDT44vYBepTybUz7QRBAo6EoCiRJgmazyZBoWRTIWy0WztIf17Zt76dWY7Q4ilhASol6vQ7XdXdwHIf3hBCQfyElo0VhyILklC4L295FiINgh/RNqgc52ufg34LUJWoI2aVayAMd/RJM0xTtdps7SS7FsYJUQ+oytf1YMRL8Bg8VURvz4QFgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;opened pdf file by emacs&quot;
        title=&quot;opened pdf file by emacs&quot;
        src=&quot;/static/d4798eb86994de0708a4dd31128bc940/fcda8/pdf.png&quot;
        srcset=&quot;/static/d4798eb86994de0708a4dd31128bc940/12f09/pdf.png 148w,
/static/d4798eb86994de0708a4dd31128bc940/e4a3f/pdf.png 295w,
/static/d4798eb86994de0708a4dd31128bc940/fcda8/pdf.png 590w,
/static/d4798eb86994de0708a4dd31128bc940/efc66/pdf.png 885w,
/static/d4798eb86994de0708a4dd31128bc940/c83ae/pdf.png 1180w,
/static/d4798eb86994de0708a4dd31128bc940/6c99d/pdf.png 1447w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;文字列には正規表現が使えるみたいです。pngファイルをemacsで開くとこうなるので
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/52395ddcfedba26c997ee4dc17b6358c/2aa89/png.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVQoz01S2W7bQAzUpzSSEqTIS31I2ntXhwO0rh0URoocbtM06IH2/58n4Ehy+0BwySWHHJLZZrfF+8MNhk9bdB+usdvtsN/v8HG7xf5wg88vD7h9usPdzyOOf55x//yIx19POP7+Rv3l73c8/PiK+5cjDrcHZCvj8PbqCheXl8iLAkVRjro8R1GWKM5HXV6c03+W58iL/PSmXRa035zlyN4tlvBdD+M8bOrgu4HapRau7WmHfoPYD7CxhUsdbIh8y18cNrS188TJllUDGxMaF2BEGwsdIt86JAZqH1Abi3WjsW4UllVNqYxFbR19a6VRKY1sUTdw3UAQZR1MbCmVtmgmW/nAtyQt1hVWjWKy2AK8qpuTZKtGk5okSCdC1xDck95cIAzXcG2HWhvatu3IQjkPk1r4fsNcApqQUBtHigwmaDqBkfokLDz9SQPKRzIQhiKZtDzOrIVyYfyUIDcGzYsSn8x59guoMJNxsXiItLkUCZDKQmOuNBdgZz5CC72pE4mTZCkmPsb5sUi2rNVkRGqTptn4f92O1BPnJDbnFxLpypblAvQEnK2U5k1JNZvGRAFwXT91008LGGdZ/3cJbrrZed6ysGyxrpkslGVjPB8XTnQEhEmpG5nMbDjf9jTPWV4Bt8GZQKfrsLgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;open png file by emacs&quot;
        title=&quot;open png file by emacs&quot;
        src=&quot;/static/52395ddcfedba26c997ee4dc17b6358c/fcda8/png.png&quot;
        srcset=&quot;/static/52395ddcfedba26c997ee4dc17b6358c/12f09/png.png 148w,
/static/52395ddcfedba26c997ee4dc17b6358c/e4a3f/png.png 295w,
/static/52395ddcfedba26c997ee4dc17b6358c/fcda8/png.png 590w,
/static/52395ddcfedba26c997ee4dc17b6358c/efc66/png.png 885w,
/static/52395ddcfedba26c997ee4dc17b6358c/c83ae/png.png 1180w,
/static/52395ddcfedba26c997ee4dc17b6358c/2aa89/png.png 1698w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; hoge
 &lt;span class=&quot;token lisp-property property&quot;&gt;:magic&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.PNG&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; hoge-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;こうすれば&lt;code class=&quot;language-text&quot;&gt;.&lt;/code&gt;が任意の1文字&lt;code class=&quot;language-text&quot;&gt;(\211)&lt;/code&gt;にマッチするので対応できます。&lt;/p&gt;
&lt;p&gt;:magic-fallbackは拡張子がある場合はそちらを優先させるモード設定です。
モード指定の優先順序は:magic&gt;:mode&gt;:magic-fallbackとなっているので拡張子で判定するやり方とも共存できます。&lt;/p&gt;
&lt;h3&gt;:demand&lt;/h3&gt;
&lt;p&gt;逆に必ず起動時に読みこませたい時には、遅延キーワードを書かないだけでは完全に遅延を止めることはできません。パッケージ自体のautoloadの効果により自動的に遅延ロードするようになってしまうので、これを阻止して必ず読み込ませるためのキーワードが:demandです。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; html-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:demand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;条件分岐&lt;/h2&gt;
&lt;h3&gt;:if, :when, :unless&lt;/h3&gt;
&lt;p&gt;.emacsファイルを複数のOSで使い回す時などに特定のOSの時のみにインストールしたいパッケージがあるかと思います。そこで条件分岐を行いtrueになった時のみロードさせることができます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; exec-path-from-shell
  &lt;span class=&quot;token lisp-property property&quot;&gt;:if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;memq&lt;/span&gt; window-system &lt;span class=&quot;token punctuation&quot;&gt;&apos;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;mac&lt;/span&gt; ns&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;依存関係&lt;/h2&gt;
&lt;p&gt;ivyなどのパッケージの機能を強化するプラグイン的なパッケージをロードする場合、前提として大元のパッケージがインストールされていなければなりません、そこで依存関係を記述し自身のパッケージを読む前に依存パッケージをロードさせることができます。&lt;/p&gt;
&lt;h3&gt;:requires&lt;/h3&gt;
&lt;p&gt;当該のuse-packageを読み込む直前のタイミングで依存パッケージもロードします。遅延を行なっている場合は当該のパッケージの読み込みタイミングに従います&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:requires&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:requires&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;foo&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:after&lt;/h3&gt;
&lt;p&gt;当該のパッケージを指定のパッケージがロードされた後に続けてロードさせることができます。当該のuse-package句を読んだタイミングではなく、afterに指定したパッケージの読み込みタイミングまで当該パッケージの読み込みを遅延します。&lt;/p&gt;
&lt;p&gt;以下の例ではivyとhydraがどちらもロードされた直後のタイミングまで当該パッケージの読み込みを遅延します。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ivy-hydra
  &lt;span class=&quot;token lisp-property property&quot;&gt;:after&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;ivy&lt;/span&gt; hydra&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; もしくは&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ivy-hydra
  &lt;span class=&quot;token lisp-property property&quot;&gt;:after&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lisp-property property&quot;&gt;:all&lt;/span&gt; ivy hydra&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以下の例ではivyもしくはhydraのどちらか一方がロードされた直後のタイミングになります。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ivy-hydra
  &lt;span class=&quot;token lisp-property property&quot;&gt;:after&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lisp-property property&quot;&gt;:any&lt;/span&gt; ivy hydra&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;:after(:any(:all A B) (:all C D))&lt;/code&gt;のように:allと:anyを組み合わせることも可能です。&lt;/p&gt;
&lt;h2&gt;インストール元を指定する&lt;/h2&gt;
&lt;p&gt;配布されているリポジトリを指定したり、ローカルにあるパッケージをロードさせるための記述です。&lt;/p&gt;
&lt;h3&gt;:load-path&lt;/h3&gt;
&lt;p&gt;ローカルのファイルパスを指定します。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; my-package
  &lt;span class=&quot;token lisp-property property&quot;&gt;:load-path&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;~/emacs/my-package-dir&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:pin&lt;/h3&gt;
&lt;p&gt;パッケージを取得するリポジトリを指定できます。デフォルトではmelpaから取得し、melpaに存在しない場合はemacsに設定されているリポジトリを順次検索します。&lt;/p&gt;
&lt;p&gt;また、use-packageではなく手動でインストールしたパッケージもmanualを指定すればOKです。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; hoge
  &lt;span class=&quot;token lisp-property property&quot;&gt;:pin&lt;/span&gt; gnu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; org
  &lt;span class=&quot;token lisp-property property&quot;&gt;:pin&lt;/span&gt; manual&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;モードライン&lt;/h2&gt;
&lt;p&gt;モードラインに表示するXX-modeの記述を消したり、変更したりできます。&lt;/p&gt;
&lt;h3&gt;:diminish&lt;/h3&gt;
&lt;p&gt;モードラインの表記を消すには:diminishにモード名を指定します。モードラインに表示されている名前でではなくモード名を指定します。大抵の場合はXX-modeという形を取っています。表示を変更することもできます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;;; 表示を消す&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:diminish&lt;/span&gt; addrev-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; 表示を変更する&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:diminish&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;addrev-mode&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;AddR&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:delight&lt;/h3&gt;
&lt;p&gt;diminish同様モードラインの表示を消したり変更したりできます。こちらの方が高機能？らしいです。こっちの方が記述が少なかったりマイナーモードに加えてメジャーモードの表示も変更できます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;;; 表示を消す&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:delight&lt;/span&gt; addrev-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; 表示を消す(短縮記法)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:delight&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;;; 表示を変更する&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; addrev
  &lt;span class=&quot;token lisp-property property&quot;&gt;:delight&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;addrev-mode&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;AddR&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; 変数を利用して表示名を変更する&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; projectile
  &lt;span class=&quot;token lisp-property property&quot;&gt;:delight&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&apos;(&lt;/span&gt;&lt;span class=&quot;token lisp-property property&quot;&gt;:eval&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;concat&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;projectile-project-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;無効化&lt;/h2&gt;
&lt;h3&gt;:disabled&lt;/h3&gt;
&lt;p&gt;(use-package)句を全て無効化し、スキップします。:disabledをつけるとパッケージのロードのほか設定などすべての項目を評価しなくなります。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; hoge
  &lt;span class=&quot;token lisp-property property&quot;&gt;:disabled&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:config&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;abcde&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;バイトコンパイル関連&lt;/h2&gt;
&lt;h3&gt;no-require&lt;/h3&gt;
&lt;p&gt;設定を書いているファイルをバイトコンパイルするとエラーでうまく動かなくなったとき用設定？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; hoge
  &lt;span class=&quot;token lisp-property property&quot;&gt;:no-require&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:config&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hogeが読み込まれたタイミングで評価される&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:defines, :functions&lt;/h3&gt;
&lt;p&gt;use-packageでは遅延ロード等で当該のパッケージが読み込まれた後にしか評価されない:configなどがありますが、バイトコンパイル時には遅延によりパッケージを読み込んでいないので未定義エラーになることがある様です。これを避けるため同名でダミーの変数、関数を宣言しておき、当該のパッケージをロードしたときに上書きする様にしておくことでエラーを回避するテクニックのようです。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ruby-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:functions&lt;/span&gt; inf-ruby-keys
  &lt;span class=&quot;token lisp-property property&quot;&gt;:config&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token defun&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;my-ruby-mode-hook&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token arguments&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;inf-ruby&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;inf-ruby-keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;add-hook&lt;/span&gt; &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;ruby-mode-hook&lt;/span&gt; &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;my-ruby-mode-hook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;use-packageのextension&lt;/h2&gt;
&lt;p&gt;通常のuse-packageには実装されていない機能を追加するパッケージがあります。別途extensionを読み込むことで追加機能が使えます。&lt;/p&gt;
&lt;h3&gt;use-package-chords&lt;/h3&gt;
&lt;p&gt;複数キーの同時押し、または単一キーの複数回押しをキーバインドに設定できます、内部的に&lt;a href=&quot;http://www.emacswiki.org/emacs/key-chord.el&quot;&gt;key-chords&lt;/a&gt;を利用しています。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; use-package-chords
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:config&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;key-chord-mode&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; ace-jump-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:chords&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;jj&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ace-jump-char-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;; jの2回押し&lt;/span&gt;
           &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;jk&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ace-jump-word-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;; j -&gt; kの順で押した時&lt;/span&gt;
           &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;jl&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ace-jump-line-mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;; j -&gt; lの順で押した時&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;:ensure-system-package&lt;/h3&gt;
&lt;p&gt;依存関係があるのはemacsパッケージ間だけとは限りません、lspやprettierなど実行バイナリに依存しているパッケージもありますね。&lt;/p&gt;
&lt;p&gt;prettierコマンドがある時はパッケージをロードし、無い場合はOSのパッケージマネージャを用いてインストールを試みます。(macOSならhomebrew, ubuntuならapt)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; use-package-ensure-system-package
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;;; rgコマンドがなければ brew install rg を試みます&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; rg
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure-system-package&lt;/span&gt; rg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; コマンド名とインストールの時に指定する名前が違う場合&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;;; rgコマンドがなければ brew install ripgrep を試みます&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; rg
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure-system-package&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;rg&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; ripgrep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  
&lt;span class=&quot;token comment&quot;&gt;;; brewでは無いパッケージマネージャーを使う時&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; prettier-mode
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure-system-package&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;prettier&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;npm install -g prettier&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;さらにコマンドでは無いアプリケーションでも大丈夫みたいです、使うかなこの機能？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lisp&quot;&gt;&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;use-package&lt;/span&gt; dash-at-point
  &lt;span class=&quot;token lisp-property property&quot;&gt;:if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;eq&lt;/span&gt; system-type &lt;span class=&quot;token quoted-symbol variable symbol&quot;&gt;&apos;darwin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token lisp-property property&quot;&gt;:ensure-system-package&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/Applications/Dash.app&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;brew cask install dash&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;まとめ&lt;/h2&gt;
&lt;p&gt;とりあえずdocにあるものは全て書けたかなと思います。冗長になってしまいましたがこれでしばらくはuse-packageで迷うことはなさそうです。&lt;/p&gt;
&lt;p&gt;ここまで書いておいてアレ何ですが、use-packageを調べていて何度も見かけた&lt;a href=&quot;https://qiita.com/conao3/items/dc88bdadb0523ef95878&quot;&gt;leaf.el&lt;/a&gt;がとても気になっています。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Chromeのティラノサウルスについて調べた]]></title><description><![CDATA[google chrome…]]></description><link>https://blog.magcho.com/2019/11/dino/</link><guid isPermaLink="false">https://blog.magcho.com/2019/11/dino/</guid><pubDate>Fri, 22 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;google chromeにはネットワークに問題があると恐竜のイラストが表示され、スペースや上下キーで操作できる障害物避けゲームができることは有名な話ですね。自分はこの無愛想なデザインの恐竜がかわいくて好きです。&lt;/p&gt;
&lt;p&gt;さて、好きなものを身に付けたいという感情は自然の摂理ですが。この恐竜に関するグッズはgoogleのオンラインショップではTシャツしか販売していません、実店舗に置物はあるらしい。ストラップとかステッカーとかトートバックとかが欲しいんです。&lt;/p&gt;
&lt;p&gt;ないなら作るしかないので、そもそも作って問題ないのかを考え、ライセンス周りを調べてみたかった所存です。&lt;/p&gt;
&lt;p&gt;この恐竜はネットワークに問題がある時に加えて、chromeで&lt;code class=&quot;language-text&quot;&gt;chrome://dino&lt;/code&gt;にアクセスすることで表示することができます。これを見る感じdinoと呼ばれているみたいですね。&lt;/p&gt;
&lt;p&gt;ちなみにネットワークエラーの時には小さいdinoくんですが&lt;code class=&quot;language-text&quot;&gt;chrome://dino&lt;/code&gt;で表示したdinoくんは画面幅一杯まで拡大され、大きいdinoくんに浸ることができます。&lt;/p&gt;
&lt;h2&gt;google Chromeについて&lt;/h2&gt;
&lt;p&gt;Chromeはgoogleが開発しているブラウザーであり、クローズドソースで開発しています。同じくgoogleが中心となって開発しているchromiumをベースにしています。OSSでない部分をgoogleが付け足したのがchromeのようです。次世代のEdgeと同じですね。&lt;/p&gt;
&lt;p&gt;chromiumは大半がBSDライセンスですが、MITライセンスなどなど物によってライセンスが異なるmixed licenseだそうです。&lt;/p&gt;
&lt;p&gt;さてここで問題のdinoくんですが、こちらはchromiumに搭載されているものであり、BSDライセンスが適用されています。著作権表示や許諾表示をすれば自由に個人利用、商業利用も可能ですね。やったね。&lt;/p&gt;
&lt;p&gt;chromiumに内包されているdinoくんですがこれはOSSなので実装を覗くことができますね。それではdinoくんの中身を見てみましょう。&lt;/p&gt;
&lt;h2&gt;dinoくんの実装&lt;/h2&gt;
&lt;p&gt;chromiumはgithub上でミラーされたコードを見ることができます、それっぽいファイル名を探していたらdinoくんの&lt;a href=&quot;https://github.com/chromium/chromium/blob/master/components/neterror/resources/offline.js&quot;&gt;実装部分&lt;/a&gt;を見つけました、Javascriptで実装されていますね。ここにもBSDライセンスであることが明記されています。&lt;/p&gt;
&lt;p&gt;余談ですが、chrome10周年を記念してバースデーケーキと帽子のアイテムが&lt;a href=&quot;https://github.com/chromium/chromium/commit/693b9fcac0ff52f6653c0a27815d39fd077856a4#diff-0e1aac1740e5d99418a0adeb215044bb&quot;&gt;追加&lt;/a&gt;されたことがありました。今は該当部分の実装は無くなっています。&lt;/p&gt;
&lt;h2&gt;ライセンス&lt;/h2&gt;
&lt;p&gt;ということでdinoくんはBSDライセンスということで大丈夫そうです。とりあえず自分用にdinoくんトートバックでも作ろうかな。&lt;/p&gt;
&lt;h2&gt;おまけ&lt;/h2&gt;
&lt;p&gt;この記事を書くためにdinoくんを眺めていたらdinoくんの描画の&lt;a href=&quot;https://bugs.chromium.org/p/chromium/issues/detail?id=1028467&quot;&gt;バグ&lt;/a&gt;を見つけたのでchromium issueに投げてみました、このてのコミュニティーにissueを投げるのは初めてで投稿カテゴリーを間違えてポストしてしまいましたが管理されているgoogleの社員の方に半日ほどで修正していただき、それから24時間しない間にdinoを実装された方からコメントがつきました。&lt;/p&gt;
&lt;p&gt;Chromiumというとても大きなプロジェクトで、優先度がかなり低いバグでも2日かからないくらいで修正に取りかかるのはすごいと思いました。さすがですね。&lt;/p&gt;
&lt;p&gt;おしまい。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[dotfilesを管理するツールを作った]]></title><description><![CDATA[増税前にPCを買い換えておこうと思い、高校の時に買ったMacBook Air 13-inch Early 2015から2019 MacBook Pro 2019 13-inch 4thunderbolt3 portsにしました。 メモリとかSSDとかも追加して、この度念願のUS…]]></description><link>https://blog.magcho.com/2019/09/dotz/</link><guid isPermaLink="false">https://blog.magcho.com/2019/09/dotz/</guid><pubDate>Fri, 20 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;増税前にPCを買い換えておこうと思い、高校の時に買ったMacBook Air 13-inch Early 2015から2019 MacBook Pro 2019 13-inch 4thunderbolt3 portsにしました。&lt;/p&gt;
&lt;p&gt;メモリとかSSDとかも追加して、この度念願のUSキーボードにしました。&lt;/p&gt;
&lt;p&gt;初バタフライキーボードです、このペチペチ感が楽しいです。&lt;/p&gt;
&lt;p&gt;さて、パソコンを買い換えたということは環境を再構築しなければなりません、大概のアプリケーションはhomebrewで管理しているのでインストール用のスクリプトを書いておけばいいですね。&lt;/p&gt;
&lt;p&gt;あとは設定周りのファイルを移行したいです。正直dotfilesを管理するツールはいくらでもあります。前はhomeshickを使ってましたがこれはディレクトリが追加できないなど、ちょっと不便だなぁと思うところが多かったので違うツールを探していたんですがGolangを使ってみたかったという適当な理由で自作してしまいました。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/magcho/dotz&quot;&gt;dotz github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;適当にロゴっぽいものをつけてREADMEを適当な英語で作っておけばそれっぽく見えますね。内容はただのlnコマンドなどのラッパーです。&lt;/p&gt;
&lt;p&gt;今回はGolang向けのコマンドラインアプリケーションライブラリの &lt;a href=&quot;https://github.com/urfave/cli&quot;&gt;urfave/cli&lt;/a&gt;を使いました。&lt;/p&gt;
&lt;p&gt;このライブラリではサブコマンドやパラメータのほか、yaml, toml, jsonなどの設定ファイルを読み込んだり環境変数を読んだりとcliアプリケーションを作る上ではこのライブラリで完結すると思います。あと、ドキュメント読まなくても書き始められるぐらいわかりやすい構造をしています。感動！！&lt;/p&gt;
&lt;p&gt;今回はとりあえずmacOS向けのバイナリしか作ってませんが、CIでそれぞれのOS向けのバイナリをビルドして公開してみようかなと考えています。&lt;/p&gt;
&lt;p&gt;また、今回はhomebrewの&lt;a href=&quot;https://github.com/magcho/homebrew-magcho&quot;&gt;オレオレformula&lt;/a&gt;も用意しているのでdotzのインストール自体もセットアップスクリプト内に収めることができますね、最高です。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[tmux上のemacsで下線が表示されなかった話]]></title><description><![CDATA[macOS(Mojave)でiterm2を使っています、emacsのテーマを設定していてunderlineが表示できなくて困りました。 emacsでは文字色や背景色のほか、文字の下線, 太字,  斜体, 取り消しなど色々な表記ができます。 自分の環境ではflycheck…]]></description><link>https://blog.magcho.com/2019/08/tmux-emacs-underline/</link><guid isPermaLink="false">https://blog.magcho.com/2019/08/tmux-emacs-underline/</guid><pubDate>Wed, 21 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;macOS(Mojave)でiterm2を使っています、emacsのテーマを設定していてunderlineが表示できなくて困りました。&lt;/p&gt;
&lt;p&gt;emacsでは文字色や背景色のほか、&lt;u&gt;文字の下線&lt;/u&gt;, &lt;strong&gt;太字&lt;/strong&gt;,  &lt;em&gt;斜体&lt;/em&gt;, &lt;s&gt;取り消し&lt;/s&gt;など色々な表記ができます。&lt;/p&gt;
&lt;p&gt;自分の環境ではflycheckのerror, warningなどが下線付きの書式になるはずでした。&lt;/p&gt;
&lt;p&gt;iterm2上で直接emacsを起動している時にはきちんと下線が表示されますが、tmuxセッション上でemacsを起動すると下線が表示されませんでした。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/278d07693c283ac5622e6fa4c48a363c/a3767/1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVQoz1WQW27TQBhGvQoECoUmbcZjj++xPU7aOEkT0YvSS4RoQlInBaSiFt4RG+AJiRUglsADG2BdyKdCcWklHo6+mX+ko+8fY/WuuH01OWU+m/J6NqNYvOZtMWU5e0kxndzOZ+csi4JVUVT55vKSm+tr3l9dsVouK5bFxfp+ezIe/zF+flvx/dOYX19O+f31jB+fj/k43+NmsceHxR7DQaeM21mZ7XRKrXWZJEkZx3GVaZo+sH6TQmBkOqGjW5wMYi7OOoyPNE1PUW8FNOIAM4uw2hG2DhGOxdbWFo1G43/q9Wpee/K4NJQXYisXFcXYOkP6AVbgolo+ThqikgAVB9iBh1Q2Qoiy2WxWCCG4xzRNnj2tYfg6p58PyPM+SaKxPAfLd7F8B+kppKuQ67Or8DwP13WrVEpxL22KZiXcWAtV0iXNR+h8SLqTE7ZC/DDAVgohTYSUd2maSCkfWAvum25vr8VmuVGrlYalHNLuLjrPyXpdOv0ufhIhlKyaPTT1/zX1FKayEObdmtISWE4T2zXZ3KxhdLOU/UGXLEnQnTYtneKGAVGa4Phe1dC0LSzXqf5Q2jbSUfiuQ+pHdIeC8WqDo8Vz9OARxuHqmJPLCcPFPrvTAb35kN1pn/5iRG8xYue8T28+IjlrV6STThkdJoQvYqL9hOigRXQQER+nbEd1/gIG4ijhNeudyQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;1&quot;
        title=&quot;1&quot;
        src=&quot;/static/278d07693c283ac5622e6fa4c48a363c/fcda8/1.png&quot;
        srcset=&quot;/static/278d07693c283ac5622e6fa4c48a363c/12f09/1.png 148w,
/static/278d07693c283ac5622e6fa4c48a363c/e4a3f/1.png 295w,
/static/278d07693c283ac5622e6fa4c48a363c/fcda8/1.png 590w,
/static/278d07693c283ac5622e6fa4c48a363c/efc66/1.png 885w,
/static/278d07693c283ac5622e6fa4c48a363c/c83ae/1.png 1180w,
/static/278d07693c283ac5622e6fa4c48a363c/a3767/1.png 1210w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b1a161b56c9322a8051ba695e48263c/a3767/2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2ElEQVQoz2WQW2+bMBiG+RG72JQ1Ug4YY2ODCdiQAEnXrG12kCZ1IqQHWCJtN/v/NxNvNEGaqtMuHll6P+vx689qfu6P5fc77PcNDocD9ocD6rpGta2wLcvjj6bB4/0DqrJEtd3ifrdD0zR4enrErqp6uryu6+On29s/1mX5gHT9Gen1Fyyvb7DebKDzHLrIEecZojRpzTxt02zRJknSaq1fMMb0aGP6mesQWDJMoGYxwpmGyeaI8hQ0EHATBdcouGnYw7SCzV1MJhOMx+N/GI1GfT5497a1pB9AeAJBHEEtEnjKB/U9sNAHixVYFIBHAVggQTkDIaS1bbuHEIIzjuNg+H4Ay9cFlsUl8nyFKDag0oPrn6CSgwreP0A9DikkhBCQUoJzjrPUtu1eeDEYwPLibl9rmOIKel5AzRR8FcDt2lAHhNLT6TiglL7QCf4Tdg2J4yKazxFnGZIiR1pkEGEAwt2+bd/SY6CCwREcjmAgjL6SnYSEPDc0xmC1WiHPc2SLBeIo7r/WXZ5Op609tc87wzOvs9YmndhuHeq0w4tBa62vCmw+LmGSGDyUkCaEb0IIreBFPpgS4DMJLw76OVcCbCYRRj7mWuPDVxd3v4f49muE9OYN/gJ4NB5en6KiSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2&quot;
        title=&quot;2&quot;
        src=&quot;/static/1b1a161b56c9322a8051ba695e48263c/fcda8/2.png&quot;
        srcset=&quot;/static/1b1a161b56c9322a8051ba695e48263c/12f09/2.png 148w,
/static/1b1a161b56c9322a8051ba695e48263c/e4a3f/2.png 295w,
/static/1b1a161b56c9322a8051ba695e48263c/fcda8/2.png 590w,
/static/1b1a161b56c9322a8051ba695e48263c/efc66/2.png 885w,
/static/1b1a161b56c9322a8051ba695e48263c/c83ae/2.png 1180w,
/static/1b1a161b56c9322a8051ba695e48263c/a3767/2.png 1210w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;そもそもターミナル上でこのようにunderlineやboldなどの文字装飾を行う時はANSIエスケープシーケンスかなーと思ったんですが
iterm直接とtmux上で&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;print &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[1m BOLD &lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[0m&lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[4m Underline &lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[0m&lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[7m Reversed &lt;span class=&quot;token entity&quot; title=&quot;\u001b&quot;&gt;\u001b&lt;/span&gt;[0m&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;を表示させても正しく同じ表示になります、アレレ。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/235b9d1380cd7f9ff09f6e65a16c9bcd/a3767/3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABt0lEQVQoz3WR2W7UQBQF2/bYHu9bu92L7SGzZQiJUJCGiC3w/5+EXBEiQShE4aEeb6mOrrjYbh92uwOH/ZHdds/oRuZpg3UT0zixnSdmZ7Fq4M1o2DjHab/n3emSq+OB69OR69Mlbw/7h9mZn6KSHcZqpJLIvkPKhqLMlrKplzJPlzL2ljoNljpdLbL0liISSyye8F+wEgLhJsdhbzifb/h2f2Yaa0ZXY12LVgW2i5l1wjQkzEOEaQNUHTA0K5LA+4e1LxYxaMnFRvLxfPOI1QWDyhmGCtWlqDrEyhjTxcgyoM08VO3TpB6xJ5a1L3iOsE6z22ru7m75cHvF0GeovkCpCtmmqCrEtBG6jZFFQJN5yNKnSv4jnMae467ny6dbPt9dY4cUo1K0ylHtGtuFuD7CyghVBXS5h+mCR2EkXhG2g2YwE50ySGWom54kr8kqSZ4V5FFIHkcUcUwW+iSBIPz9lD91LyvFvBm4Oml+fD9z//U9s8sZTY5zFVplTCpi1jGjitm6iI1e4eTT9FcLm66naVvsOKGNpSgKirKiqBvKPKdah1RJRJXGpCv/sShdPR0/q/wr/AVzIdYra/TySwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;3&quot;
        title=&quot;3&quot;
        src=&quot;/static/235b9d1380cd7f9ff09f6e65a16c9bcd/fcda8/3.png&quot;
        srcset=&quot;/static/235b9d1380cd7f9ff09f6e65a16c9bcd/12f09/3.png 148w,
/static/235b9d1380cd7f9ff09f6e65a16c9bcd/e4a3f/3.png 295w,
/static/235b9d1380cd7f9ff09f6e65a16c9bcd/fcda8/3.png 590w,
/static/235b9d1380cd7f9ff09f6e65a16c9bcd/efc66/3.png 885w,
/static/235b9d1380cd7f9ff09f6e65a16c9bcd/c83ae/3.png 1180w,
/static/235b9d1380cd7f9ff09f6e65a16c9bcd/a3767/3.png 1210w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;なのでemacsの設定が悪いのかと思って色々変えてみたんですが、結局はtmuxの設定でした。&lt;/p&gt;
&lt;p&gt;もともと、tmuxには256色に対応させるために以下の設定をしていたんですが、それが原因だったようでscreenではなくxtermにすると改善しました。&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;.tmux.conf&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# これはダメ&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; -g default-terminal &lt;span class=&quot;token string&quot;&gt;&quot;screen-256color&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# こっちにする&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; -g default-terminal &lt;span class=&quot;token string&quot;&gt;&quot;xterm-256color&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ちなみにtmuxのQ&amp;#x26;Aに書いてあった&lt;code class=&quot;language-text&quot;&gt;tmux-256color&lt;/code&gt;を設定するとemacsがエラーで起動しませんでした。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[homebrew-caskにないアプリは自分で追加しよう]]></title><description><![CDATA[Cask に追加してみる homebrew を更新し、作業中は自動更新を止める まずで更新をかけておきます、これで Cask 含め brew 本体も更新されます。 次に、homebrew は Cask…]]></description><link>https://blog.magcho.com/2019/01/homebrew-cask-add/</link><guid isPermaLink="false">https://blog.magcho.com/2019/01/homebrew-cask-add/</guid><pubDate>Tue, 20 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Cask に追加してみる&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;homebrew を更新し、作業中は自動更新を止める&lt;/p&gt;
&lt;p&gt;まず&lt;code class=&quot;language-text&quot;&gt;brew update&lt;/code&gt;で更新をかけておきます、これで Cask 含め brew 本体も更新されます。&lt;/p&gt;
&lt;p&gt;次に、homebrew は Cask を自動更新する仕様なので作業中はこれを止めておきます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;HOMEBREW_NO_AUTO_UPDATE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;環境変数なのでターミナルを開き直したあとや、別のターミナルには効きませんのでご注意を。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cask に追加したいアプリケーションをインストールしておく&lt;/p&gt;
&lt;p&gt;今までと同じようにブラウザでインストーラーなどをダウンロードし、インストールします。後々使うのでダウンロードしたファイルを消さないようにしましょう。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;github 上で&lt;a href=&quot;https://github.com/Homebrew/homebrew-cask&quot;&gt;homebrew-cask&lt;/a&gt;を fork する&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;local 上の homebrew ディレクトリの git に fork したリポジトリを追加する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token assign-left variable&quot;&gt;github_user&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;my-github-username&gt;&apos;&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;brew --repository&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;/Library/Taps/Homebrew/homebrew-cask
$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; remote &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${github_user}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://github.com/&lt;span class=&quot;token variable&quot;&gt;${github_user}&lt;/span&gt;/homebrew-cask&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cask 名を決める&lt;/p&gt;
&lt;p&gt;いわゆる&lt;code class=&quot;language-text&quot;&gt;brew cask install 〇〇&lt;/code&gt;のところの名前です。命名規則があるようなのですがこれを自動で決めてくれるコマンドがあります。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;brew --repository&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/Library/Taps/Homebrew/homebrew-cask/developer/bin/generate_cask_token&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/Applications/〇〇.app&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cask の定義ファイルを作る&lt;/p&gt;
&lt;p&gt;定義ファイルは.rb ファイルのテキストです。Stanzas という記法らしいです。これもコマンドにて雛形を作ってくれます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ brew cask create &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Cask名&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;定義ファイルを書く&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Homebrew/homebrew-cask/blob/master/doc/development/adding_a_cask.md#cask-stanzas&quot;&gt;homebrew-cask の仕様&lt;/a&gt;などを読みながら雛形の空欄を埋めていきます。&lt;/p&gt;
&lt;p&gt;ちなみに&lt;code class=&quot;language-text&quot;&gt;SHA-256&lt;/code&gt;の部分は.app ではなくダウンロードした.zip や.dmg などのファイルのハッシュ値です。これは以下のコマンドで確認できます。ダウンロードフォルダにファイルが残っていると思うので以下のような感じで確認できます。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ shasum -a &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;~/Downloads/〇〇.zip&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;また、url にバージョンの数字などが含まれる場合は変数としておくことでバージョンアップ時に定義ファイルを自動更新できるので変更しておきましょう。変数は&lt;code class=&quot;language-text&quot;&gt;#{version}&lt;/code&gt;で置き換えることができます。ここで注意したいのは先のコマンドで作った雛形ではシングルクオートですが、変数を含める際にはダブルクオートでなければなりません。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Before url &apos;https://example.com/app-v1.0.1.zip&apos;
After  url &quot;https://example.com/app-v#{version}.zip&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;name の部分にはスペースを含めることができます。大文字小文字やスペース位置などを正確に入力しておきましょう。&lt;/p&gt;
&lt;p&gt;app には&lt;code class=&quot;language-text&quot;&gt;/Applications&lt;/code&gt;にインストールされているファイル名を入力しておきます。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;書き上げた定義ファイルの確認&lt;/p&gt;
&lt;p&gt;まず実際にインストールできるか確認しましょう。手順の中ですでに PC 内にインストール済みなので、アンインストールするか、&lt;code class=&quot;language-text&quot;&gt;-f&lt;/code&gt;オプションで上書きしましょう。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ brew cask &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -f 〇〇&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;インストール後動作に問題がなければ OK です。&lt;/p&gt;
&lt;p&gt;定義ファイルのシンタックスチェックや、必要事項の記入漏れなどを確認・自動修正してくれるコマンドが備えれらています。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ brew cask audit 〇〇 --download
$ brew cask style Casks/〇〇.rb

$ brew cask style Casks/〇〇.rb --fix   // &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;- 自動修正してくれます。&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;これにて定義ファイルが完成です。次は PR をしていきます。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;変更を commit・push する&lt;/p&gt;
&lt;p&gt;コミットメッセージにもガイドラインが決まっています。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The first line is commit summary, 50 characters or less,&lt;br&gt;
Followed by an empty line,&lt;br&gt;
Followed by an explanation of the commit, wrapped to 72 characters.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Homebrew/homebrew-cask/blob/master/doc/development/adding_a_cask.md#commit-messages&quot;&gt;ここ&lt;/a&gt;には例とかもっと詳しいガイドラインの紹介とかがあります
そして fork した自分のリポジトリに push します&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; push &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my-github-username&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;branch名&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;プルリクエストを出す&lt;/p&gt;
&lt;p&gt;普通に Github 上でプルリクを発行します。メッセージに自動で必要項目の雛形が出てくるので記入、チェックを入れて PR しましょう。1~2 日ぐらいでレビュー or マージしてくれます。みなさん優しくて不都合があっても教えてくれます。&lt;/p&gt;
&lt;p&gt;これで晴れて homebrew のコントリビュータになれました！！ヤッタネ！！&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;最後に作業した環境を戻しておきます&lt;/p&gt;
&lt;p&gt;推奨されているのでやっときましょう&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;brew --repository&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;/Library/Taps/Homebrew/homebrew-cask
$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; checkout master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Apple watchを買った]]></title><description><![CDATA[先日 Apple watch のシリーズ 3 の 42mm モデルを買いました。ほんとは paypay のキャッシュバックキャンペーンで買いたかったんですが、忙しくて買い損ねてしまった。 スマートウォッチを買うのは初めてではなくて、5 月ぐらいから amazon で売ってる…]]></description><link>https://blog.magcho.com/2019/01/apple-watch/</link><guid isPermaLink="false">https://blog.magcho.com/2019/01/apple-watch/</guid><pubDate>Sun, 20 Jan 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;先日 Apple watch のシリーズ 3 の 42mm モデルを買いました。ほんとは paypay のキャッシュバックキャンペーンで買いたかったんですが、忙しくて買い損ねてしまった。&lt;/p&gt;
&lt;p&gt;スマートウォッチを買うのは初めてではなくて、5 月ぐらいから amazon で売ってる 3,000 円ぐらいの中国の&lt;a href=&quot;https://www.amazon.co.jp/dp/B075P36RJG/&quot;&gt;ヘルスケアバンド&lt;/a&gt;みたいなやつを買ってつけてました。iPhone の通知を振動とディスプレイで表示してくれるのでとても便利です。自分はお仕事柄暗くて大音量の音が鳴っている空間にいることがあるのでポケットにいれたスマホの通知に気が付きません。さらにスマートウォッチならバックライトがついてたり、有機 EL でディスプレイが光るので暗くても表示が見えて良きです。&lt;/p&gt;
&lt;p&gt;そして、apple watch に買い換えてからなんですが、以前のスマートウォッチに比べて画面が大きいですし、厚みが 5mm ほど増えました。たった 5mm じゃないかと思っていたんですが、つけて最初の 3 日間ぐらいは引き戸を開ける時や、引き出しを開ける時、本棚のほんを取るときなどに apple watch 本体をガンガンぶつけました。今は体が慣れてしまったのかぶつけることはなくなりました。たった 5mm に人間の神秘を垣間見た感じです、、大げさに言い過ぎですね。&lt;/p&gt;
&lt;p&gt;今の所、apple watch でよく使う機能は NFC 機能と Spority のリモコン、PokeGO です。これだけのためにスマートウォッチに 4 万も出したのかと言われそうですが、腕時計で 4 万と思えば許してもらえそうな気がします。&lt;/p&gt;
&lt;p&gt;そういえば、この spotify のリモコンなのですが、動作条件がちょっと特殊です、自分の使い方のせいなのですが。Spotify は apple watch にペアリングしている iPhone X と前使っていた iPhone5 と PC で利用しています。基本的に apple watch からはペアリングしている iPhone しか操作できないのですが、Spotify には再生同期機能がありまして、本来なら、スマホで止めた位置から PC などで続きが聞けるよ！な機能です。この機能は apple watch をのぞいて全てのプラットフォームで同期できます。&lt;/p&gt;
&lt;p&gt;なので PC の Spotify を apple watch で操作するときはまず、ペアリングしている iPhone を起動して PC と同期した上で PC で再生すると 3 つのデバイス越しに PC が操作できるというわけです。このときペアリングしている iPhone はバックグラウンドにしても大丈夫なので不便はありません。&lt;/p&gt;
&lt;p&gt;そういうわけで、Apple Music はできないけど Spotify は apple watch で全てのプラットフォームのリモコンになるよっていう話でした。&lt;/p&gt;
&lt;p&gt;今回もひどい日本語ですね。日本語が不自由だ。&lt;/p&gt;
&lt;p&gt;おわり&lt;/p&gt;</content:encoded></item><item><title><![CDATA[キャッシュレス決済について思うこと]]></title><description><![CDATA[来年の後半あたりからキャッシュレス決済に補助金がつくとかつかないとか言われてますね。自分は 4 月大学に入ってから出来るだけ現金を使わない生活をしてきました。理由としては家計簿を自動化したかったからです。 高校生の頃はあまり買い物もしなかったので zaim…]]></description><link>https://blog.magcho.com/2018/12/kyash-less/</link><guid isPermaLink="false">https://blog.magcho.com/2018/12/kyash-less/</guid><pubDate>Fri, 28 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;来年の後半あたりからキャッシュレス決済に補助金がつくとかつかないとか言われてますね。自分は 4 月大学に入ってから出来るだけ現金を使わない生活をしてきました。理由としては家計簿を自動化したかったからです。&lt;/p&gt;
&lt;p&gt;高校生の頃はあまり買い物もしなかったので zaim というレシートの写真を撮ると自動で家計簿をつけてくれるサービスを使っていました。しかし大学生になり、なんとかクレジットカードを作れるようになったので PASMO のオートチャージ機能をつけてみました。これがかなり便利で改札を通過する時に設定額を下回っている場合は自動で入金をしてくれるというものです。つまり改札にタッチした時には。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Ferica コネクション確立&lt;/li&gt;
&lt;li&gt;入場駅コード読み込み&lt;/li&gt;
&lt;li&gt;運賃計算&lt;/li&gt;
&lt;li&gt;カード内残高読み込み&lt;/li&gt;
&lt;li&gt;オートチャージ設定額取得&lt;/li&gt;
&lt;li&gt;チャージ処理書き込み&lt;/li&gt;
&lt;li&gt;書き込み正当性チェック&lt;/li&gt;
&lt;li&gt;運賃決済情報情報書き込み&lt;/li&gt;
&lt;li&gt;書き込み正当性チェック&lt;/li&gt;
&lt;li&gt;コネクション終了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;これだけの処理をあの短時間で、なおかつ非接触通信ですから給電-&gt;チップの wake up 時間もありますし、通信環境としてはかなり酷な条件です。何気なく利用してますが、改めて考えると凄まじいなと思うばかりです。&lt;/p&gt;
&lt;p&gt;さて自分はこんなことが言いたかったんじゃありません、言いたいことは〇〇 pay 多すぎということです、自分も　 linepay, origami pay, pixiv pay, 楽天 pay,など使ったことがありますが、どれも 1,2 回しか利用しませんでした。どれも導入時期のキャンペーン目当てで利用したこともあるのですが、こういったモバイル決済手順が面倒じゃありません？店員さんに〇〇 pay で！と伝えるとえーとここかな？など画面をウロウロとボタンを探してやっと決済ができるようになることが多くて、なんだか店員さんに手間をかけさせているようで申し訳ないですし。&lt;/p&gt;
&lt;p&gt;さらに、〇〇 pay を利用するときキャッシュバック等のサービスがあったりしますがそうするとそれぞれのサービスに 100 円ぐらいづつ残高がある状態で利用場所が限られた自分の資産が分散している感じがして自分的には苦手です。&lt;/p&gt;
&lt;p&gt;結局のところ交通系 IC と kyash のリアルカードでの決済が一番楽だし、店員さんを困らせることないですし楽ですね。もっと言えば家に Pasori があるので交通系 IC の利用履歴は家に帰ったら一度タッチするだけでログが取れますし、kyash も zaim などを通せば api で取得することができます。&lt;/p&gt;
&lt;p&gt;さて、今回も何が言いたいのかよくわからなくなったところで日記終わりです。日本語が不自由だ。&lt;/p&gt;
&lt;p&gt;気が向いたら自分で作った自動化家計簿の解説とかするかもしれません。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Open Lighting Architectureについて]]></title><description><![CDATA[OLA とは Open Lighting Project という組織が開発をしています。この組織は、2004 年当時、オープンな照明用のプロトコル Art-Net に目をつけた大学生がそれを活用できるように OSS…]]></description><link>https://blog.magcho.com/2018/10/olaについて/</link><guid isPermaLink="false">https://blog.magcho.com/2018/10/olaについて/</guid><pubDate>Sat, 13 Oct 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;OLA とは&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.openlighting.org/&quot;&gt;Open Lighting Project&lt;/a&gt; という組織が開発をしています。この組織は、2004 年当時、オープンな照明用のプロトコル Art-Net に目をつけた大学生がそれを活用できるように OSS などを整備していくことを目的に作られたものみたいです。&lt;a href=&quot;https://www.openlighting.org/openlightingproject/about/history/&quot;&gt;(※History)&lt;/a&gt;
OLA の他にも Linux 系で Art-Net 扱うためのライブラリである libartnet や rdm テスターなども製作しています。&lt;/p&gt;
&lt;p&gt;その製作プロジェクトの一つである OLA。これは DMX over Ethernet の各種プロトコルや USB の DMX ノード各種などの信号を変換するノードです。対応しているプロトコル、デバイスは&lt;a href=&quot;https://www.openlighting.org/ola/&quot;&gt;OLA の HP&lt;/a&gt;からも確認できます。&lt;/p&gt;
&lt;p&gt;面白いのが、メーカーが仕様を一般に公開していないノードであっても OLA が対応している点です。開発者がロジアナなどで解析しているんだとか。&lt;/p&gt;
&lt;h2&gt;OLA の使い方&lt;/h2&gt;
&lt;p&gt;OLA は Linux と MacOS・FreeBSD に対応している。残念ながら Windows には対応していないが公式 HP では VM で Ubuntu を動かす方法を紹介している。様々なプラットフォームに対応してる OLA だが操作方法は全て同じで Web 上の GUI で操作できる。
![ola web ui](スクリーンショット 2018-10-14 0.13.04.png)&lt;/p&gt;
&lt;p&gt;“Add Universe”ボタンを押して、Universe Id と Universe Name を入力し、使いたいプロトコルにチェックを入れ、“Add Universe”を押すだけです、簡単ですね。
![](スクリーンショット 2018-10-14 1.20.54.png)&lt;/p&gt;
&lt;p&gt;しかし、このままでは左に青字で書かれている Plugins のデバイスが右のチェックボックスに表示されていません。これは OLA は OLA がデバイスを認識していないためです。試しに何かしらの USB デバイスを接続して”Reload Plugin”してみてください、一覧に表示されるようになったと思います&lt;/p&gt;
&lt;p&gt;でもデバイスによっては接続しても表示してくれないものもあります、そのような場合は別途設定を行う必要があります。&lt;/p&gt;
&lt;h2&gt;表示されないデバイスを使えるようにする&lt;/h2&gt;
&lt;p&gt;ここでは、Raspberry pi に FTDI USB DMX を接続する流れを説明していきます。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RaspberryPi が FTDI デバイスを扱えるようにルールファイルを作成します。詳しくは&lt;a href=&quot;https://wiki.openlighting.org/index.php/OLA_Device_Specific_Configuration#Open_DMX_USB_.2F_FTDI_RS485&quot;&gt;公式 Wiki&lt;/a&gt;にも書いてあります。
&lt;code class=&quot;language-text&quot;&gt;/etc/udev/rules.d/10-local.rules&lt;/code&gt;というパスに&lt;/li&gt;
&lt;/ol&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;10-local.rules&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# udev rules for ftdi devices&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;SUBSYSTEM&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;usb|usb_device&quot;&lt;/span&gt;, &lt;span class=&quot;token assign-left variable&quot;&gt;ACTION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;add&quot;&lt;/span&gt;, ATTRS&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;idVendor&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;0403&quot;&lt;/span&gt;, ATTRS&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;idProduct&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;6001&quot;&lt;/span&gt;, &lt;span class=&quot;token assign-left variable&quot;&gt;GROUP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;plugdev&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;を保存します、多分ルールファイルはデフォルトでは存在しないので新規作成してください。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;左のリストから”FTDI USB DMX”をクリックし、詳細を見ます。&lt;code class=&quot;language-text&quot;&gt;Enabled in Config File&lt;/code&gt;と&lt;code class=&quot;language-text&quot;&gt;Active&lt;/code&gt;が No になっていますね。OLA で使用するためにはこの２つが YES になっていなければなりません。
![](スクリーンショット 2018-10-14 1.27.56.png)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;まず、競合しているデバイスを停止させます&lt;code class=&quot;language-text&quot;&gt;Conflicts with&lt;/code&gt;に書かれているデバイスはこの FTDI 　 USB 　 DMX と同じドライバーであったり、物理的にポートが同じなどの理由で同時に使用できません。なので競合しているデバイスの方を止めます。
![](スクリーンショット 2018-10-14 1.47.49.png)
&lt;code class=&quot;language-text&quot;&gt;Config Location&lt;/code&gt;に書いてあるパスに設定ファイルがあるので、編集します。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;ola-usbserial.conf&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;device_dir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; /dev
device_prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ttyUSB
device_prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cu.usbserial-
device_prefix &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ttyU
enabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;--------　falseに変更してください
pro_fps_limit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;190&lt;/span&gt;
tri_use_raw_rdm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
ultra_fps_limit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;40&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;のように enabled を false にします。&lt;code class=&quot;language-text&quot;&gt;Enttec Open DMX&lt;/code&gt;も同様です。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;次に&lt;code class=&quot;language-text&quot;&gt;FTDI USB DMX&lt;/code&gt;の設定ファイルを編集します。&lt;/li&gt;
&lt;/ol&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;ola-ftdidmx.conf&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;enabled &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;-- trueに変更してください
frequency &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;USB でデバイスを接続して&lt;code class=&quot;language-text&quot;&gt;Reload Plugin&lt;/code&gt;をすれば Yes になると思います。
![](スクリーンショット 2018-10-14 2.05.34.png)&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[ブログをgatsbyに移行した話]]></title><description><![CDATA[前は hatenablog を使っていたものの、自分でブログを構築したくなったので作ってみた。WordPress 等の CMS でやるにはメンテナンスが面倒なこともあって静的サイトジェネレータを使いました。一度 jekyll で作りましたが gatsbyjs…]]></description><link>https://blog.magcho.com/2018/09/gatsbyに移行した話/</link><guid isPermaLink="false">https://blog.magcho.com/2018/09/gatsbyに移行した話/</guid><pubDate>Wed, 26 Sep 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;前は hatenablog を使っていたものの、自分でブログを構築したくなったので作ってみた。WordPress 等の CMS でやるにはメンテナンスが面倒なこともあって静的サイトジェネレータを使いました。一度 jekyll で作りましたが gatsbyjs を教えてもらってその表示速度に驚かされたのでこれはやるしかないと思い作りました。&lt;/p&gt;
&lt;p&gt;gatsby.js は React ベースの静的サイトジェネレータです、つい最近 v2.0.0 になったばかりで公式のドキュメントにかきかけのところがあったりもしますが英語圏に情報が落ちているので大概のことはググればすぐに解決します。ただ日本語の情報が他のジェネレータ系に比べて少ないのでとっつきにくいと言われればそうなのですが最適化とか考えなくてもとりあえず作れば Gatsby がよしなにしてくれて爆速ブログが構築できるのでチャレンジしました。&lt;/p&gt;
&lt;p&gt;React ベースということもあり、テーマをカスタマイズするには React のコンポーネント周りの知識があったほうがいいと思います、自分は今までなんとなくの知識しかなかったので、freeCodeCamp で一通り復習してから始めました。あとは gatsbyjs のチュートリアルや graphql のチュートリアル？なんかもやりました。&lt;/p&gt;
&lt;p&gt;自分はブログを構築している間はとても楽しいんですが、どうも文章を書くのが億劫で今まで作ったいくつかのブログも 4 つぐらい構築してますが記事を書いたのは合わせても 10 個ぐらいだと思います。プログラムと比べて日本語はエディターが入力ミスを補完とかしてくれないからだと言い訳をしておきます。日本語力が欠如しているともいいます。なので今回こそは日頃から文章を書くように心がけます。&lt;/p&gt;
&lt;p&gt;さて、自分で見直して見て読みずらくて自分の日本語力に自信をなくしたところで今回は終わり。今後しばらくは gatsby に関しての技術ネタを書く予定です、では。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ポリッドスクリーン系イベントのシステム周りの話]]></title><description><![CDATA[…]]></description><link>https://blog.magcho.com/ポリッドスクリーン系イベントのシステム周りの話/</link><guid isPermaLink="false">https://blog.magcho.com/ポリッドスクリーン系イベントのシステム周りの話/</guid><pubDate>Thu, 05 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;イベントレポ。自分は途中から企画に参加した、今回はプロマネ兼システム構築としての参加でした。&lt;/p&gt;
&lt;p&gt;ここでは照明・音響・映像周りのシステムについてのメモ&lt;/p&gt;
&lt;h1&gt;照明&lt;/h1&gt;
&lt;p&gt;今回の照明周りの機材&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/894ecd6fb131a81376ae007b4cc56b88/80d71/20180330011939.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC40lEQVQ4y22U247jRBCG50F5D54AbtBIK7RarkDcsUKAgAtYLpBgEbCjZYBhmUmyMzlMHCeecXxIYnfbffqgO4mTWSirVN1l+++/flf5xDmHN601q9WK85cvOT8/J18uMYs5JAkuSULcu3vTtcajeKyTPaBSCq0UkzhmFEU0QqCzDMoSVxRQFA+iy3PcZoO7ucGl6RbQ2i1g8C0qI2OIjAlry9bczjmKnS2XkOfdtmNorKUVglQIMiFo6hqMYX8gR9EaQ11VrDcb8jjmbjplU9eUZXkA9OX6xKooWGUZSZ6TeaaBljsA7+RpmobJeMxvv//BvWcJxHF8ALTOoaVkJiWJlCgp6TnH9Q4Qa8Mz7MSXUrIRgnw8oUlTWmOoqoqT/QN7vebA/ZFEc+f4C5C7/R7UH6J9TFOMB7T2DQ2NYV2WXPT7vHr9mjzLML7MpqF3e8vPVz2SOEZI2bWZZxRFEcliQVXXIfegbeq65uzXX3j+/CdW63U4RGnNZDTiu2++JZrNaJsW52y45wHzogja+7XPHTS0Fq0Mi/yW+zJGtRrrX/RM6opBOqAWVWCxl8l3RpDraN31oX/ZN9ndekpSxlhDYOIP8iyvln0qX66j+9r/ZyfHm2ix5PJyTK8fcTNZhFwtFf3rKYNhxN/9W8p1HfKt1hRSkvuoNZnWNL7kKJrR6/UYDUfMswQ10rSRYjC+ZtDrM55MuE/THVMTorcfh0M+/upr3l0seGc45FQInkm5ZRhNp5y9OKPWAmJwiR9FS+/yij8vLjqQoPW2JfhoXfBWNudRkvBekvAE+KJpHpa8rRtY/FebTuvdNH8aD3j7xVNO71LeX68D4JeeYfdzMA6For1saV+1+Msa+2DktuvQhTy7rvjks5pTUfJEaR4Dn3uGx30ohSRNU/IiR/jf11GLHBiGceEHKXisJR+2bfAP2pbvhXg4KbNZxHQ6ZbnMAvAx4HHpgaOxrJTqvFQK9e9X/gcpPWXfhzqevQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180330011939&quot;
        title=&quot;20180330011939&quot;
        src=&quot;/static/894ecd6fb131a81376ae007b4cc56b88/fcda8/20180330011939.png&quot;
        srcset=&quot;/static/894ecd6fb131a81376ae007b4cc56b88/12f09/20180330011939.png 148w,
/static/894ecd6fb131a81376ae007b4cc56b88/e4a3f/20180330011939.png 295w,
/static/894ecd6fb131a81376ae007b4cc56b88/fcda8/20180330011939.png 590w,
/static/894ecd6fb131a81376ae007b4cc56b88/80d71/20180330011939.png 625w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;「前回よりも良いものを」ということで前回の反省を踏まえて今回挑戦したことです。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;事前プログラミングによる照明の自動制御と照明と映像の同期&lt;/li&gt;
&lt;li&gt;電飾を用いた立体的な演出&lt;/li&gt;
&lt;li&gt;生バンド演奏によるライブ&lt;/li&gt;
&lt;li&gt;プロジェクター 2 台同時投影&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;事前プログラミングによる照明の自動制御と照明と映像の同期&lt;/h2&gt;
&lt;p&gt;第一回はパレータス SX で手動でオペして、ボーカロイド楽曲の速いテンポにオペレーターが付いて行けずいっぱいいっぱいだったので、2 回目は自動化を導入。2 回目では映像の再生ボタンと照明の再生ボタンをせーので押す方法で同期していた。今回 3 回目では 2 台のプロジェクターも含め 3 系統のタイミングを合わせる必要があったため手動の再生から Art-Net で再生を行うように変更。&lt;/p&gt;
&lt;p&gt;QLC+から Art-Net を通じて VDMX5 へ信号を流し、VDMX5 で指定の信号を受信したら再生するように設定をしておく。VDMX5 の詳細は別記事で書く予定。
企画段階ではプロジェクターが 3 台以上で、MMD のダンスの映像に加えホリゾントにも背景となる映像を投影し、照明に映像を加えた演出をしたいなど、色々な話が出ていたので。Midi・SMPT タイムコード・OSC などの方法も検討したが、フレキシブルなシステム構築を目指し Art-Net での同期を選んだ。
今回のイベントでは工数とスケジュールの関係やらなんやらで背景への映像投影のアイディアは次回以降のイベントに持ち越しにし、MMD の映像を舞台の上・下手から同時投影するのみとなった、今回はたまたま業務用のスイッチングハブを使うことができたのでパケットロス等のリスク対策は講じなかったが大事をとるなら Art-Net ではなく HDMI スプリッターなどで分岐した方がレイテンシ調整とかもしなくて良かったなーと終わってから思った。&lt;/p&gt;
&lt;p&gt;今回のイベントでは 14 の楽曲を使用するため、1 人で照明の打ち込みを行うのはスケジュール的にもキツキツだったし、これでは 1 人のスタッフしか経験や成長ができないということでどうにかして複数人で打ち込みができないかと模索。複数人のオペレータで分担して打ち込みの宿題を出した。QLC+には 2 つのプロジェクトデータを結合する機能は付いていないので他のソフトウェアを使用することも検討したが、スタッフ達の QLC ＋の導入期に他のソフトを覚えさせるのはラーニングコストが高いし、混乱を招くだろうと思い QLC+で行うことにした。プロジェクトデータ含め QLC+関連のデータは殆どが XML ファイルなのでマージ用のツールを作り、マージすることにした。この詳細も別記事で。
最終的には 4 人で 14 曲のデータを作成した。作成のフローはこんなかんじ。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;フィクスチャーリストファイルを作成&lt;/li&gt;
&lt;li&gt;1 で作成したフィクスチャーリストファイルを読み込み、プロジェクトデータを作成する&lt;/li&gt;
&lt;li&gt;QLC+の”タイムライン”を使用して照明を打ち込む&lt;/li&gt;
&lt;li&gt;14 曲分のデータを作成したら、回収し、自作したマージツールで 1 つにする&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;この期間が短い中でマージツールを作って、マージしてなので作業にかなりの工数を割いた、予想外の連続でうげーって言いながら作業してました。
この時に照明は QLC ＋の Universe 1 を使用し、OUTPUT は OPEN DMX USB 互換品から１本 DMX512-A を出力し照明の制御を、QLC+の Universe 2 の OUTPUT には Art-Net で映像の再生のタイミングで信号を送信するように設定した。Universe2 の 1ch にフィクスチャーの Generic Dimmer を指定しておけばファンクションを作成できるので、そのファンクションをタイムライン上に配置すれば OK&lt;/p&gt;
&lt;p&gt;再生は QLC+のタイムラインのスタートをクリックするだけ、最後までほっとけば OK。楽チン！！&lt;/p&gt;
&lt;h2&gt;電飾を用いた立体的な演出&lt;/h2&gt;
&lt;p&gt;スクリーンへプロジェクターで投影していることから、プロジェクターよりも強い光をスクリーンの後ろに出すことができなかったので、後ろがダメなら前に出そうということでほぼ全ての灯体を客席頭上にむけ、さらに電飾も加えて迫り出してくるような照明を目指したつもり。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/071cd86058c24803b1bea70840c558ec/2bef9/20180331004259.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACWUlEQVQoz1WTyW7UQBCG27247fF47LFn8Ywzm0gGAtkIJIQ9IWEiFgmBEELcEIIDCI5cuHPNE/AkPNyH2g5hOPyqXlSf/qquFp7nITyPOoqldR09JRHSQwgP2+qQzna4cvqJq8++svniB+9+/mb1wRuEMGg/cHnniU5SLq3rvRACaSxxMSOdbjG785q1k/fMH3/k+PMvTr6doaIcpf1K/wOX5EAuhu0eyegyycplZgcvmT14S3njCZtPv3P46YzR/glCSLSxSGXOgc6ZVBeOnHTYIGx3afbHxMNVVnYXjG49J5vvMj/6wMbpF7ZffcRESQWS2iCVRlQQ16MqSoK0Q9QvCdKcMCtoT64x3H5EsfOQZLrO+OYLpnuvWH/yju6VrcqdqtwpPKWcQ4FUFm3jyqWNU4KkQ1Ku0exN6Vzaptjcp9krycdb9C7tU27dZrR3twaZAGl8pJIVVEjdIGxNMEGGUBrPhCg/xDRa6DDGJjk6iPAbMcaGKKUIWinaBlWLlA2RxvwDetLgKYNpRETtLq1OQZL3STsFzXaXIG4TxCkmWCpL1OPl9rJyuQR0jXQy1hIlCXkxYDCeUE5nDEYTusMhWdGn3c2J0xZh1MAPLMrUeVW5f4G6KlnXL6w0yvcJ44SsP2C8usbG7nVu3b/L4eKY46cLDhdHHNw7YL4+J8nSGqrPdQFUNcyV4vrhxx3CbECzW5IWI/LhhF45oViZ0BuUJFkHG4Yorerhd2W7kXHG3K+6OPBtDXYz6S61qR5JeK7RLvoIaRHK4mknH+mHqKCJambIoFF93T9xXR90BsUetwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180331004259&quot;
        title=&quot;20180331004259&quot;
        src=&quot;/static/071cd86058c24803b1bea70840c558ec/fcda8/20180331004259.png&quot;
        srcset=&quot;/static/071cd86058c24803b1bea70840c558ec/12f09/20180331004259.png 148w,
/static/071cd86058c24803b1bea70840c558ec/e4a3f/20180331004259.png 295w,
/static/071cd86058c24803b1bea70840c558ec/fcda8/20180331004259.png 590w,
/static/071cd86058c24803b1bea70840c558ec/efc66/20180331004259.png 885w,
/static/071cd86058c24803b1bea70840c558ec/2bef9/20180331004259.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;使ったのは Amazon で購入した 5m の LED ストリップライトを 5M x 10 本、メータ単価 100 円ぐらいなので 5000 円ぐらいです、でもこれだけじゃ光らないので別途 Dimmer を用意する必要があります。今回使ったのは RGB と共通の＋の 4 極をもつ 12V タイプで１本で RGB の 3ch を DMX で制御できれば良いです。秋月電子とか Amazon とかでも既製品のディマーが購入可能ですが、この Dimmer が LED よりも高い。今回は他のところにお金を回したかったので、自作して節約しました。30 系統 12V で 10000 円ぐらいで作成できました。Arduino 使えば DMX は簡単に扱えるので適当にプログラムを書き、ハードを適当に作ればいいです。４轍ぐらいかかった。&lt;/p&gt;
&lt;p&gt;今回この Dimmer は 1 本あたり DMX を Red,Greed,Blue,Dim,Strobo の 5ch 消費するので、電飾だけで 50ch も食う大食らいです。作成レポは別記事&lt;/p&gt;
&lt;p&gt;やってみてわかったのが、以外と光量が強いこと。単体でピカピカしている分にはいいんですけど、10 本もまとめて光ってるとかなりやかましい感じに。体感クリスマスのイルミネーションの 1.5 倍くらい眩しいです。さらに、LED とはいえ１本で 12V 3A 消費するので 1 分程光らせるとテープが熱を持ち、12V の変圧器のファンが勢い良く回り出します。LED を伸ばさずに巻いたまま使うのはちょっと怖い。&lt;/p&gt;
&lt;h2&gt;生バンド演奏によるライブ&lt;/h2&gt;
&lt;p&gt;今回のライブは 2 部構成になってて、１部は MMD のみのライブ、2 部からは Vo 初音ミク・Gt1,2・Dr・Ba の生演奏・SE 制作をお願いしました。
システムは単純で、MMD の動画のスレテオの音声の L を初音ミクで作成した音声のみにし MainSP へ、R にはテンポを合わせるためのクリック音を入れ演者のイヤモニへ送ります。単純なシステムですが本番では MMD の動画データに埋め込む必要があり、作業が並行して進められないことなどにより工数が予測しづらい作業です。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;VOCALOID・初音ミクを使用し、Vo 音声データを作成&lt;/li&gt;
&lt;li&gt;Vo 音声データを元に DAW などでクリック音や SE を作成し、LR に割り振った音声を作成&lt;/li&gt;
&lt;li&gt;2 の音声データをもとに調整をし MMD の動画を作成し、作成&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;プロジェクター 2 台同時投影&lt;/h2&gt;
&lt;p&gt;前回までのライブで映像が薄く見辛いことが課題でした。そこで今回はスクリーンを農ポリからシワができず波打ちにくい素材のペット板へ変更し、プロジェクターを上下手の 2 台同時投影に変更しました。写真は投影テスト時のもの&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/996b5672210fdaf50c4b56fa791007f4/72e01/20180331011739.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABw3lIrjC//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAECEhH/2gAIAQEAAQUCSMnBVKtusn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAgMBAAAAAAAAAAAAAAABAgAQETFBYf/aAAgBAQAGPwKbFAqufGnK/8QAGxABAAIDAQEAAAAAAAAAAAAAAQARITFBUWH/2gAIAQEAAT8hV6RZXT7GjKjAM9GH0pe6zqY8n//aAAwDAQACAAMAAAAQnO//xAAWEQEBAQAAAAAAAAAAAAAAAAAAIUH/2gAIAQMBAT8QxH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAxQSFxUf/aAAgBAQABPxADR9Zhq0r4fMqFGdNYm+awSCc5gkRHHtEv5MEkVfuf/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180331011739&quot;
        title=&quot;20180331011739&quot;
        src=&quot;/static/996b5672210fdaf50c4b56fa791007f4/1c72d/20180331011739.jpg&quot;
        srcset=&quot;/static/996b5672210fdaf50c4b56fa791007f4/a80bd/20180331011739.jpg 148w,
/static/996b5672210fdaf50c4b56fa791007f4/1c91a/20180331011739.jpg 295w,
/static/996b5672210fdaf50c4b56fa791007f4/1c72d/20180331011739.jpg 590w,
/static/996b5672210fdaf50c4b56fa791007f4/a8a14/20180331011739.jpg 885w,
/static/996b5672210fdaf50c4b56fa791007f4/72e01/20180331011739.jpg 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;[x] 2 台で同じ映像を投影しているため、数センチのズレや十数 ms のズレも気になってしまい、かなりデリケートに。調整に 10 分ぐらいかかり時間のない本番時にはかなりの痛手です。不運なことに本番前にブレーカーが落ちたり、変電所トラブルで停電したりと調整が何度もやり直しになり焦りました。VDMX5 の調整は細かく動かすのが難しく手こずります、練習必須。調整は後輩スタッフがプロだった。さらに今回使用したプロジェクターが映像のポジションを記憶できない仕様で、起動すると毎回違うポジションへ写すという謎仕様でなんだかなーってかんじです。&lt;/p&gt;
&lt;p&gt;停電前に 2 回もブレーカーを落としてしまってそのときは許容オーバーだと思って別系統から電源を引き回してたんですがいま計算してみても、許容範囲で余裕があったはずなので停電の予兆だったのかもといまになって思ってます。ブレーカーを落とし慣れてしまったスタッフたちは対応が早くインシデントは発生せずよかったです。停電時にライブとは関係のない校内のエレベーターを確認しに行ってたのは流石と思いました。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[macのターミナル起動時に怒られるようになった話]]></title><description><![CDATA[今日ターミナルを起動すると と表示されるようになった。とりあえず perl を最新にしてみようと plenv をインストール
https://github.com/tokuhirom/plenv#homebrew-on-mac-os-x
公式の説明どうりに .bachrc…]]></description><link>https://blog.magcho.com/macのターミナル起動時に怒られるようになった話/</link><guid isPermaLink="false">https://blog.magcho.com/macのターミナル起動時に怒られるようになった話/</guid><pubDate>Tue, 05 Jun 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今日ターミナルを起動すると&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;Can&apos;t &lt;span class=&quot;token function&quot;&gt;locate&lt;/span&gt; local/lib.pm &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; @INC &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;you may need to &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; the local::lib module&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;と表示されるようになった。とりあえず perl を最新にしてみようと plenv をインストール
&lt;a href=&quot;https://github.com/tokuhirom/plenv#homebrew-on-mac-os-x&quot;&gt;https://github.com/tokuhirom/plenv#homebrew-on-mac-os-x&lt;/a&gt;
公式の説明どうりに&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; plenv
$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; perl-build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;.bachrc に追記&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;which&lt;/span&gt; plenv &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /dev/null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;plenv init -&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最新版をダウンロード、インストール&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ plenv &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5.26&lt;/span&gt;.2
$ plenv global &lt;span class=&quot;token number&quot;&gt;5.26&lt;/span&gt;.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;パッケージマネージャーもインストール(pip 的なやつ)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ plenv install-cpanm
$ &lt;span class=&quot;token assign-left variable&quot;&gt;PLENV_INSTALL_CPANM&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-v&quot;&lt;/span&gt; plenv install-cpanm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;そして local/lib.pm をインストール&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ cpan
$ &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; local/lib.pm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[ArduinoでDMXを受ける]]></title><description><![CDATA[DMXSerial 使っただけ。この方法だと HardwareSerial を使うので、スケッチ書き込み時に TX,RX からピンを抜いておかないと書き込みエラーが出たりするので、組み込みで半田付けしてからスケッチ修正できない。ムムム  https://qiita.com…]]></description><link>https://blog.magcho.com/arduinoでdmxを受ける/</link><guid isPermaLink="false">https://blog.magcho.com/arduinoでdmxを受ける/</guid><pubDate>Fri, 05 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;DMXSerial 使っただけ。この方法だと HardwareSerial を使うので、スケッチ書き込み時に TX,RX からピンを抜いておかないと書き込みエラーが出たりするので、組み込みで半田付けしてからスケッチ修正できない。ムムム&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4c5ea7990037606e8a246a4c4b7f4564/2bef9/20180105190616.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAACmFAAAphQGPVf7hAAADHUlEQVQ4y42TW0zbZRiHe+ONi0vQJd64hRjm8c6EmBjv1KjRGZ06iSaYOYxMAhRwukBQZkBhwRSYm5vMxcyNjSCQLSibTcWWpAdo/z2sdT3Qc6mU0tKJ/1La9XtMKYsui4m/5Mn3XT3fmze/TyGEoFiiWKJ4GzeLRQSQza5js9mwWCxIkoRktTI/P4/X66UUUU7pKiv4H1lfz24KjEYjJpNpE71ej9vtvlMob+RJJFdYSGZwRhZxRSO4YhFc0TDOYBhPOI4sb+ByurBYzFglK1ZJwmI24/f7b70ptsSywuAJoBz4jhc7+3ly/4dUdXxK5aFDPNjWykPKJh5vbUBjmmbUPsmw/izz+jn0Bj262VmcTidFAXKuIAo3i+UJL02MM3Bxgvsaeqhs/oLqoyMcOKfmua8neUo1wgPdw4zN/Ib22jgnXRf4I7RIMBQkEAiwtrpK+i+BezEnAkvZsnB6RkftsXNUNPZR+X47VV2nePTIMDvbj3P/4RPsUvZx9hcTsaU5NNErt+2278oQjWc6aRr5TJhD0bJw3LGA4oMvqfhoiG2tg2xrUXG3UsU9LSq2f3yc7XUdHBv9ietrXnqmPyEZtJOJWMlnY9R8Xsebb73OswdfFVNzWgpxu6yYsPvYXdvMrrav2NF+kqqaeh5+YS+7X9rHYy/vo+KZ1+idMjDj1VLVXo1kuIBPd54/l+20He2g9UAj7yrrxbRBTd6vlhW9qiHuqnyE6uYumgaHeaKlm3sPdrOzsZcd9Uc2Oa11YEt4eO/UYZL2MW5cH0NOmHmjr449DXt5uuUVoTb/CgmdrLik0fK8shPlD5d5+9sf2d9/mnd6utjzjYrawe+p6T+BFI4TLqzx86wN0qmtogikqI0B43kmbVrhiafuLLbYOhdsWkY9F9FFZtCE1MxGNYy5r3Lm8hSe8DXcchx3JkxsYwnjUoBiAbGYzpV7KErfq4QQbLWdXCpNZsFHOuAj5feRCfqI/e5Gp3PgCCdxxNI4oilskSSOyCqJzLoIJXPlCW+J/s1/ZUUWJDL5f1jNs3wjT3hZFv5IgpWVpPw3m+JQCsseMgkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;null&quot;
        title=&quot;null&quot;
        src=&quot;/static/4c5ea7990037606e8a246a4c4b7f4564/fcda8/20180105190616.png&quot;
        srcset=&quot;/static/4c5ea7990037606e8a246a4c4b7f4564/12f09/20180105190616.png 148w,
/static/4c5ea7990037606e8a246a4c4b7f4564/e4a3f/20180105190616.png 295w,
/static/4c5ea7990037606e8a246a4c4b7f4564/fcda8/20180105190616.png 590w,
/static/4c5ea7990037606e8a246a4c4b7f4564/efc66/20180105190616.png 885w,
/static/4c5ea7990037606e8a246a4c4b7f4564/2bef9/20180105190616.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://qiita.com/loveandsheep/items/e1295ec9ce589&quot;&gt;https://qiita.com/loveandsheep/items/e1295ec9ce589&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[格安ArduinoでDMXを送信する]]></title><description><![CDATA[部品 Arduino UNO 互換品 RS485 モジュール XLR コネクター 配線  スケッチ DmxSimpleをとりあえず書き込んでサンプルを動かしてみた。
このライブラリデフォルトの Pin…]]></description><link>https://blog.magcho.com/格安arduinoでdmxを送信する/</link><guid isPermaLink="false">https://blog.magcho.com/格安arduinoでdmxを送信する/</guid><pubDate>Mon, 01 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;部品&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Arduino UNO 互換品&lt;/li&gt;
&lt;li&gt;RS485 モジュール&lt;/li&gt;
&lt;li&gt;XLR コネクター&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;配線&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5dbc7151c9643ce2c3985903806650c2/2bef9/20180101214426.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAACmFAAAphQGPVf7hAAACvUlEQVQoz32Sa0hTARiG96c/3UAxggqL7vU3oR/1L8qgfpRBNyu7IDqzsbKisjLFykgytRl2oQtdTLOUyqxlLo1shlnNkZdtx82tyfJsp9ZONs/ZE2pRUfTCywcffC8fvI+G/ygQUrlQ5+HKMw/FNU7q2/qG9mokQiQCkaH5pzXytzC+j33YPkpYnB6sggur0ENHj4cGi8DxSgtvuwM0dUqU1DoJ9StDoYPH/5LG3CmgP32RpYfymZ+kZfb2w8xIyWRaWhZz0o8QqztKh7eXoBzhssnFZzk8GIeqRpAHQthEH2ahF6fXjxr8gKaqspKiW3eJST/GZN1R4vKvs+XGY5YYKllQUMaEg+eoae9GCkLZc5GvA7++2XBWS/zuBBZmreLeizpCXXVoak0NJJ25RtSOE0xJ3s/0rFLmZJ9n0oESxu8rYaI+j4sP63GIAfZWVOHobOGLx4IStJOSoyU5cSsrtRt4ZH4MrgdoqtscaFLziNpdyKiMIkbtLGCkvoAxOwsYu9fA6G2ZFJfX0Oh4ydR982hpuonQVIFoN5KWq2VHcjorUtZifNcCioSm2mJnZpKe2Ix8Yg6UMm2dlllLE5ixbDVzl68metFKsu+YsIo2Eg176G0t51P7HcJuI5uKt7L40BoWHUnA1N45XMrJIgMjJs8iTpeFrvA8cbtyidbmEqvLIyY1h3GpORQbX/EJmZtPWmlu7uaV3Y/5vQ/Tey+X3phpdfbR5Q0OB96vbyRefxD91WrWn7vN5vwLJOZms/zsKTYWXmbNSQMv7W4CBLEKrxE9XiRlAKn/K4H+EG2SDVWBsKIOc/g7Qz/JcrxtoLyjjAZXPU+7jTxz1vHAWUtzmxHBY6Un7KVHdiPILlyy+08OI6rKkH+QPqh+vx/JbsMv2Ag4bPgdXUgOG7LLDQPKXzArioIoivh8Pr4D3SS+o9USnrEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180101214426&quot;
        title=&quot;20180101214426&quot;
        src=&quot;/static/5dbc7151c9643ce2c3985903806650c2/fcda8/20180101214426.png&quot;
        srcset=&quot;/static/5dbc7151c9643ce2c3985903806650c2/12f09/20180101214426.png 148w,
/static/5dbc7151c9643ce2c3985903806650c2/e4a3f/20180101214426.png 295w,
/static/5dbc7151c9643ce2c3985903806650c2/fcda8/20180101214426.png 590w,
/static/5dbc7151c9643ce2c3985903806650c2/efc66/20180101214426.png 885w,
/static/5dbc7151c9643ce2c3985903806650c2/2bef9/20180101214426.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;スケッチ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/PaulStoffregen/DmxSimple&quot;&gt;DmxSimple&lt;/a&gt;をとりあえず書き込んでサンプルを動かしてみた。
このライブラリデフォルトの Pin アサインは上の図の通りだが、コード内で別途指定すれば変更できるっぽい。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SerialToDmx&lt;/strong&gt;は PC からのシリアル画面から&lt;code class=&quot;language-text&quot;&gt;{ch番号}c{ゲージ}w&lt;/code&gt;って感じで送ってやれば送信できる、5ch に 255 を出力すると&lt;code class=&quot;language-text&quot;&gt;5c255w&lt;/code&gt;と送信すればいいらしい。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FadeUp&lt;/strong&gt;は Pin アサインがデフォルトから変更されているので、&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// DmxSimple.usePin(3);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;しとけばとりあえず動いた。&lt;/p&gt;
&lt;p&gt;LTC485 の仕様としてこの図では DE を Arduino のデジタル GPIO のアウトを使って 5V を印加している。この DE を HIGH にすると送信 LOW にすると受信モードになる&lt;/p&gt;</content:encoded></item><item><title><![CDATA[NetlifyとGithubで独自ドメインのサイトをHTTPS化したメモ]]></title><description><![CDATA[情報が古く、執筆時の Netlifty の UI 等が変わっています。ご注意を 事の発端 IOS 11 ｷﾀ ━(ﾟ ∀ ﾟ)━! 　 Safari からカメラの映像が取得できる！　これでアプリではなくブラウザから AR できるようになった！と喜んでいたら、このカメラの api…]]></description><link>https://blog.magcho.com/netlifyとgithubで独自ドメインのサイトをhttps化したメモ/</link><guid isPermaLink="false">https://blog.magcho.com/netlifyとgithubで独自ドメインのサイトをhttps化したメモ/</guid><pubDate>Sun, 15 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;情報が古く、執筆時の Netlifty の UI 等が変わっています。ご注意を&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;事の発端&lt;/h2&gt;
&lt;p&gt;IOS 11 ｷﾀ ━(ﾟ ∀ ﾟ)━! 　 Safari からカメラの映像が取得できる！　これでアプリではなくブラウザから AR できるようになった！と喜んでいたら、このカメラの api は https じゃないとセキュリティ的な問題で動かないのである。&lt;/p&gt;
&lt;p&gt;Github pages で独自ドメインでホスティングしているサイトを HTTPS にしたいけどお金はない。&lt;/p&gt;
&lt;p&gt;すでに導入レポは検索すればいくつも見つかるものの、どうも日本語の情報が少ないのでメモすることにした。&lt;/p&gt;
&lt;h2&gt;使ったもの&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Github&lt;/li&gt;
&lt;li&gt;Netlify&lt;/li&gt;
&lt;li&gt;お名前.com&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;手順&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;お名前.com でドメインを取得します。&lt;/li&gt;
&lt;li&gt;Github に公開するサイトのファイル一式を push しておきます。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;一度 Github pages で公開してみて問題がないことを確認しておきましょう。設定で有効化して、HTTPS にチェックを入れれば&lt;code class=&quot;language-text&quot;&gt;https://&amp;lt;username&gt;.github.io/&amp;lt;repository name&gt;&lt;/code&gt;でアクセスできます。&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Netlify に登録します。
&lt;a href=&quot;https://www.netlify.com/&quot;&gt;https://www.netlify.com/&lt;/a&gt;
Github アカウントでログインし、先ほど push したリポジトリを選択し、デプロイしましょう。&lt;/li&gt;
&lt;li&gt;Netlify の site name を変更しましょう&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;デプロイをするとデフォルトでランダムな英単語が割り当てられるので、変更しなくても問題はないが変更しておきましょう。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;General -&gt; Setting -&gt; Site details -&gt; Change site name&lt;/code&gt;から設定します。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3ec0a8f3600d7654c9c206ef08911ec4/ebf47/20171015014625.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAARlAAAEZQAGA43XUAAACK0lEQVQ4y42TXUsbQRSG8xMr1o9Ws4nZjf4GL3opFIyIV/0L9apQajaxkFK8K72RYmuhWA35XmOyszNrdje7T5mJEYWCHnh4Z5azZ86ZcybnOGVWV1/xYmGBxcWXRpeXl7Esi0Kh8Cy0b6lUYnNzk1zJdtjZ2WFvb49KpcLu7q5ZHxwcmP1TaP/9/X22t7exbZuc7Th0ul26/QGtdodOr0en26PV6ZKmGU9ZmqZG6/U6+XxeZ2jT6/fxRUB/4DEa+4x93+hzbB6wVquxtrY2C+h5HlEco1SICkNEECCVQogAIQS+EASBNOr7gkBKlFJIqYzvPMP19fVZwP5gQKBCk6VUOqAikMqsZ3tp8IVESMU0zdC3oTVJpo9L3rAdvEGHWzVCBTckUUA8eYgAIiC+I4JsAqnmljRWdyW78wzLXPebeL0Lri7PDc2r30YvL35x8eeMW+kRhUMmakgc3pBMRkyjMVkimE7GQEi95pK3LHIbJZvh9bU5JUtiSHUJup4EKQNDEAjG/pjReEQgBWEoiaOJ8UunyeOSbdvhst3iR6/NafuKs26L782//B16xnGapkyi6L6bc8uyzIxVkiT3XdYDntsqb/Gz3eTtSZ3KSZ13377y5vMHPp6f3v8spHxyfBqNBq/nY/P+8JCjatXwqXpE1XVxa645VXN8fGxK0mutD3Fdly+NhnlZxeKGfillVlZWWVpaomBZWPm8Qd+H7tpj/vdtRrFYNG/5H4ZsUtCnPESXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;null&quot;
        title=&quot;null&quot;
        src=&quot;/static/3ec0a8f3600d7654c9c206ef08911ec4/fcda8/20171015014625.png&quot;
        srcset=&quot;/static/3ec0a8f3600d7654c9c206ef08911ec4/12f09/20171015014625.png 148w,
/static/3ec0a8f3600d7654c9c206ef08911ec4/e4a3f/20171015014625.png 295w,
/static/3ec0a8f3600d7654c9c206ef08911ec4/fcda8/20171015014625.png 590w,
/static/3ec0a8f3600d7654c9c206ef08911ec4/ebf47/20171015014625.png 688w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;カスタムドメインを設定しましょう&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Domain management -&gt; Domains -&gt; Custom domain\&lt;/code&gt; に取得しておいたドメインを設定します。
ここで、Netlify は www 付きのドメインにすることを勧めてきます。DoS 攻撃から守りやすいとか、ロードが早いとか色々恩恵があるらしいのですが、それよりも URL が短くなる方がいいなって思ったので、自分は www なしにしました。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/46e2599a9da03a145bcf95a20b3387d7/d67fd/20171015015607.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAARlAAAEZQAGA43XUAAABdUlEQVQoz6WTS24UMRRFa9MZIhaQhWQCE5ACMzbBICQ0HQUl1fV1/Ww/2+U+yO5WBKEbIbB0dP1s6+rKzy7EB7bfH7n5uuV2c8+4GKwPGPEYlwhHPcy1eLR1ZynCGrnbPvD55i5T1i2tGjNNPzyT6qpTDLPOpot1Jyl8WPPEhZhJybQ4Zm0ZZ42alqwp+TAtzMYe0sppsqHznr5X9ErR9Yq26/He8y+jsM6TTJu2p6wadlXDY1lh5T8NvWjEToidsXpkHwWiy3qOtP+SbBiCMA0lXVvRtiV1/YQ1I+zdn8mmv1KkZxOCJ8qA0wNuUQQz4rTCaoVZekQrxAyYuXteS8pq2B/hSG5KMv3W1HzZPbFpKm6rkk29wzqHDwErgojLzUu1P+rJO1zXyGA0rz++5eL9FZefrrl4d8WrD2+YxOZDbdflzv9VU1LCdI/9stDOE800Ze2WGfEe58Ohafl5hZwsrOtZivRd0uFTI8Y9a4w/8bL+nR8NGaLEBDZOoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;null&quot;
        title=&quot;null&quot;
        src=&quot;/static/46e2599a9da03a145bcf95a20b3387d7/fcda8/20171015015607.png&quot;
        srcset=&quot;/static/46e2599a9da03a145bcf95a20b3387d7/12f09/20171015015607.png 148w,
/static/46e2599a9da03a145bcf95a20b3387d7/e4a3f/20171015015607.png 295w,
/static/46e2599a9da03a145bcf95a20b3387d7/fcda8/20171015015607.png 590w,
/static/46e2599a9da03a145bcf95a20b3387d7/d67fd/20171015015607.png 670w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;設定後、Netlify の DNS を利用するので &lt;code class=&quot;language-text&quot;&gt;Use Netlify DNS &lt;/code&gt; を押します。４つ URL が表示されると思います。これは次の作業で使うので覚えときましょう。&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;ドメインの設定をしましょう&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;今度はお名前.com でドメインの設定をしていきます。&lt;/p&gt;
&lt;p&gt;ログイン後、&lt;code class=&quot;language-text&quot;&gt;ネームサーバーの設定 -&gt; DNS 関連機能の設定 &lt;/code&gt; に A レコードと CNAME を追加します。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A レコードで 104.198.14.52 を追加します。&lt;/li&gt;
&lt;li&gt;CNAME に www をつけて Netlify で設定した URL を追加します。&lt;code class=&quot;language-text&quot;&gt;&amp;lt;site name&gt;.netlify.com&lt;/code&gt;です&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f4fc4d77d4544eb9f26887fd2c831177/2bef9/20171015021014.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAARlAAAEZQAGA43XUAAABRElEQVQoz6WQS2+jQBCE+f9/Jnv2JXux5JMVhySWeZiHYUyWrA0MMDz9raYPOUfakkY9U1Oq6m7HP2fc7zcsHo8H/wtHKYXnB5w8n/ePI4dXl3MUM46jBCzLwjzPUn9kGMUpXnDmkilOXoj7fsTzQ3nnqpB6PPnEyQXddvRmpDcDuu2pm5a60XS9kWrMgBPGGVGqKMo7+ecXefGFF6bCBdGFJCtwPzzOSS73+HIlVX/wwkT4t6NPnBUc3k5kqsDZbrc8Pf3i5XCQlu1467rKiGVZMs0z0zRLeqM1bdfRNI1oLLTWRJ8Dw7QK52RZzmazkRMEgZD3qqLrOqqqIooinp9/s9vtyJXidrtJmNXZHdd1TVoOmMHuecbp+x7fD3BdlyRJRKx1S28MxhjU9cp+v5d/a9a2Lcu6fhvaDq9/B8bJhiz8A12EESs1F+FaAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20171015021014&quot;
        title=&quot;20171015021014&quot;
        src=&quot;/static/f4fc4d77d4544eb9f26887fd2c831177/fcda8/20171015021014.png&quot;
        srcset=&quot;/static/f4fc4d77d4544eb9f26887fd2c831177/12f09/20171015021014.png 148w,
/static/f4fc4d77d4544eb9f26887fd2c831177/e4a3f/20171015021014.png 295w,
/static/f4fc4d77d4544eb9f26887fd2c831177/fcda8/20171015021014.png 590w,
/static/f4fc4d77d4544eb9f26887fd2c831177/efc66/20171015021014.png 885w,
/static/f4fc4d77d4544eb9f26887fd2c831177/2bef9/20171015021014.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;次に、DNS を変更します。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt; ネームサーバーの設定 -&gt; ネームサーバーの変更 -&gt; 他社のネームサーバーを利用&lt;/code&gt; に 4 で Netlify にドメインを設定した時に出てきた４つの DNS の URL を設定します。人によってこの URL は異なるみたいです。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c9fc668f2ec7952ad1ad7c0513afc169/d125e/20171015021555.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAARlAAAEZQAGA43XUAAACfklEQVQ4y41U247aMBTk81u1UruqVn3pa9/7C5UqtFLVhS1LII4T5x4SnAtQBLnAVOeksGJvqqWxLccez5lz4kFRrTETDoy5DSE9nkvbw5ev3/Dm42e8v7rG2w+f8O7qGt9/DEGtrhu0bXuBpm1xPB4xoI5A7Yh+fK0dDv3+50BtUK1WsKUN13ZgWxZsSyL0PHi+hjEVMKdTJGGEpdb/cR0woE67CtbNEObNEOJmCOdujCIKsHAVY6OXfQTHw4WaFwnLOEI4ncC+G8Ma3SKYz5AoB5nnIlGK52pmIJIWYimRKQfbsmTirutwOBwuCZWjICyJxSKF5wcwZnNMJve4/TWCYcwgpQ2lXHieD4ssCSMEQQghJGxHIYoTpFmGtut6wjiK4Xo+L+Z5wQel7WBuCqzW64eEHPu0UcSPg26alpUy4Wa9hu8HSNMMf7ZbVkpKkmSBzWaD5VKjLCtst1tonUPnOcqq4nXCbrd7CLlujqj3e16sqgplWaJtmrM3hLppuM5ora5rrkNS1M/rSw+zfAMvoLIo4HoBLOkgLyomOBUsEb2WWfpEpLRjEMYpxvcCvw0LhuVCCgdCOIjTHEVRsK9aa+z2eyZvSO0T9Go78tANYvwcTTGazDGeChj3c5hziWRZINcaWbZEnuf9ge7Aap8DRcNJ8aMFpqaCafswnQCW7UNIH0mWs6eksqpW7NvpYNt2l+i6hyyHSQZLhbC9GNKNIL0YQkWPCCtOzEvqCM1JYRCnrI7IiFiqEMIJEKeavaNSonG/r1nJ41fm/NrQhawwzpiA1f2DcEIslr1vlAwiO5n/LNqWLTmHTAR9yDGPQoXI8upJabz2bNFIf9JfC0ML/cVYB/YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20171015021555&quot;
        title=&quot;20171015021555&quot;
        src=&quot;/static/c9fc668f2ec7952ad1ad7c0513afc169/fcda8/20171015021555.png&quot;
        srcset=&quot;/static/c9fc668f2ec7952ad1ad7c0513afc169/12f09/20171015021555.png 148w,
/static/c9fc668f2ec7952ad1ad7c0513afc169/e4a3f/20171015021555.png 295w,
/static/c9fc668f2ec7952ad1ad7c0513afc169/fcda8/20171015021555.png 590w,
/static/c9fc668f2ec7952ad1ad7c0513afc169/d125e/20171015021555.png 737w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;設定が反映されると、独自ドメインにアクセスすると HP が表示されると思います。このままではまだ HTTP です。いよいよ次で HTTPS になります。&lt;/p&gt;
&lt;ol start=&quot;6&quot;&gt;
&lt;li&gt;Netlify で SSL を有効化しましょう&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Netlify で &lt;code class=&quot;language-text&quot;&gt;Domain management -&gt; Domains -&gt; HTTPS -&gt; SSL/TLS certificate&lt;/code&gt;で &lt;code class=&quot;language-text&quot;&gt;Verify DNS configration&lt;/code&gt;をクリックし&lt;code class=&quot;language-text&quot;&gt; Let&apos;s Encypt certificate&lt;/code&gt;をクリックです。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fc942cf6932ac803c266863c01f719ba/a1dd2/20171015022037.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAARlAAAEZQAGA43XUAAABLUlEQVQoz52R6WrDQAyE/f5v2EJLSGgSr/e+LzNlZadJ/qSlCx/jMauxJU0+ZhzPV5wuM1JpiLn+mTBI5YkppIy3jwPePw9YpAZXBkwoMKF//KYWXFvyg5krKOspxD8wldZxI5WKvJNyJU/k8uTzTWvDY/1gan2FNhZf5wvYwnE4niCVwn/PNL6SS6FQYx2hjYH3gbDOwXkPYy1prfV1YKkNISZcGcPCBRjnuFxnzMtCXNmCmS30btzR2iDGBB8CYoxwPmBd1+fAnDOMMXDjb+wdow2887DWETGlPcRvHYSN1vs9sLaOUApk8FDBQ+wML/2m3FvUh6KXLVfaToONASYEmF1jLcR4dimitm3W5bcZjqX03qllpTTBuUBKGa01CCFpbmNRQkpIpV8GfgPGoAjVpyYcBQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20171015022037&quot;
        title=&quot;20171015022037&quot;
        src=&quot;/static/fc942cf6932ac803c266863c01f719ba/fcda8/20171015022037.png&quot;
        srcset=&quot;/static/fc942cf6932ac803c266863c01f719ba/12f09/20171015022037.png 148w,
/static/fc942cf6932ac803c266863c01f719ba/e4a3f/20171015022037.png 295w,
/static/fc942cf6932ac803c266863c01f719ba/fcda8/20171015022037.png 590w,
/static/fc942cf6932ac803c266863c01f719ba/a1dd2/20171015022037.png 838w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;お疲れ様でした、試しにhttpsでアクセスしてみましょう、表示されれば成功です。セキュリティーがどーたらと表示されてしまう場合はしばらく待ってれば反映されるっぽいです。&lt;/p&gt;
&lt;p&gt;最後の仕上げとして、http でアクセスがあった時に https にリダイレクトさせたいので&lt;code class=&quot;language-text&quot;&gt;Force TLS connections&lt;/code&gt;を有効化して完了です。そんなの表示されてないよって時はリロードするとたぶん出てきます。&lt;/p&gt;
&lt;h2&gt;コメント&lt;/h2&gt;
&lt;p&gt;ドメイン周りの設定は順番が大切なので、3 回ぐらい失敗してサイトを消してやり直してを繰り返してしまった。勉強不足だ。
そんなこんなで、準備は整ったので、AR.js とやらに挑戦します。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Arduino互換品のドライバーメモ]]></title><description><![CDATA[買ったやつ http://amzn.asia/b5Kk31r インストールしたドライバー http://www.wch.cn/download/CH341SER_MAC_ZIP.html]]></description><link>https://blog.magcho.com/arduino互換品のドライバーメモ/</link><guid isPermaLink="false">https://blog.magcho.com/arduino互換品のドライバーメモ/</guid><pubDate>Wed, 16 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;買ったやつ&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://amzn.asia/b5Kk31r&quot;&gt;http://amzn.asia/b5Kk31r&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;インストールしたドライバー&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.wch.cn/download/CH341SER_MAC_ZIP.html&quot;&gt;http://www.wch.cn/download/CH341SER_MAC_ZIP.html&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Dockerで立ち上げたwebサーバでmod_rewriteしたかった話]]></title><description><![CDATA[内容 DockerHub の公式の PHP イメージを使っていて、mod_rewite したい人向けのお話です。結論だけ知りたい人は読み飛ばしてね。 事の発端 僕自身が立ち上げた web サービスではもともと URL…]]></description><link>https://blog.magcho.com/dockerで立ち上げたwebサーバでmod_rewriteしたかった話/</link><guid isPermaLink="false">https://blog.magcho.com/dockerで立ち上げたwebサーバでmod_rewriteしたかった話/</guid><pubDate>Fri, 11 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;内容&lt;/h2&gt;
&lt;p&gt;DockerHub の公式の PHP イメージを使っていて、mod_rewite したい人向けのお話です。結論だけ知りたい人は読み飛ばしてね。&lt;/p&gt;
&lt;h2&gt;事の発端&lt;/h2&gt;
&lt;p&gt;僕自身が立ち上げた web サービスではもともと URL が&lt;code class=&quot;language-text&quot;&gt;http://example.com/index.php?cmd=view&amp;amp;page=123&lt;/code&gt;という感じでとてもダサかったので、かっこよくしたかった。WordPress などではパーマリンクと呼ばれ URL がイカした感じになっているので、僕も方法をパクった。
調べると apache 側の設定で mod_rewrite を使うとアクセス時に URL を記述したルールに基づいて置換してくれるらしい。&lt;/p&gt;
&lt;p&gt;僕の web サービスではアクセスを全て index.php で受け、get パラメータで動作を変化させている、pukiwiki とか？の設計をパクったはず。動作ルールは以下&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;example.com/index.php?cmd=[動作モード]&amp;amp;page=[記事のNo.]&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cmd
&lt;ul&gt;
&lt;li&gt;view 記事の表示、page で記事を指定&lt;/li&gt;
&lt;li&gt;edit 記事の編集、page で記事を指定&lt;/li&gt;
&lt;li&gt;category カテゴリーごとに記事一覧を表示する　　などなど&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;これを&lt;code class=&quot;language-text&quot;&gt;example.com/[動作モード]/[記事のNo.]&lt;/code&gt;にしたかった。
さらに view の時には&lt;code class=&quot;language-text&quot;&gt;example.com/[記事のNo.]&lt;/code&gt;にしたい。&lt;/p&gt;
&lt;p&gt;このルールで URL を置換させるには.htaccess に&lt;/p&gt;

        &lt;div class=&quot;gatsby-code-title code-title&quot;&gt;
          &lt;span&gt;.htaccess&lt;/span&gt;
        &lt;/div&gt;
       
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;RewriteEngine On
RewriteBase /
RewriteRule ^([0-9]+) index.php?cmd=view&amp;amp;page=$1 [L]
RewriteRule ^edit/([0-9]+) index.php?cmd=edit&amp;amp;page=$1 [L]
RewriteRule ^edit index.php?cmd=edit [L]
RewriteRule ^category index.php?cmd=category [L]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;のように記述する、よくある正規表現と似ているので特に迷うことはないだろう。&lt;/p&gt;
&lt;p&gt;いざ、Docker で立てた開発環境に置いてみると、500 エラー。なんで！！
しばらく悩むも解決せず、諦めて本番環境に置いてみると動いた！なんで！！&lt;/p&gt;
&lt;p&gt;理由は単純だった、使っているシステムが違った。どちらも apache なのは違いないが、本番は CentOS で構成されており、開発環境の Docker の公式 image の php は debian で構成されていた。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/docker-library/php/blob/2630167f7e69394bdd91f240443a0a521fd7872d/7.0/apache/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;debian 系の apache で mod_rewrite を有効化するにはコンテナに入ってコマンドを打てばいいらしい。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ docker exec -it {php_container_name} bash
$ a2enmod rewrite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;そして/etc/apache2/sites-available/000-default.conf の&amp;#x3C;VirtualHost *:80&gt;の中に&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    &amp;lt;Directory /var/www/html&gt;
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Require all granted
    &amp;lt;/Directory&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;を追加して再起動すれば OK!&lt;/p&gt;
&lt;p&gt;でも、せっかく docker-compose 使ってるからいちいちコマンド打つの面倒だよね。ってことで&lt;/p&gt;
&lt;h2&gt;結論&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Dockerfile&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM php:7.0-apache
RUN  a2enmod rewrite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;docker-compse.yml&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;php-7.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;80:80&apos;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;../:/var/www/html&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./000-default.conf:/etc/apache2/sites-available/000-default.conf&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;000-default.conf&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;VirtualHost *:80&gt;
    &amp;lt;Directory /var/www/html&gt;
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Require all granted
    &amp;lt;/Directory&gt;
~~~~~~~~~~~~~~以下略~~~~~~~~~~~~~~~~&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;この３ファイルを同じディレクトリに入れ&lt;code class=&quot;language-text&quot;&gt;docker-compose build&lt;/code&gt;なりでイメージをリビルドして&lt;code class=&quot;language-text&quot;&gt;docker-compose up&lt;/code&gt;でOK。&lt;/p&gt;
&lt;p&gt;ちなみに、mysql も使いたいよって人は&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Dockerfile&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM php:7.0-apache
RUN apt-get update &amp;amp;&amp;amp; \
  docker-php-ext-install pdo_mysql mysqli mbstring &amp;amp;&amp;amp; \
  a2enmod rewrite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;こうすれば良いです。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ポリッドスクリーンを使ったボカロ系イベントを作った話]]></title><description><![CDATA[イベント概要 非営利 自分も含め、企画側は全員学生、お客さんは学生と教員 イベントを行った場所は学校 使用キャラクターはクリプトンヒューチャー社の VOCALOID…]]></description><link>https://blog.magcho.com/ポリッドスクリーンを使ったボカロ系イベントを作った話/</link><guid isPermaLink="false">https://blog.magcho.com/ポリッドスクリーンを使ったボカロ系イベントを作った話/</guid><pubDate>Fri, 04 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;イベント概要&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;非営利&lt;/li&gt;
&lt;li&gt;自分も含め、企画側は全員学生、お客さんは学生と教員&lt;/li&gt;
&lt;li&gt;イベントを行った場所は学校&lt;/li&gt;
&lt;li&gt;使用キャラクターはクリプトンヒューチャー社の VOCALOID キャラクターのみ&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;準備&lt;/h1&gt;
&lt;h2&gt;スクリーンについて&lt;/h2&gt;
&lt;h3&gt;スクリーンを選ぶポイント&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;安い&lt;/li&gt;
&lt;li&gt;短辺が２メートル以上あるロール状のシート&lt;/li&gt;
&lt;li&gt;無地 (フィルム表面に何も印字されていない)&lt;/li&gt;
&lt;li&gt;学生でも買える&lt;/li&gt;
&lt;li&gt;軽い&lt;/li&gt;
&lt;li&gt;学校に搬入可能である&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;を考え、今回利用したのが&lt;a href=&quot;http://www.cainz.com/shop/g/g4560139590903/&quot;&gt;&lt;strong&gt;カインズホームの農ポリ 0.05X210X100&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;5000 円以下で購入でき、サイズも短辺が 2m10cm あり支払いもコンビニで OK、完全に無地で、ロールの状態で 9kg ほどなので１人で持ち運びが可能なので、学校近くにあるクロネコヤマトの営業所に配達をしてもらい、受け取りに行くことで学校に搬入が可能。ここで注意するのが、カインズオンラインには配達先を指定するときに営業所止めには設定できないので、お客様サポートへ連絡し個別に対応してもらうことが必要だということ。自分はカインズの回し者ではないのだが、カインズホームのカスタマーサポートはとても良い、返信が早いし個別対応になるとちゃんとサポートとコミュニケーションが取れるし、電話での相談も可能なので困ったらサポートに連絡すればどうにかしてくれる感じでした。&lt;/p&gt;
&lt;p&gt;ちなみに、今回の候補に上がったのは&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;大倉の農ポリ 厚さ 0.1mm 幅 96cm の切り売り 町田の東急ハンズで購入した、重ねずに明るい部屋でもくっきりと写る。結構重く、値段も高く今回は購入を断念。&lt;/li&gt;
&lt;li&gt;大倉の農ポリ 厚さ 0.05mm 幅 190cm の切り売り こちらも町田の東急ハンズで購入、これだと４枚重ねなきゃ明るい部屋ではくっきりと写ってくれない。軽く、値段も 0.1mm の半額ぐらい。下の写真はこれ。なかなかよかったが 町田の東急ハンズではロールでの販売をしておらず断念。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;スクリーン制作&lt;/h3&gt;
&lt;p&gt;スクリーンを作る過程でわかったことは、１枚のスクリーンではしっかりと像が映らないということ、２枚重ねにすると暗闇で後ろの壁が黒ならば結構くっきり見えて良い感じだったが、明るい部屋ではうっすらしか見えない。今回のライブではライブ照明を使って演出がしたかったので明るい部屋でもはっきり見えるようにする必要があったので、試した結果**４枚重ねに決定した。**写真は４枚重ねの実験の時の写真&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 542px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5aac7f2d3319368ff08877e4d43835d5/a34d8/20170721235436.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 133.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAeWq2zYxEu2cRDB//8QAGxAAAwACAwAAAAAAAAAAAAAAAAECAxESICL/2gAIAQEAAQUC8m0ckSXjUrZLHaa6f//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AaQ//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8BhT//xAAaEAACAgMAAAAAAAAAAAAAAAAAARAxICJR/9oACAEBAAY/Ap2Qn0qKWP8A/8QAGhAAAwADAQAAAAAAAAAAAAAAAAERECFhUf/aAAgBAQABPyFx7R9jgyY4UVaNBrRC7FVJPVhZ/9oADAMBAAIAAwAAABAcA0P/xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQMBAT8Q0aTaov/EABYRAQEBAAAAAAAAAAAAAAAAABEAAf/aAAgBAgEBPxDHjFgm/8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBUWGh4f/aAAgBAQABPxC5Sscmp5eP3YXYcao1ATEvRhqFYCh6IObbVxUqN0UsaVz7hKiSjqf/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;null&quot;
        title=&quot;null&quot;
        src=&quot;/static/5aac7f2d3319368ff08877e4d43835d5/a34d8/20170721235436.jpg&quot;
        srcset=&quot;/static/5aac7f2d3319368ff08877e4d43835d5/a80bd/20170721235436.jpg 148w,
/static/5aac7f2d3319368ff08877e4d43835d5/1c91a/20170721235436.jpg 295w,
/static/5aac7f2d3319368ff08877e4d43835d5/a34d8/20170721235436.jpg 542w&quot;
        sizes=&quot;(max-width: 542px) 100vw, 542px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;そして、結構苦労したのがスクリーンの設置方法、今回試し物を挙げると&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;スクリーンの上辺に針金を貼った物を 4 枚作り、バトンに紐で固定してぶら下げる
結果：&lt;strong&gt;失敗&lt;/strong&gt; ４枚の間に空気が入り隙間ができ、プロジェクターで投影した像が複数できでしまった。&lt;/li&gt;
&lt;li&gt;上だけじゃなくて下辺にも針金で固定し、４枚を上下辺の両辺で一つに固定しぶら下げる
結果：&lt;strong&gt;失敗&lt;/strong&gt; 結局空気は抜けず、複数の像ができてしまう。また、上下辺を固定したことで巻き取ることができな行くなった。&lt;/li&gt;
&lt;li&gt;角材でフレームを作り４枚を障子紙のように固定する
&lt;strong&gt;失敗&lt;/strong&gt; 切り出し、ピンと張ったフィルムをフレームに画鋲で固定することを４回繰り返したが、フィルムに直に画鋲を打ってしまうと、３０分ぐらい経つとフィルムが伸びてシワだらけで、映像に綺麗に映らない。(フィルムの間に空気はほぼ入らなくなったので像の問題はこの方法で解決)&lt;/li&gt;
&lt;li&gt;3.のようにフレームに貼る前にフィルムの４辺に養生テープを貼り伸びないようにした
&lt;strong&gt;成功&lt;/strong&gt; 3. のように時間がたってもフィルムが伸びることもなく成功した。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/82d2082a5f82424ff2187b7c5317713a/a9e43/20170722003710.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUCAwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFTFysG80g//8QAGhABAAIDAQAAAAAAAAAAAAAAAgASAQMEEf/aAAgBAQABBQJHxVmsGr5FK5KHNY//xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwFX/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BV//EABoQAAMBAAMAAAAAAAAAAAAAAAABERIQIaH/2gAIAQEABj8Ca47LpMjhd+H/xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhQXEQMWH/2gAIAQEAAT8h804sVJvYn2T2PCQha5wP/9oADAMBAAIAAwAAABAYD//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCxh//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEUH/2gAIAQIBAT8QE7Yv/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARIUExUZH/2gAIAQEAAT8QVHLeeJ7grNxas2DFgu5z5BkCqpISJZo4tPYSRW6LJ//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;null&quot;
        title=&quot;null&quot;
        src=&quot;/static/82d2082a5f82424ff2187b7c5317713a/1c72d/20170722003710.jpg&quot;
        srcset=&quot;/static/82d2082a5f82424ff2187b7c5317713a/a80bd/20170722003710.jpg 148w,
/static/82d2082a5f82424ff2187b7c5317713a/1c91a/20170722003710.jpg 295w,
/static/82d2082a5f82424ff2187b7c5317713a/1c72d/20170722003710.jpg 590w,
/static/82d2082a5f82424ff2187b7c5317713a/a8a14/20170722003710.jpg 885w,
/static/82d2082a5f82424ff2187b7c5317713a/a9e43/20170722003710.jpg 964w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;今回のスクリーンは縦 210cm 横 3m15cm の大きさなので、キャラクタを等身大投影しても結構余裕がありました。&lt;/p&gt;
&lt;p&gt;でも、貼ってから 4 日経つとやはり伸びてくるらしく実際のライブ時にはシワができていたので、改善の余地あり。&lt;/p&gt;
&lt;h3&gt;反省&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;フィルムは薄いとすぐにシワになるのでできるだけ厚い 0.1mm の物を使った方が楽(高いけど)&lt;/li&gt;
&lt;li&gt;１パターン作るには３人ぐらいいないと難しく、作り終えるまでに４時間ぐらいかかったので、かなり大変&lt;/li&gt;
&lt;li&gt;フレームには倉庫に転がっていた角材を使ったため、しっかりと固定ができず持ち上げたら角材が割れてしまったので、ちゃんと強度を考えるべきだった&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;機材について&lt;/h2&gt;
&lt;h3&gt;機材一覧&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Macbook Air 2015 動画再生用&lt;/li&gt;
&lt;li&gt;VDMX5 動画再生ソフト&lt;/li&gt;
&lt;li&gt;EPSON EB-G5350 プロジェクター&lt;/li&gt;
&lt;li&gt;スピーカー SX300 を 2 発、RLX118 を 2 発&lt;/li&gt;
&lt;li&gt;音響セット(後述)&lt;/li&gt;
&lt;li&gt;照明セット(後述)&lt;/li&gt;
&lt;li&gt;フォグマシン スモーク演出用機材&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;映像&lt;/h3&gt;
&lt;p&gt;映像の再生環境で大事なのが矩形調整ができること、映像専用のソフトを使った方が楽なので、今回は VJ ソフトの[&lt;a href=&quot;http://vidvox.net/:title=VDMX5%5D%E3%81%AE%E7%84%A1%E5%84%9F%E7%89%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%80%82%E7%84%A1%E5%84%9F%E7%89%88%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%82%82%E3%81%82%E3%82%8A%E8%A8%AD%E5%AE%9A%E3%81%AA%E3%81%A9%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%8C%E3%80%81%E3%83%9D%E3%83%AA%E3%83%83%E3%83%89%E6%8A%95%E5%BD%B1%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%AA%E3%82%89%E3%81%B0%E4%BF%9D%E5%AD%98%E3%81%B0%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%84%E3%81%97%E3%80%81%E5%86%8D%E7%94%9F%E6%99%82%E9%96%93%E3%81%AE%E5%88%B6%E9%99%90%E3%82%82%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7%E7%84%A1%E5%84%9F%E7%89%88%E3%81%A7%E5%8D%81%E5%88%86%E3%80%82&quot;&gt;http://vidvox.net/:title=VDMX5]の無償版を使用した。無償版ということもあり設定などを保存することができないが、ポリッド投影するだけならば保存ば必要ないし、再生時間の制限もないので無償版で十分。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;実際にスクリーンに投影してみると画面で見るより青っぽくなる印象があるので、これも VDMX5 内で調整した。&lt;/p&gt;
&lt;p&gt;プロジェクターは EPSON の EB-G5350 を 1 台使用、ビジネス用プロジェクターということもあり、5000lm ぐらいある、ただし焦点距離が大きいのでスクリーンとの距離が 5 メートルぐらい必要でした。&lt;/p&gt;
&lt;h3&gt;音響&lt;/h3&gt;
&lt;p&gt;今回、バンドさんをお呼びして演奏をして下さった為、音響のセットはバンド向けにセッティングされていたので、それを利用して、PC からの音声を再生しました。&lt;/p&gt;
&lt;p&gt;スピーカーは SX300 を 2 発、ELX-180 を 2 発。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e396f3c1eb90479062c072d7095999c9/2bef9/20170801175852.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAARlAAAEZQAGA43XUAAABr0lEQVQoz52TX0sbQRTF96MWFPox+uCrlIDfQCh9SFuibRqLIVIbSYr5o02TsNK4i4umpubPTsad3Zns/krWxGppCu2Bw5yZh3MP996xHMfh0vMYX13xtdWiVqsRxzH/ioQkPa3c7i6V/X1UuczT9XWerK0RhSH/C6taqeC4bnq56HTwTk9THSd3NU2SMEvuqsdaM7m5YTAaEZ6fE/0YIAOFLye4dBGMsB66y16PabOJUQotBJEQxFIST6dEUqKOj5mcnXEtJWG5jKrX8ZViMh5xoovYcRUrmSdZJIi05nu/z6BUQrsuxvMwto1ptzGtFtFw+Ku61gTfHMZTgbweM/yY5SK/+TjhEga4VYpoNiMwJmU4m6VvyxHMoQjw6HKJTZsyvVLmz4Zz+L6PCoJ73kqJEOLRRD93P3Fi1zioFzjsF0kqB6sNwzDEGINSiiAIUh0upr9sUTb7hneFD7x4meWo2YFGc7VhFEUplz2e6/C3dRq5LqLRQFQrTAvv4fWr1YZa63vO0y31w4SHe3sUcznebm/zJZ8HpVYb/vVXLAyfZzJktrZ4trFBdmcnXeyfD/JCJ6rGF0sAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20170801175852&quot;
        title=&quot;20170801175852&quot;
        src=&quot;/static/e396f3c1eb90479062c072d7095999c9/fcda8/20170801175852.png&quot;
        srcset=&quot;/static/e396f3c1eb90479062c072d7095999c9/12f09/20170801175852.png 148w,
/static/e396f3c1eb90479062c072d7095999c9/e4a3f/20170801175852.png 295w,
/static/e396f3c1eb90479062c072d7095999c9/fcda8/20170801175852.png 590w,
/static/e396f3c1eb90479062c072d7095999c9/efc66/20170801175852.png 885w,
/static/e396f3c1eb90479062c072d7095999c9/2bef9/20170801175852.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;照明&lt;/h3&gt;
&lt;p&gt;今回はスクリーンを中央に設置したため、両サイドに照明を配置した。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/72e01/20170801181200.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQX/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAeTlJw0FNr//xAAbEAABBAMAAAAAAAAAAAAAAAASAAEQIREiMf/aAAgBAQABBQIKCtE3Mx//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8BrT//xAAXEQEAAwAAAAAAAAAAAAAAAAAAERJh/9oACAECAQE/AZWx/8QAFxAAAwEAAAAAAAAAAAAAAAAAARAgMf/aAAgBAQAGPwJaY//EABsQAAMAAgMAAAAAAAAAAAAAAAABESExQVFx/9oACAEBAAE/IYbRwwa7Jyr4bht2PZ//2gAMAwEAAgADAAAAEAAf/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxATpAzhf//EABcRAAMBAAAAAAAAAAAAAAAAAAABITH/2gAIAQIBAT8QVCnB/8QAHBABAAMAAwEBAAAAAAAAAAAAAQARITFBUYGR/9oACAEBAAE/EGqCEqysr2DXxd/MmBxG0KjdVbO25vLeTPA/J//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20170801181200&quot;
        title=&quot;20170801181200&quot;
        src=&quot;/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/1c72d/20170801181200.jpg&quot;
        srcset=&quot;/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/a80bd/20170801181200.jpg 148w,
/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/1c91a/20170801181200.jpg 295w,
/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/1c72d/20170801181200.jpg 590w,
/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/a8a14/20170801181200.jpg 885w,
/static/7de4fc5bf979d3b3b65cc1ddcd36da1a/72e01/20170801181200.jpg 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;今回照明で悩んだのはスモークを炊くか炊かないか、スモークを焚いた方が演出照明は綺麗に見せられるのですが、スモークを炊くと照明が空気中で乱反射するためスクリーンにも光が当たってしまい、映像とのリアリティが無くなるのが悩みどころでした。また、プロジェクターの光の筋も見えてしまうのでどうしようかという感じでした。
結果としては炊きました。スクリーンとプロジェクターの間には炊かずに、客席の方に炊きました。時間が経つにつれて空気に馴染んでくれるので、丁度いい感じに薄く炊けました。&lt;/p&gt;
&lt;p&gt;今回使用した照明機材は&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;フレネル 1000w (ゼラ 72) 青地用&lt;/li&gt;
&lt;li&gt;フレネル 500w 目潰し用&lt;/li&gt;
&lt;li&gt;パー缶 PAR64&lt;/li&gt;
&lt;li&gt;ムービングヘッド vizi led spot (American DJ)&lt;/li&gt;
&lt;li&gt;マジックボール ノーブランド トモカ電気で購入&lt;/li&gt;
&lt;li&gt;エリプソイダルスポット Source4 ETC 星柄のゴボ使用&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;本番&lt;/h2&gt;
&lt;p&gt;当日は、お客さんが 100 人以上来場されたようで、色々なご感想をいただきました。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;楽曲を客の投票とかで募集してほしい。&lt;/li&gt;
&lt;li&gt;バンドやダンスとの同期も見てみたい。&lt;/li&gt;
&lt;li&gt;もっとスクリーン大きい方がいいかも。&lt;/li&gt;
&lt;li&gt;客席で、後ろの方に行くと音が悪い。　など&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;でした、機材トラブルなんかもあり申し訳なかったです。&lt;/p&gt;
&lt;p&gt;でも、&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;またやってほしい&lt;/li&gt;
&lt;li&gt;運営に参加したい&lt;/li&gt;
&lt;li&gt;初めて軽音楽部のバンドを生で見た など&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;嬉しい意見もありました。このイベントでバンドにも興味が湧いて下さった意見が特に嬉しかったです。&lt;/p&gt;
&lt;p&gt;ざっとまとめた内容ではこんな感じです。この記事では僕が関わった内容しか書かれていないので、別記事で他の運営スタッフから聞いた話をまとめられたらいいなって思います。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Docker volumeを調べたメモ]]></title><description><![CDATA[完全にメモ書きになってるので Evernote にでも書けよって感じ。 Docker…]]></description><link>https://blog.magcho.com/docker-volumeを調べたメモ/</link><guid isPermaLink="false">https://blog.magcho.com/docker-volumeを調べたメモ/</guid><pubDate>Fri, 06 Jan 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;完全にメモ書きになってるので Evernote にでも書けよって感じ。&lt;/p&gt;
&lt;p&gt;Docker はコンテナ型仮想化システムで、必要な時に必要なだけコンテナを作り、終わったら捨てる。いわば使い捨てだ。でも、消えて欲しくないデータを扱う事もあるだろう。そんな話。&lt;/p&gt;
&lt;p&gt;自分はインフラエンジニアではないし、Docker でホストの環境弄らずに開発環境作りたかったから始めたっていう理由&lt;/p&gt;
&lt;p&gt;Docker コンテナは使い捨てるもの → 残したいファイルはコンテの外に保存しておこうっていう考えらしい。&lt;/p&gt;
&lt;h2&gt;Docker の volume にも色々ある&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;docker run の-v オプション
&lt;code class=&quot;language-text&quot;&gt;$ Docker run -v /hoge centos:latest&lt;/code&gt;
centos の latest(最新版)を起動するコマンドである。この時-v オプションを使ってコンテナ内に/hoge という名前のシンボリックリングを作成し、フォルダの実体は/var/lib/docker/volumes/{ランダムな英数字}/_data/にある。このフォルダは docker がコンテナと連動させて管理しているため、docker コンテナを消せばこのフォルダも消えます。
** 説明のため、コマンドは一部省略しています **&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;この時、内部では 1. ホストに実体のフォルダを作る 2. イメージからコンテナをつくり動かす 3. ホストのフォルダへのリンクをコンテナに作る(上書く)&lt;/p&gt;
&lt;p&gt;ってイメージらしい。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ホストのフォルダとコンテナのフォルダを同期する
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; $ docker run -v {ホストのフォルダ(実体)}:{コンテナ内のリンク名} centos:latest&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
このコマンドでホストのフォルダへのシンボリックリンクをコンテナ作成時に貼る。こうすれば、コンテナの設定を変えてリビルドしてもファイルは消えずに残る。
また、ホストにファイルがあるのでホストでエディターを開き、コンテナで開発環境を揃え実行できるので環境のバージョンを変えるのもイメージを差し替えるだけだし、ソースをホスト側で git 管理する事もできる。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;後記&lt;/h2&gt;
&lt;p&gt;dockerfile や docker-compose にも同様の機能があるので、もう少し検証したい&lt;/p&gt;</content:encoded></item><item><title><![CDATA[DMX512のプロトコルをまとめる]]></title><description><![CDATA[DMX512-A 仕様 シールド付きツイストペアケーブルを使用すること RS-485 では 1500m までの通信が保証されているが、RS-485 の仕様の中でケーブルの長さを伸ばすと通信速度が下がるとされているので、DMX512-A の通信速度 250kbps…]]></description><link>https://blog.magcho.com/dmx512のプロトコルをまとめる/</link><guid isPermaLink="false">https://blog.magcho.com/dmx512のプロトコルをまとめる/</guid><pubDate>Tue, 03 Jan 2017 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;DMX512-A 仕様&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;シールド付きツイストペアケーブルを使用すること&lt;/li&gt;
&lt;li&gt;RS-485 では 1500m までの通信が保証されているが、RS-485 の仕様の中でケーブルの長さを伸ばすと通信速度が下がるとされているので、DMX512-A の通信速度 250kbps が保証されるのはケーブル長 400m までとされている。&lt;/li&gt;
&lt;li&gt;RS-485 の仕様では 1Master で 32Slave までとされている&lt;/li&gt;
&lt;li&gt;DMX512-A のボーレートは 250kpbs なので、1bit あたり 4μsec (※1)a&lt;/li&gt;
&lt;li&gt;端末にはターミネータ(終端抵抗)をつける DMX512-A では基本的に 120Ω となっている(100-120)と幅を効かせて定義もされている。&lt;/li&gt;
&lt;li&gt;仕様上では１パケット長が最小で 22.7msec になり、リフレッシュレートは最大で 44Hz になる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;※1: 仕様では基本 250kbps としているが 245 ≤ n ≤ 255kbps まで認めているので、1bit は 3.92 ≤ n ≤ 4.08µsec までと幅がある。&lt;/p&gt;
&lt;h2&gt;パケット仕様&lt;/h2&gt;
&lt;p&gt;パケットは以下のフレームで構成されている。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.iar.unicamp.br/lab/luz/ld/C%EAnica/Manuais/dmx_usit.pdf&quot;&gt;http://www.iar.unicamp.br/lab/luz/ld/C%EAnica/Manuais/dmx_usit.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/da18cd1aee5d84d72886837c4ef62261/e4a12/20180102234649.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAARlAAAEZQAGA43XUAAAA9klEQVQoz12SB46FMAwF//2vCaGE3luCV+P9RuxaeiJxGScOn77vpGkaybJMUuekbVvxvpKqqqQsS8nzXGPsrxDkuq4/CiHIeZ5y37dgH/naNE2ybZvs+65fkxVS9Pab5nmWZVkkxvgLhEyXdV21kC9QAOM4ahHJIUaNx9cXkYueE+Ks61q7AONqwzBI3/fq997ruus63XMTxkIzfMTxwwGqQAIGeM8NsTaxpxk5pqIoFE4TTq5A5mAdDWgA59yzp5hcW3MbxFge4HuGJAMhyGmTJJE0Tb8v77XYcuy6/CGA8HO455Ux4PZa2HEc2syMwv85+N72A9zBaCS+EP0oAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180102234649&quot;
        title=&quot;20180102234649&quot;
        src=&quot;/static/da18cd1aee5d84d72886837c4ef62261/fcda8/20180102234649.png&quot;
        srcset=&quot;/static/da18cd1aee5d84d72886837c4ef62261/12f09/20180102234649.png 148w,
/static/da18cd1aee5d84d72886837c4ef62261/e4a3f/20180102234649.png 295w,
/static/da18cd1aee5d84d72886837c4ef62261/fcda8/20180102234649.png 590w,
/static/da18cd1aee5d84d72886837c4ef62261/efc66/20180102234649.png 885w,
/static/da18cd1aee5d84d72886837c4ef62261/e4a12/20180102234649.png 963w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 444px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bbe8603ae7793d7fd8792bb5624d287f/9b7bd/20180102234658.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.8108108108108%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAARlAAAEZQAGA43XUAAACr0lEQVQ4y51UaXOiQBTM//9l2Q+RG4YbwQOUKKeAir31notJ3OimdqrGGcqann7d/eYFAA6HA8+madD3PaZxuVzwedx/fzde6Cddr2BaFlzXheM4OJ1OOB1PDDAMA87nM8bLhb8n0M/7vwAvlxFd12MYehiGAVXVEIYRgiCAqqjQdR3DcPwRUwbsug5VVaPvOmiaDlsIhGEI0xJQVBWapsF1XMiSjHkc/5sh6VfVNdq2het6SOIYaZaxplVV8ayrGkVRoGnaL4D3oAxIzMqy5INUnu/78Dz/qfiPymZAEp7YXRm6DEgrsaH/jscjuz+OI+9pPir7o+Sq4tU0TPiBD9/zICsKbNthk3w/hBCC9dxsts8B27ZBWVZsjCzLSJIElmVBkmTYtg3DNBH4PjRdhyUEX/6o7KuGfc/l1nV9ddR1EUYRlzxJQezLouQ95fIpw6Hv+TC5GgQ+h3u5XP2/KQRELtNKpRLgfB7jdD7zZdwp48gd9IzdF1OKsuTDiqqxblmW3brm7e0NtuOwHOs044Pj+IThfrfDfr9nQE03uFM814OwHYRhwEY5jgvLEnh9/XULN7G+D/ifkmsut20aSPLV2cViCUVRYZoWojBEHMfcTVMGH+nKgFVV3jpFliUIYcMPAghLcA7pkZAliXXd7XYcK1oXScKZJHm2eX5fcoHucIAiy/D9gN2m+CTJggEIlABp73kelssl5lGINNuwLNOjwYBFscf7+44BpdmMDaASVVVFEIb46biVXJYFvyQtx8ZkZlEUwTQMjpCq6vBcB7PZDPn77ltDvpgy6UddQADrdYrFYsH6tYfuxmDK4LNwM2Ceb1lUYigsC3GSsCbUt9Qxq9WKL9huc2y3VxOI4XegH7FpW+7pycE8zxkoyzaYz+dsCn2nacqGfO6Yz4C/AVZikMz5KV4UAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;20180102234658&quot;
        title=&quot;20180102234658&quot;
        src=&quot;/static/bbe8603ae7793d7fd8792bb5624d287f/9b7bd/20180102234658.png&quot;
        srcset=&quot;/static/bbe8603ae7793d7fd8792bb5624d287f/12f09/20180102234658.png 148w,
/static/bbe8603ae7793d7fd8792bb5624d287f/e4a3f/20180102234658.png 295w,
/static/bbe8603ae7793d7fd8792bb5624d287f/9b7bd/20180102234658.png 444w&quot;
        sizes=&quot;(max-width: 444px) 100vw, 444px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;No.&lt;/th&gt;
&lt;th&gt;Frame&lt;/th&gt;
&lt;th&gt;Time&lt;/th&gt;
&lt;th&gt;Level&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;“SPACE” for Break&lt;/td&gt;
&lt;td&gt;88µsec &amp;#x3C; 1sec ※1&lt;/td&gt;
&lt;td&gt;LOW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;“MARK” After Break (MAB)&lt;/td&gt;
&lt;td&gt;8µsec≤n&amp;#x3C;1sec&lt;/td&gt;
&lt;td&gt;HIGH&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;START Bit&lt;/td&gt;
&lt;td&gt;1bit (4µsec)&lt;/td&gt;
&lt;td&gt;LOW&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;SLOT nnn Data&lt;/td&gt;
&lt;td&gt;8bit (32µsec)&lt;/td&gt;
&lt;td&gt;(0~512 SLOT)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;STOP Bit&lt;/td&gt;
&lt;td&gt;2bit (8µsec)&lt;/td&gt;
&lt;td&gt;HIGH&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;“MARK” Time Between slots&lt;/td&gt;
&lt;td&gt;0sec≤n&amp;#x3C;1sec&lt;/td&gt;
&lt;td&gt;HIGH&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;“MARK” Before Break (MBB)&lt;/td&gt;
&lt;td&gt;0sec≤n&amp;#x3C;1sec&lt;/td&gt;
&lt;td&gt;HIGH&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;3~6 を 513 回繰り返します。&lt;/p&gt;
&lt;p&gt;※1:仕様では 88µsec 以上としか書かれていないが、パケット全体を 1sec 以内に収めることが書かれているので、事実上制限があることになりそう？&lt;/p&gt;
&lt;p&gt;この調子で１パケットで 513 SLOT の Data を送信します、この Data を仕様内では SLOT と呼び、最初の 0SLOT は START CODE で 1SLOT が DMX の 1ch,2SLOT が 2ch…&lt;/p&gt;
&lt;h2&gt;START CODE&lt;/h2&gt;
&lt;p&gt;DMX512-A では調光信号の他、イロイロな信号を流せるようになった、この時にこの Start bit に仕様で定義されているコードを送信することで受信側はなんの信号か判断できるようになっているがこのコードをちゃんと識別しれくれない機器もある。RDM 信号流したら安物ムービングがピクピク動くからなんだと思ったら受け取った信号を全て調光信号として受け取る仕様らしく何しても動くやつとかある。
パケットの 0 SLOT に以下の通りのコードを送信すればいいらしい。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;NAME&lt;/th&gt;
&lt;th&gt;CODE&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Lighting Data&lt;/td&gt;
&lt;td&gt;0x00 (0000 0000)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Network Test&lt;/td&gt;
&lt;td&gt;0x55 (0101 0101)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Text Packet&lt;/td&gt;
&lt;td&gt;0x17 (0001 0111)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Remote Device Management&lt;/td&gt;
&lt;td&gt;0xCC (1100 1100)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;System Information Packet&lt;/td&gt;
&lt;td&gt;0xCF (1100 1111)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dimmer Curve Select&lt;/td&gt;
&lt;td&gt;0xFF (1111 1111)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</content:encoded></item><item><title><![CDATA[MBAのSerriaをクリーンインストールした時の手順メモ]]></title><description><![CDATA[自分用のメモ記事なので、参考程度にどうぞ。 環境 MacBookAir macOS Sierra 10.12.2 homebrew 1.1.5 homebrew-cask 1.1.5 mas 1.3.1 mackup 0.8.1…]]></description><link>https://blog.magcho.com/mbaのserriaをクリーンインストールした時の手順メモ/</link><guid isPermaLink="false">https://blog.magcho.com/mbaのserriaをクリーンインストールした時の手順メモ/</guid><pubDate>Fri, 30 Dec 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;自分用のメモ記事なので、参考程度にどうぞ。&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;環境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MacBookAir macOS Sierra 10.12.2&lt;/li&gt;
&lt;li&gt;homebrew 1.1.5&lt;/li&gt;
&lt;li&gt;homebrew-cask 1.1.5&lt;/li&gt;
&lt;li&gt;mas 1.3.1&lt;/li&gt;
&lt;li&gt;mackup 0.8.15&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;準備編&lt;/h2&gt;
&lt;p&gt;１. 必要なファイルを外部のストレージにコピー&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;home ディレクトリをそのままコピーしてしまえばある程度は安心&lt;/li&gt;
&lt;li&gt;プッシュしていない Git プロジェクトはプロジェクトごとコピーしておけばブランチ構造ごとコピーできる&lt;/li&gt;
&lt;li&gt;VirtualBox のエクスポートツールでバックアップしてもいいし、面倒ならフォルダごとコピーして*.vbox ファイルをあとでインポートすれば OK&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;２. Dropbox をインストールし同期できるように設定しておく&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;インストール済みならばそれで OK&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;３. アプリの設定ファイルなどをバックアップ&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew install mackup
$ mackup backup&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;エクスポートしたファイル群は Dropbox の共有フォルダにあるので、同期しておく&lt;/li&gt;
&lt;li&gt;/Users/{ユーザー名}/Dropbox/Mackup が作られる&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;４. homebrwe, homebrew cask でコマンドでインストールしたアプリの一覧を取得する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ cd ~/Dropbox/mac_backup
$ brew list &gt;&gt; brew_list.txt
$ brew cask list &gt;&gt; brew_cask_list.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Docker は別で再インストールしたほうがいい(Docker tool box)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;５. AppStore でからインストールしたアプリの一覧を取得する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ cd ~/Dropbox/mac_backup
$ brew install mas
$ mas list &gt;&gt; mas_list.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;６. インストール一覧からシェルスクリプトを作る&lt;/p&gt;
&lt;p&gt;{% gist 5023c8d38d325b6578112807c1fd46b2 %}&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gist.github.com/5023c8d38d325b6578112807c1fd46b2&quot;&gt;mac を引っ越す時にアプリを一括インストールするスクリプト&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;リストア編&lt;/h2&gt;
&lt;p&gt;１. xcode を appstore からインストール&lt;/p&gt;
&lt;p&gt;２. xcode を起動し xcode comand line tool をインストール&lt;/p&gt;
&lt;p&gt;３. Homebrew をインストール&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;４. 1password をインストールする&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew cask install 1passwrod&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;cask は[brew cask]とコマンドを打つと気を利かせて homebrew がインストールしてくれるので、自分でやる必要はない&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;自分は iPhone とも同期しているので icloud 同期で設定&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;５. Dropbox をインストールしファイルを同期する&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew cask install dropbox&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;６. mackup をインストールし、復元&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew install mackup
$ mackup restore&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;７. 準備編(上記)で作ったシェルスクリプトを実行して brew と cask 系を一括インストール&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ cd /Users/{ユーザー名}/Dropbox/mac_backup
$ sudo sh brew-install-list.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;８. atom エディタのアドオンと設定を復元&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ apm install atom-settings
[atom内のコマンドで（cmd+shift+p)] -&gt; [sync-settings:restore]とタイプしEnter&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;apm コマンドが使えない場合は一度 atom を起動し [Atom] -&gt; [Install Shell Commands]を押し apm が使えるようにする。&lt;/li&gt;
&lt;li&gt;復元中に、gist のリストとパッケージの最新バージョンが違ったりすると警告が出るので、各自判断で手動ならインストールできます。&lt;/li&gt;
&lt;li&gt;Settings &gt; Packages を見ると atom の再起動が必要なパッケージはダウンロードされた時点で一時停止しているので、インストールを押してやれば OK です。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;９. Git 系のセットアップ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;git は sourcetree 内蔵ではなく、自分で入れたものを使っているので brew でインストール後 Sourcetree の設定でシステムの Git に切り替えます&lt;/li&gt;
&lt;li&gt;Github と Bitbucket でログインする。２段階認証にどちらも対応してるのでアクセストークンをあれこれする必要はなく、ID と PW でログインして、携帯などで 6 桁の数字を確認して２段階認証しておきましょう&lt;/li&gt;
&lt;li&gt;Ouath か Basic で認証したり SSH キーを認証したりしておく。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;後記&lt;/h2&gt;
&lt;p&gt;アプリのインストール管理は brew-file とやらでできるらしいので、もっと早く知りたかった。それと、1password って appstore からだと 7,800 円するけど、cask なら試用版をメール認証なしでインストールできるっていう発見。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Homebrew Caskで特定のアプリがインストールできなくなった話]]></title><description><![CDATA[状況説明 かなり前から homebrew cask を使うと。 こんなのが出てきていた。「cask…]]></description><link>https://blog.magcho.com/homebrew-caskで特定のアプリがインストールできなくなった話/</link><guid isPermaLink="false">https://blog.magcho.com/homebrew-caskで特定のアプリがインストールできなくなった話/</guid><pubDate>Sat, 03 Dec 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;状況説明&lt;/h2&gt;
&lt;p&gt;かなり前から homebrew cask を使うと。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew cask list
Warning: The default Caskroom location has moved to /usr/local/Caskroom.

Please migrate your Casks to the new location and delete /opt/homebrew-cask/Caskroom,
or if you would like to keep your Caskroom at /opt/homebrew-cask/Caskroom, add the
following to your HOMEBREW_CASK_OPTS:

  --caskroom=/opt/homebrew-cask/Caskroom

For more details on each of those options, see https://github.com/caskroom/homebrew-cask/issues/21913.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;こんなのが出てきていた。「cask のバージョンアップでアプリが配置されるディレクトリの場所が変わったから前の場所に置いてたアプリ新しいとこに移動してくれ」っていう話だった気がする、筆者は&lt;s&gt;面倒だから&lt;/s&gt;移動しなくても使えるからやっていなかったが、docker がうまくインストールできないので今更対応した。
やることは簡単、コンソールに書いてある&lt;a href=&quot;https://github.com/caskroom/homebrew-cask/issues/21913&quot;&gt;URL&lt;/a&gt;に書いている通りに進めるだけだが、しかし今回 Thunderbird が再インストールに失敗した。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew cask install thunderbird-ja
==&gt; Downloading https://download.mozilla.org/?product=thunderbird-45.4.0&amp;amp;os=osx&amp;amp;
Already downloaded: /Users/{username}/Library/Caches/Homebrew/Cask/thunderbird-ja--45.4.0.0&amp;amp;os=osx&amp;amp;lang=ja-JP-mac
==&gt; Verifying checksum for Cask thunderbird-ja
fatal error&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;エラー吐いてインストールが止まってしまう。&lt;/p&gt;
&lt;h2&gt;対応&lt;/h2&gt;
&lt;p&gt;上のコンソールで&lt;code class=&quot;language-text&quot;&gt;Already download&lt;/code&gt;ってなってるから以前ダウンロードしてあるインストーラを使おうとしているのだが&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ cd /Users/{username}/Library/Caches/Homebrew/Cask/
No such file or directory&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;となる。ディレクトリ自体が無いので、移動時にどっかいった可能性が高い。そこで新しいファイルをダウンロードすればいいと思い&lt;code class=&quot;language-text&quot;&gt;$ brew cask install --force thunderbird-ja&lt;/code&gt;としたもののやはり&lt;code class=&quot;language-text&quot;&gt;Already download&lt;/code&gt;となりダウンロードしてくれない。そこで最新バージョンではなく Beta を一旦インストールする。そしてキャッシュを消し、最新バージョンへアップグレードする。とうまくいった。
事前に cask versions がインストールしてある場合は２つ目の$から始めてもらえばいいかと。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ brew tap caskroom/versions
==&gt; Tapping caskroom/versions
Cloning into &apos;/usr/local/Homebrew/Library/Taps/caskroom/homebrew-versions&apos;...
remote: Counting objects: 209, done.
remote: Compressing objects: 100% (207/207), done.
remote: Total 209 (delta 22), reused 15 (delta 0), pack-reused 0
Receiving objects: 100% (209/209), 76.51 KiB | 0 bytes/s, done.
Resolving deltas: 100% (22/22), done.
Checking connectivity... done.
Tapped 0 formulae (226 files, 276.3K)

$ brew cask install Thunderbird-beta
==&gt; Downloading https://ftp.mozilla.org/pub/thunderbird/releases/50.0b2/mac/en-U
==&gt; Verifying checksum for Cask thunderbird-beta
==&gt; Moving App &apos;Thunderbird.app&apos; to &apos;/Applications/Thunderbird.app&apos;
🍺  thunderbird-beta was successfully installed!

$ brew cask uninstall thunderbird-beta
==&gt; Removing App: &apos;/Applications/Thunderbird.app&apos;

$ brew cask cleanup
==&gt; Removing cached downloads
/Users/{username}/Library/Caches/Homebrew/Cask/thunderbird-beta--50.0b2.dmg
==&gt; This operation has freed approximately 77.8M of disk space.

$ brew cask install thunderbird
==&gt; Downloading https://ftp.mozilla.org/pub/thunderbird/releases/45.5.1/mac/ja-J
==&gt; Verifying checksum for Cask thunderbird
==&gt; Moving App &apos;Thunderbird.app&apos; to &apos;/Applications/Thunderbird.app&apos;
🍺  thunderbird was successfully installed!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;まとめ&lt;/h2&gt;
&lt;p&gt;brew cask のキャッシュ周りのことを理解しないで使っているので本当はもっといい解決策があるかもしれないが、今回はこれで収まったのでよしとする。
homebrew はオープンソースプロジェクトなので Github でどんなことやってるかは確認できるが、仕様変更なんかがあった時にエラー吐いてググって変更あったんだーってなることが多いので、もっと自己防衛のためにもアンテナ張ってなきゃな〜って思った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AWSの学割は高校生に優しくない]]></title><description><![CDATA[事の発端 学校で課題研究の授業があって数人でグループを組んで自然言語処理の研究をしていたところ、VPS が必要になってどうしようと思ってたら Github education の中に AWS…]]></description><link>https://blog.magcho.com/awsの学割は高校生に優しくない/</link><guid isPermaLink="false">https://blog.magcho.com/awsの学割は高校生に優しくない/</guid><pubDate>Sat, 20 Aug 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;事の発端&lt;/h2&gt;
&lt;p&gt;学校で課題研究の授業があって数人でグループを組んで自然言語処理の研究をしていたところ、VPS が必要になってどうしようと思ってたら Github education の中に AWS あったなーと思ってセットアップしてたらクレジットカード番号必須で詰んだ。
そんなこんなして、解決できたのでここにメモしておく。&lt;/p&gt;
&lt;h2&gt;高校生とクレカ&lt;/h2&gt;
&lt;p&gt;基本的に高校生はクレジットカードが作れない。クレジットカード会社の規定なのだからしょうがない。なら代わりになるものを使えばいいじゃないという考え。&lt;/p&gt;
&lt;h3&gt;デビッドカードを作る&lt;/h3&gt;
&lt;p&gt;日本の銀行などでは１５歳以上（中学生を除く）でデビッドカードが作れる場合がある、このカードがあればクレジットカード同様に AWS にも登録できる。
クレジットカードと比べると利用できる金額など制限が多かったりしてちょっとしたネットショップとか登録だけなら十分かと&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;メリット&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;高校生でも分割払いが利用できる場合もある。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;デメリット&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;銀行のカードというだけあって銀行口座の開設が必要。（すでに持っている場合は不要かも）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;入会料・年会費などが発生する場合もある&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;WebMoney Card を作る。&lt;/h3&gt;
&lt;p&gt;WebMoney Card はゲームとかする人なら見たことあるかも、コンビニなどでチャージや購入ができるプリペイドカードです。
クレジットじゃないじゃないかとか思うかもしれないが、このカード実は MasterCard として利用できるのだ。私はこれで AWS などのサービスに登録をした、しかもチャージなしで。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;メリット&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;年齢制限なし&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;入会費・年会費必要なし&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;チャージするのでお金が財布から消えていくので使った感がある。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;デメリット&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;クレジットカードではないので分割払いができない場合が多い。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;利用できる金額枠が少ない。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;自分の場合は高校を卒業するまでの仮として使いたいだけだったので Webmoney カードを作った。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[安価でDMX機器をPCでコントロールしたかった]]></title><description><![CDATA[DMX 機器を何種類か導入したはいいものの、卓がなかったり、単純にオペレータが不足してたりするので、PC で一括制御したくなったので作った。 ネットを検索していると Arudino やラズパイを使い PC から DMX 信号を出力しているものをいくつか見つけたが、たかが DMX…]]></description><link>https://blog.magcho.com/安価でdmx機器をpcでコントロールしたかった/</link><guid isPermaLink="false">https://blog.magcho.com/安価でdmx機器をpcでコントロールしたかった/</guid><pubDate>Sat, 20 Aug 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;DMX 機器を何種類か導入したはいいものの、卓がなかったり、単純にオペレータが不足してたりするので、PC で一括制御したくなったので作った。&lt;/p&gt;
&lt;p&gt;ネットを検索していると Arudino やラズパイを使い PC から DMX 信号を出力しているものをいくつか見つけたが、たかが DMX にはオーバースペックだなぁとか、思ってたら、安上がりの記事を見つけたので実際に作ってみる。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stevenbreuls.com/2013/05/diy-usb-dmx-dongle-interface-for-under-10/&quot;&gt;https://stevenbreuls.com/2013/05/diy-usb-dmx-dongle-interface-for-under-10/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;この記事にしたがって作っていけば困ることはなかった。何個か作っているうちに一番手頃に手に入ると思った材料を紹介します。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.amazon.co.jp/dp/B01D140BAU&quot;&gt;https://www.amazon.co.jp/dp/B01D140BAU&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;USBA-B オスオス (ダイソーで購入)&lt;/li&gt;
&lt;li&gt;500 円コインケース(ダイソーで購入)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Amazon で購入したシリアルコンバーターですが、中国から直送されるため注文から 1~2 週間かかり、関税通過のために真っ黄色のプチプチ付き封筒で届きます。
これを使えば、元の記事にあるように IC の足を結線しなくても問題なく動作しました。触ってないのにたまに LED パーが一瞬だけついたりしてたので、末端抵抗をつけたら大丈夫になりました。&lt;/p&gt;</content:encoded></item></channel></rss>